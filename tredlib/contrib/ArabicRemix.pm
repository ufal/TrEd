#!/usr/bin/perl -w
#
# remix.pm ###############################################################################
#
# 2001/11/05 #############################################################################

package ArabicRemix;

use Exporter;
@ISA=qw(Exporter);
@EXPORT=qw(&remix);

sub remix
{
 my($text)=$_[0]." ";
 my(@char)=split(//,$text);

 my($context)=1;
 my(@cut)=(0);

 my($i,@block)=();

 my(%dir)=(
           "\000",  1, # \000       # 00   0 #
           "\001",  1, # \001       # 01   1 #
           "\002",  1, # \002       # 02   2 #
           "\003",  1, # \003       # 03   3 #
           "\004",  1, # \004       # 04   4 #
           "\005",  1, # \005       # 05   5 #
           "\006",  1, # \006       # 06   6 #
           "\007",  1, # \007       # 07   7 #
           "\010",  1, # \010       # 08   8 #
           "\011",  1, # \011       # 09   9 #
           "\012",  1, # \012       # 0A  10 #
           "\013",  1, # \013       # 0B  11 #
           "\014",  1, # \014       # 0C  12 #
           "\015",  1, # \015       # 0D  13 #
           "\016",  1, # \016       # 0E  14 #
           "\017",  1, # \017       # 0F  15 #
           "\020",  1, # \020       # 10  16 #
           "\021",  1, # \021       # 11  17 #
           "\022",  1, # \022       # 12  18 #
           "\023",  1, # \023       # 13  19 #
           "\024",  1, # \024       # 14  20 #
           "\025",  1, # \025       # 15  21 #
           "\026",  1, # \026       # 16  22 #
           "\027",  1, # \027       # 17  23 #
           "\030",  1, # \030       # 18  24 #
           "\031",  1, # \031       # 19  25 #
           "\032",  1, # \032       # 1A  26 #
           "\033",  1, # \033       # 1B  27 #
           "\034",  1, # \034       # 1C  28 #
           "\035",  1, # \035       # 1D  29 #
           "\036",  1, # \036       # 1E  30 #
           "\037",  1, # \037       # 1F  31 #
           "\040",  0, #            # 20  32 #
           "\041",  0, # !          # 21  33 # !
           "\042",  1, # \"         # 22  34 # "
           "\043",  1, # \#         # 23  35 # #
           "\044",  1, # \$         # 24  36 # $
           "\045",  1, # \%         # 25  37 # %
           "\046",  1, # \&         # 26  38 # &
           "\047",  1, # '          # 27  39 # '
           "\050",  1, # (          # 28  40 # (
           "\051",  1, # )          # 29  41 # )
           "\052",  1, # *          # 2A  42 # *
           "\053",  1, # +          # 2B  43 # +
           "\054",  0, # ,          # 2C  44 # ,
           "\055",  1, # -          # 2D  45 # -
           "\056",  0, # .          # 2E  46 # .
           "\057",  1, # /          # 2F  47 # /
           "\060",  0, # 0          # 30  48 # 0
           "\061",  0, # 1          # 31  49 # 1
           "\062",  0, # 2          # 32  50 # 2
           "\063",  0, # 3          # 33  51 # 3
           "\064",  0, # 4          # 34  52 # 4
           "\065",  0, # 5          # 35  53 # 5
           "\066",  0, # 6          # 36  54 # 6
           "\067",  0, # 7          # 37  55 # 7
           "\070",  0, # 8          # 38  56 # 8
           "\071",  0, # 9          # 39  57 # 9
           "\072",  0, # :          # 3A  58 # :
           "\073",  0, # ;          # 3B  59 # ;
           "\074",  1, # <          # 3C  60 # <
           "\075",  1, # =          # 3D  61 # =
           "\076",  1, # >          # 3E  62 # >
           "\077",  0, # ?          # 3F  63 # ?
           "\100",  1, # @          # 40  64 # @
           "\101",  1, # A          # 41  65 # A
           "\102",  1, # B          # 42  66 # B
           "\103",  1, # C          # 43  67 # C
           "\104",  1, # D          # 44  68 # D
           "\105",  1, # E          # 45  69 # E
           "\106",  1, # F          # 46  70 # F
           "\107",  1, # G          # 47  71 # G
           "\110",  1, # H          # 48  72 # H
           "\111",  1, # I          # 49  73 # I
           "\112",  1, # J          # 4A  74 # J
           "\113",  1, # K          # 4B  75 # K
           "\114",  1, # L          # 4C  76 # L
           "\115",  1, # M          # 4D  77 # M
           "\116",  1, # N          # 4E  78 # N
           "\117",  1, # O          # 4F  79 # O
           "\120",  1, # P          # 50  80 # P
           "\121",  1, # Q          # 51  81 # Q
           "\122",  1, # R          # 52  82 # R
           "\123",  1, # S          # 53  83 # S
           "\124",  1, # T          # 54  84 # T
           "\125",  1, # U          # 55  85 # U
           "\126",  1, # V          # 56  86 # V
           "\127",  1, # W          # 57  87 # W
           "\130",  1, # X          # 58  88 # X
           "\131",  1, # Y          # 59  89 # Y
           "\132",  1, # Z          # 5A  90 # Z
           "\133",  1, # [          # 5B  91 # [
           "\134",  1, # \\         # 5C  92 # \
           "\135",  1, # ]          # 5D  93 # ]
           "\136",  1, # ^          # 5E  94 # ^
           "\137",  1, # _          # 5F  95 # _
           "\140",  1, # `          # 60  96 # `
           "\141",  1, # a          # 61  97 # a
           "\142",  1, # b          # 62  98 # b
           "\143",  1, # c          # 63  99 # c
           "\144",  1, # d          # 64 100 # d
           "\145",  1, # e          # 65 101 # e
           "\146",  1, # f          # 66 102 # f
           "\147",  1, # g          # 67 103 # g
           "\150",  1, # h          # 68 104 # h
           "\151",  1, # i          # 69 105 # i
           "\152",  1, # j          # 6A 106 # j
           "\153",  1, # k          # 6B 107 # k
           "\154",  1, # l          # 6C 108 # l
           "\155",  1, # m          # 6D 109 # m
           "\156",  1, # n          # 6E 110 # n
           "\157",  1, # o          # 6F 111 # o
           "\160",  1, # p          # 70 112 # p
           "\161",  1, # q          # 71 113 # q
           "\162",  1, # r          # 72 114 # r
           "\163",  1, # s          # 73 115 # s
           "\164",  1, # t          # 74 116 # t
           "\165",  1, # u          # 75 117 # u
           "\166",  1, # v          # 76 118 # v
           "\167",  1, # w          # 77 119 # w
           "\170",  1, # x          # 78 120 # x
           "\171",  1, # y          # 79 121 # y
           "\172",  1, # z          # 7A 122 # z
           "\173",  1, # {          # 7B 123 # {
           "\174",  1, # |          # 7C 124 # |
           "\175",  1, # }          # 7D 125 # }
           "\176",  1, # ~          # 7E 126 # ~
           "\177",  1, # \177       # 7F 127 # 
           "\200",  1, # \200       # 80 128 # Ä
           "\201", -1, # p          # 81 129 # Å
           "\202",  1, # \202       # 82 130 # Ç
           "\203",  1, # \203       # 83 131 # É
           "\204",  1, # \204       # 84 132 # Ñ
           "\205",  1, # \205       # 85 133 # Ö
           "\206",  1, # \206       # 86 134 # Ü
           "\207",  1, # \207       # 87 135 # á
           "\210",  1, # \210       # 88 136 # à
           "\211",  1, # \211       # 89 137 # â
           "\212",  1, # \212       # 8A 138 # ä
           "\213",  1, # \213       # 8B 139 # ã
           "\214",  1, # \214       # 8C 140 # å
           "\215", -1, # ^c         # 8D 141 # ç
           "\216", -1, # ^z         # 8E 142 # é
           "\217",  1, # \217       # 8F 143 # è
           "\220", -1, # g          # 90 144 # ê
           "\221",  1, # \221       # 91 145 # ë
           "\222",  1, # \222       # 92 146 # í
           "\223",  1, # \223       # 93 147 # ì
           "\224",  1, # \224       # 94 148 # î
           "\225",  1, # \225       # 95 149 # ï
           "\226",  1, # \226       # 96 150 # ñ
           "\227",  1, # \227       # 97 151 # ó
           "\230",  1, # \230       # 98 152 # ò
           "\231",  1, # \231       # 99 153 # ô
           "\232",  1, # \232       # 9A 154 # ö
           "\233",  1, # \233       # 9B 155 # õ
           "\234",  1, # \234       # 9C 156 # ú
           "\235",  1, # \235       # 9D 157 # ù
           "\236",  1, # \236       # 9E 158 # û
           "\237",  1, # \237       # 9F 159 # ü
           "\240",  1, # \240       # A0 160 # †
           "\241", -1, # ,          # A1 161 # °
           "\242",  1, # \242       # A2 162 # ¢
           "\243",  1, # \243       # A3 163 # £
           "\244",  1, # \244       # A4 164 # §
           "\245",  1, # \245       # A5 165 # •
           "\246",  1, # \246       # A6 166 # ¶
           "\247",  1, # \247       # A7 167 # ß
           "\250",  1, # \250       # A8 168 # ®
           "\251",  1, # \251       # A9 169 # ©
           "\252",  1, # \252       # AA 170 # ™
           "\253", -1, # \\lq       # AB 171 # ´
           "\254",  1, # \254       # AC 172 # ¨
           "\255",  1, # \255       # AD 173 # ≠
           "\256",  1, # \256       # AE 174 # Æ
           "\257",  1, # \257       # AF 175 # Ø
           "\260",  1, # \260       # B0 176 # ∞
           "\261",  1, # \261       # B1 177 # ±
           "\262",  1, # \262       # B2 178 # ≤
           "\263",  1, # \263       # B3 179 # ≥
           "\264",  1, # \264       # B4 180 # ¥
           "\265",  1, # \265       # B5 181 # µ
           "\266",  1, # \266       # B6 182 # ∂
           "\267",  1, # \267       # B7 183 # ∑
           "\270",  1, # \270       # B8 184 # ∏
           "\271",  1, # \271       # B9 185 # π
           "\272", -1, # ;          # BA 186 # ∫
           "\273", -1, # \\rq       # BB 187 # ª
           "\274",  1, # \274       # BC 188 # º
           "\275",  1, # \275       # BD 189 # Ω
           "\276",  1, # \276       # BE 190 # æ
           "\277", -1, # ?          # BF 191 # ø
           "\300",  1, # \300       # C0 192 # ¿
           "\301",  1, # '          # C1 193 # ¡
           "\302", -1, # \\madda{}  # C2 194 # ¬
           "\303", -1, # \\ham{a}   # C3 195 # √
           "\304", -1, # \\ham{w}   # C4 196 # ƒ
           "\305", -1, # \\ham{i}   # C5 197 # ≈
           "\306", -1, # \\ham{y}   # C6 198 # ∆
           "\307", -1, # \\alif{}   # C7 199 # «
           "\310", -1, # b          # C8 200 # »
           "\311", -1, # T          # C9 201 # …
           "\312", -1, # t          # CA 202 #  
           "\313", -1, # _t         # CB 203 # À
           "\314", -1, # ^g         # CC 204 # Ã
           "\315", -1, # .h         # CD 205 # Õ
           "\316", -1, # _h         # CE 206 # Œ
           "\317", -1, # d          # CF 207 # œ
           "\320", -1, # _d         # D0 208 # –
           "\321", -1, # r          # D1 209 # —
           "\322", -1, # z          # D2 210 # “
           "\323", -1, # s          # D3 211 # ”
           "\324", -1, # ^s         # D4 212 # ‘
           "\325", -1, # .s         # D5 213 # ’
           "\326", -1, # .d         # D6 214 # ÷
           "\327",  1, # \327       # D7 215 # ◊
           "\330", -1, # .t         # D8 216 # ÿ
           "\331", -1, # .z         # D9 217 # Ÿ
           "\332", -1, # `          # DA 218 # ⁄
           "\333", -1, # .g         # DB 219 # €
           "\334", -1, # -          # DC 220 # ‹
           "\335", -1, # f          # DD 221 # ›
           "\336", -1, # q          # DE 222 # ﬁ
           "\337", -1, # k          # DF 223 # ﬂ
           "\340",  1, # \340       # E0 224 # ‡
           "\341", -1, # l          # E1 225 # ·
           "\342",  1, # \342       # E2 226 # ‚
           "\343", -1, # m          # E3 227 # „
           "\344", -1, # n          # E4 228 # ‰
           "\345", -1, # h          # E5 229 # Â
           "\346", -1, # w          # E6 230 # Ê
           "\347",  1, # \347       # E7 231 # Á
           "\350",  1, # \350       # E8 232 # Ë
           "\351",  1, # \351       # E9 233 # È
           "\352",  1, # \352       # EA 234 # Í
           "\353",  1, # \353       # EB 235 # Î
           "\354", -1, # \\maq{}    # EC 236 # Ï
           "\355", -1, # y          # ED 237 # Ì
           "\356",  1, # \356       # EE 238 # Ó
           "\357",  1, # \357       # EF 239 # Ô
           "\360", -1, # \\vow{aN}  # F0 240 # 
           "\361", -1, # \\vow{uN}  # F1 241 # Ò
           "\362", -1, # \\vow{iN}  # F2 242 # Ú
           "\363", -1, # \\vow{a}   # F3 243 # Û
           "\364",  1, # \364       # F4 244 # Ù
           "\365", -1, # \\vow{u}   # F5 245 # ı
           "\366", -1, # \\vow{i}   # F6 246 # ˆ
           "\367",  1, # \367       # F7 247 # ˜
           "\370", -1, # \\shadda{} # F8 248 # ¯
           "\371",  1, # \371       # F9 249 # ˘
           "\372", -1, # \\sukun{}  # FA 250 # ˙
           "\373",  1, # \373       # FB 251 # ˚
           "\374",  1, # \374       # FC 252 # ¸
           "\375",  1, # \375       # FD 253 # ˝
           "\376",  1, # \376       # FE 254 # ˛
           "\377",  1, # \377       # FF 255 # ˇ
          );

 for ($i=0; $i<@char; $i++)
 {
  if ($context+$dir{$char[$i]}==0)
  {
   push(@cut,$i);
   $context*=-1;
  }
 }
 push(@cut,$i);

 for ($i=1; $i<@cut; $i++) { unshift(@block,join("",@char[$cut[$i-1]..$cut[$i]-1])); }

 $text=join("",@block);

 return $text;
}

1;
