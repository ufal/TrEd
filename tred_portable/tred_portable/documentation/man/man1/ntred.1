.\" Automatically generated by Pod::Man 2.25 (Pod::Simple 3.07)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "NTRED 1"
.TH NTRED 1 "2011-03-28" "perl v5.10.1" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "ntred"
.IX Header "ntred"
ntred \- controller/hub/client interface to a cluster of btred servers
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
To query the servers:
.PP
.Vb 3
\&  ntred [\-m|\-I macro\-file] [\-e code] [\-\-hub hub] [\-\-port port]
\&        [\-N|\-H] [\-T] [\-\-key\-file file] [\-\-filelist file\-list ] [\-L files]
\&        \-\- script\-arguments
.Ve
.PP
To start remote servers and a hub:
.PP
.Vb 9
\&  ntred \-i [\-\-servers server[,server,...]] [\-\-serverlist server\-list]
\&           [\-\-filelist file\-list] [\-\-max\-servers num] 
\&           [\-\-allow\-no\-trees] [\-\-no\-secondary\-files]
\&           [\-\-no\-server\-check] [\-\-no\-server\-start] [\-\-no\-hub\-start]
\&           [\-\-old\-dist\-method] [\-\-safe\-mode] [\-\-server\-debug]
\&           [\-m|\-I macro\-file] [\-\-disable\-extensions list] [\-\-enable\-extensions list]
\&           [\-M module] [\-\-btred path\-to\-btred]
\&           [\-\-ssh ssh\-command] [\-\-local]
\&           [\-\-key\-file] [\-\-hub hub] [\-\-port port] [file [...]]
.Ve
.PP
To close all remote servers and a hub:
.PP
.Vb 1
\&  ntred \-\-quit|\-\-ps\-quit
.Ve
.PP
To kill all remote servers and a hub:
.PP
.Vb 1
\&  ntred \-\-kill|\-\-ps\-kill
.Ve
.PP
To manage files on the servers:
.PP
.Vb 1
\&  ntred \-\-list\-files|\-\-list\-changed\-files
\&
\&  ntred \-\-reload\-files [\-\-disable\-extensions list] [\-\-enable\-extensions list]
\&
\&  ntred \-\-reload\-macros [\-m macro\-file]
\&
\&  ntred \-\-load\-files [\-\-filelist file\-list] [file [...]]
\&
\&  ntred \-\-close\-files
\&
\&  ntred \-\-save\-files|\-\-save\-changed\-files [\-s strip\-sfx]
\&       [\-a append\-sfx] [\-p strip\-prefix] [\-r add\-prefix] [\-f out\-fmt]
\&
\&  ntred \-\-dump\-files [\-\-filelist file\-list] [file [...]]
\&
\&  ntred \-\-upload\-file filename < fs\-file
.Ve
.PP
Get help:
.PP
.Vb 3
\&  ntred \-u          for usage (synopsis)
\&  ntred \-h          for help
\&  ntred \-\-man       for the manual page
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This program is able to start one or more btred servers on a set of
host machines over \s-1SSH\s0, create a proxy hub to provide the
communication between the servers and a client, distribute given files
over the servers (provided the servers are able to load the files from
given filenames (eg. they share the files over \s-1NFS\s0), query the servers
using a btred-macro and collect the answers.  It is highly recommended
to use some password-free authentication method for \s-1SSH\s0 (e.g. Kerberos
or \f(CW\*(C`ssh\-agent\*(C'\fR), so that password input is not required each time the
\&\s-1SSH\s0 connection is made (at least two per-host).
.PP
In the client mode, the standard output of the macro is printed to
\&\s-1STDOUT\s0 of the client. \s-1STDERR\s0 is reserved for debugging and information
messages as well as error messages caused by the macros on the
servers. The rest of the error output from a server is stored in a
file <logdir>/ntred\-server\-<host>.log (where <logdir> can be specified
using \f(CW\*(C`\-\-logdir\*(C'\fR, \s-1NTRED_LOGDIR\s0 or \s-1TMP\s0 or \s-1TEMP\s0 environment variable
and defaults to /tmp if none of the previous exists).
.SH "CONFIG FILE"
.IX Header "CONFIG FILE"
Options for ntred can be specified on the command line or in a config
file (default is ~/.ntredrc, but \-\-ntred\-config\-file option can be use
to set a custom config file). The format of this file is simple: each
non-empty line should be of the form:
.PP
.Vb 1
\& option = value
.Ve
.PP
with leading and trailing white-space ignored and with all characters
following a '#' ignored. Option names for the config file are the same
as command-line options, but without leading \- or \-\-.
.SH "OPTIONS"
.IX Header "OPTIONS"
.SS "\s-1QUERY\s0 \s-1MODE\s0 \s-1OPTIONS\s0"
.IX Subsection "QUERY MODE OPTIONS"
.Vb 2
\&  ntred [\-m macro\-file] [\-e code] [\-\-hub hub] [\-\-port port]
\&        [\-N|\-H] [\-T] [\-\-key\-file file] \-\- script\-arguments
.Ve
.IP "\fB\-\-execute|\-e\fR code" 8
.IX Item "--execute|-e code"
This is the query to be executed on the remote servers. It usually
either of a name of the macro defined in the file given as
\&\f(CW\*(C`\-\-macro\-file\*(C'\fR or some Perl one-liner. If omitted, it defaults to
\&'\fIautostart()\fR' and a macro with this name must be defined in
the macro file provided..
.IP "\fB\-\-macro\-file|\-m\fR filename" 8
.IX Item "--macro-file|-m filename"
A file containing macros that are to be sent to the servers and
preloaded on the servers before the particular query code is
evaluated. The query code to be evaluated must be specified in
\&\f(CW\*(C`\-\-execute\*(C'\fR.
.Sp
Note that servers already have the set of macros they obtained on
startup (i.e. \fB\-\-init\fR): it is namely either the default set of
macros (\f(CW\*(C`tred.mac\*(C'\fR) or the set specified via \fB\-\-macro\-file\fR, and beside one of
these also the set specified via \fB\-\-include\-macro\-file\fR.
.IP "\fB\-\-include\-macro\-file|\-I\fR filename" 8
.IX Item "--include-macro-file|-I filename"
A file containing additional set of macros to be sent to the servers.
In query mode, this option behaves just like \f(CW\*(C`\-\-macro\-file\*(C'\fR and is
only provided for compatibility with \f(CW\*(C`btred\*(C'\fR. If both these options
are used, both sets of macros are loaded.
.IP "\fB\-\-hub\fR hostname" 8
.IX Item "--hub hostname"
The hostname of the hub to connect to (defaults to localhost).
.IP "\fB\-\-port\fR port" 8
.IX Item "--port port"
The port on which the hub is listening (defaults to 1500).
.IP "\fB\-\-all\-trees|\-T\fR" 8
.IX Item "--all-trees|-T"
Run the query code on all trees (wrapping the code into a
\&\f(CW\*(C`if ($root) { do {{ CODE }} while TredMacro::NextTree() }\*(C'\fR loop).
.IP "\fB\-\-all\-nodes|\-N\fR" 8
.IX Item "--all-nodes|-N"
Run the query code on all nodes (you still must use \-\-all\-trees or \-T
to process all trees) (wrapping the code into a
\&\f(CW\*(C`while ($this) { CODE ; $this=$this\-\*(C'\fRfollowing }";> loop).
.IP "\fB\-\-all\-nonhidden\-nodes|\-H\fR" 8
.IX Item "--all-nonhidden-nodes|-H"
Run the query code on all nodes that are not hidden (you still must
use \-\-all\-trees or \-T to process all trees). This wraps
the code into a
\&\f(CW\*(C`while ($this) { CODE ; $this=$this\-\*(C'\fRfollowing_visible(\s-1\fIFS\s0()\fR) }";> loop).
.IP "\fB\-\-listed\-files|\-L\fR" 8
.IX Item "--listed-files|-L"
Run the query code only on files specified on the command line
(provided they are already present on some server, i.e. this option
does \fInot\fR make servers load files they don't already
have). Filenames may contain ordinary TrEd suffixes of the form ##tree
or ##tree.node to indicate that the processing should apply only on a
single tree (use in combination with \-N) or a single node (use without
\&\-T and \-N). NTrEd URIs of the form ntred:// are also allowed. Relative
file-names are expanded according to the current working directory
before they are sent to ntred servers.
.IP "\fB\-\-regexp\-files|\-R\fR regular-expression" 8
.IX Item "--regexp-files|-R regular-expression"
Run the query code only on files whose filenames match a given regular
expression.
.IP "\fB\-\-filelist|\-l\fR filename" 8
.IX Item "--filelist|-l filename"
Like \f(CW\*(C`\-\-listed\-files|\-L\*(C'\fR but this time the files to be processed are
listed in the given file rather than on the command line. Both options
may be used together in which case the file-lists are joined.
.IP "\fB\-\-key\-file\fR" 8
.IX Item "--key-file"
This option may be used to provide a file with a session-key which is
necessary for the authentication to the running hub. This defaults to
`~/.ntred_session_key'.
.SS "\s-1HUB\s0 \s-1AND\s0 \s-1SERVER\s0 \s-1MODE\s0 \s-1OPTIONS\s0"
.IX Subsection "HUB AND SERVER MODE OPTIONS"
.Vb 8
\&  ntred \-i [\-\-servers server[,server,...]] [\-\-serverlist server\-list]
\&           [\-\-filelist file\-list] [\-\-max\-servers num]
\&           [\-\-no\-secondary\-files] [\-\-no\-server\-check]
\&           [\-\-no\-server\-start] [\-\-no\-hub\-start] [\-\-old\-dist\-method]
\&           [\-\-safe\-mode] [\-\-server\-debug] [\-\-max\-retries num]
\&           [\-m macro\-file] [\-M module] [\-\-btred path\-to\-btred]
\&           [\-\-ssh ssh\-command] [\-\-local] [\-\-key\-file file]
\&           [\-\-hub hub] [\-\-port port] [file [...]]
.Ve
.IP "\fB\-\-servers\fR list of hosts" 8
.IX Item "--servers list of hosts"
A comma separated list of hosts to run btred servers. The hostname may
be optionally followed by a comma and a port number thus making it
possible to run several btred servers on one host. If the port number
is omitted, it defaults to 1600. See also \f(CW\*(C`\-\-serverlist\*(C'\fR.
.Sp
Ports may be given as a range, e.g. 1600\-1800; in this case btred
server will use the first port from the range that is free.
.Sp
Special syntax can be used to start btred servers over \s-1SGE\s0 cluster
using the task queue (qsub and qdel commands must be in \s-1PATH\s0):
.Sp
.Vb 1
\&  qsub://<job_prefix>:<port_range>
.Ve
.Sp
In this case ntred schedules one btred server task on the \s-1SGE\s0 queue
for each port in the range. It waits at most two seconds times
\&\f(CW\*(C`\-\-max\-retries\*(C'\fR for the first server to start. Tasks of the servers
that are not running by that time are abandoned and deleted from the
queue.
.IP "\fB\-\-serverlist\fR filename" 8
.IX Item "--serverlist filename"
This provides more convenient way to specify servers by providing a
file containing a list of servers, one per line. If neither
\&\f(CW\*(C`\-\-servers\*(C'\fR nor \f(CW\*(C`\-\-serverlist\*(C'\fR is
provided, then the list of servers is read from ~/.ntred_serverlist.
.IP "\fB\-\-filelist\fR filename" 8
.IX Item "--filelist filename"
A list of files to distribute between servers (one filename per line).
Additional files may be given as command-line arguments.
.IP "\fB\-\-no\-secondary\-files\fR" 8
.IX Item "--no-secondary-files"
Don't load \*(L"secondary\*(R" files along with normal files (a file may
require other \- secondary \- file to load along with it; this is
typical for stand-off annotation where one tree is built upon
another).
.IP "\fB\-\-allow\-no\-trees|\-0\fR" 8
.IX Item "--allow-no-trees|-0"
Allow files with no trees (normaly such files are considered broken).
Note: the short flag is \-zero.
.IP "\fB\-\-max\-servers\fR number" 8
.IX Item "--max-servers number"
Limit number of servers to start even if the list of servers contains
more of them.
.IP "\fB\-\-max\-retries\fR number" 8
.IX Item "--max-retries number"
Specifies how many times the hub tries to connect to a btred server
before it gives up.
.IP "\fB\-\-no\-server\-check\fR" 8
.IX Item "--no-server-check"
Skip an initial check for server hosts availability (a dummy attempt
for \s-1SSH\s0 connection).
.IP "\fB\-\-no\-server\-start\fR" 8
.IX Item "--no-server-start"
Don't start new btred servers on the remote hosts. Instead, start a
hub and try to connect to the btred servers already running. This
requires a server-session key to be given on the standard input.
.IP "\fB\-\-no\-hub\-start\fR" 8
.IX Item "--no-hub-start"
Start servers on the remote hosts but don't start a hub. The server
session key required for authentication to the servers will be
printed on the standard output.
.IP "\fB\-\-safe\-mode|\-F\fR" 8
.IX Item "--safe-mode|-F"
Run btred servers in safe mode in which all macros are processed in a
Safe compartment whith some security restrictions.  This mode seems to
be likely to cause btred servers to suffer from memory leaks.
.Sp
In the safe mode, only the following opcodes and opcode-sets are
allowed (see documentation for the Opcode Perl module):
.Sp
.Vb 4
\&  :base_core :base_mem :base_loop :base_math
\&  entereval caller dofile
\&  print entertry leavetry tie untie bless
\&  sprintf localtime gmtime sort require
.Ve
.Sp
plus :base_orig, but the following opcodes (which are forbidden):
.Sp
.Vb 2
\&  getppid getpgrp setpgrp getpriority setpriority pipe_op sselect
\&  select dbmopen dbmclose tie untie
.Ve
.IP "\fB\-\-server\-debug\fR" 8
.IX Item "--server-debug"
Run btred server with \-D flag for some more debugging information.
.IP "\fB\-\-macro\-file|\-m\fR filename" 8
.IX Item "--macro-file|-m filename"
A file containing the default set of macros to be prepared on btred
servers. The file (with exactly the same path) must be visible from
all server hosts.
.IP "\fB\-\-include\-macro\-file|\-I\fR filename" 8
.IX Item "--include-macro-file|-I filename"
A file containing additional set of macros to be prepared on btred
servers. This option is typically used instead of \f(CW\*(C`\-\-macro\-file\*(C'\fR to
load macros from \fBboth\fR \f(CW\*(C`filename\*(C'\fR \fBand\fR the default macro set from
(\f(CW\*(C`tred.mac\*(C'\fR). \f(CW\*(C`\-\-macro\-file\*(C'\fR can still be used in combination with
\&\fB\-\-include\-macro\-file\fR to supply a replacement for \f(CW\*(C`tred.mac\*(C'\fR.
.IP "\fB\-\-enable\-extensions\fR list" 8
.IX Item "--enable-extensions list"
Give a comma-separated list of installed TrEd extension names to
temporarily enable if disabled in the extension configuration.
Use '*' to enable all currently enabled extensions.
.Sp
This option can only be used with \f(CW\*(C`\-\-init\*(C'\fR or \f(CW\*(C`\-\-reload\-macros\*(C'\fR.
.IP "\fB\-\-disable\-extensions\fR list" 8
.IX Item "--disable-extensions list"
Give a comma-separated list of installed TrEd extension names to
temporarily disable if enabled in the extension configuration.
Use '*' to disable all currently enabled extensions.
.Sp
This option can only be used with \f(CW\*(C`\-\-init\*(C'\fR or \f(CW\*(C`\-\-reload\-macros\*(C'\fR.
.IP "\fB\-\-key\-file\fR" 8
.IX Item "--key-file"
Allows to specify a file where the the session-key for a client's
authentication will be stored. It defaults to ~/.ntred_session_key.
.IP "\fB\-\-terminal\-encoding|\-d\fR encoding" 8
.IX Item "--terminal-encoding|-d encoding"
Automatically applies a given character encoding to all stdout output
operations on the servers and command-line arguments.
Only works with Perl >= 5.8.
.IP "\fB\-\-hub\fR hostname" 8
.IX Item "--hub hostname"
The hostname of the local machine the hub will listen on (defaults to
localhost but a machine's hostname may be given to allow remote access
to the hub).
.IP "\fB\-\-port\fR port" 8
.IX Item "--port port"
The port number the hub will be listening on (defaults to 1500).
.IP "\fB\-\-preload\-module|\-M\fR module-name" 8
.IX Item "--preload-module|-M module-name"
This option is passed to the btred command line when starting a btred
server. It makes btred preload a given Perl module at btred startup so
as it is available to all macros (\s-1DOES\s0 \s-1NOT\s0 \s-1WORK\s0 \s-1WITH\s0 \s-1RESTRICTED\s0 \s-1MODE\s0).
This option may be specified more than once with different modules.
.IP "\fB\-\-old\-dist\-method\fR" 8
.IX Item "--old-dist-method"
Use old benchmark-based distribution method.
.SS "\s-1HUB\s0 \s-1CONTROL\s0 \s-1OPTIONS\s0"
.IX Subsection "HUB CONTROL OPTIONS"
.Vb 1
\&  ntred \-\-list\-files|\-\-list\-changed\-files
\&
\&  ntred \-\-reload\-files [\-filelist file\-list] [\-\-listed\-files file [...]]
\&
\&  ntred \-\-reload\-changed\-files
\&
\&  ntred \-\-reload\-macros [\-m macro_file]
\&
\&  ntred \-\-load\-files [\-\-filelist file\-list] [file [...]]
\&
\&  ntred \-\-close\-files
\&
\&  ntred \-\-save\-files|\-\-save\-changed\-files [\-s strip\-sfx]
\&       [\-a append\-sfx] [\-p strip\-prefix] [\-r add\-prefix] [\-f out\-fmt] [\-\-knit]
\&
\&  ntred \-\-quit
\&
\&  ntred \-\-kill|\-\-ps\-kill [\-\-servers server[,server,...]] [\-\-serverlist server\-list]
\&
\&  ntred \-\-break|\-\-ps\-break
\&
\&  ntred \-\-dump\-files [\-\-filelist file\-list] [file [...]]
\&
\&  ntred \-\-upload\-file filename < fs\-file
.Ve
.IP "\fB\-\-init|\-i\fR" 8
.IX Item "--init|-i"
Start remote btred servers and a hub. See \*(L"\s-1HUB\s0 \s-1AND\s0 \s-1SERVER\s0 \s-1MODE\s0 \s-1OPTIONS\s0\*(R".
.IP "\fB\-\-keep\-empty\-servers|\-E\fR" 8
.IX Item "--keep-empty-servers|-E"
Keep alive those servers which do not get any file during the initial
file distribution (by default, unused servers are automatically
closed).
.IP "\fB\-\-quit\fR" 8
.IX Item "--quit"
Sends the hub and all the servers a command to quit.
.IP "\fB\-\-break\fR" 8
.IX Item "--break"
Tells ntred nub to send \s-1USR1\s0 a signal to all running btred servers.
Upon receiving that signal, the servers should stop current processing
and return to the request awaiting state.
.IP "\fB\-\-ps\-kill\fR" 8
.IX Item "--ps-kill"
Similar to \f(CW\*(C`\-\-break\*(C'\fR but tries to identify btred server processes by
looking at the output of the system command \f(CW\*(C`ps x \-o pid,command\*(C'\fR. This may help if
\&\f(CW\*(C`killall \-USR1 btred\*(C'\fR doesn't work.
.IP "\fB\-\-kill\fR" 8
.IX Item "--kill"
Runs \f(CW\*(C`killall \-9 ntred\*(C'\fR on the local machine and and \f(CW\*(C`killall \-9 btred\*(C'\fR on
the server hosts listed with \-\-servers, \-\-serverlist, or in
~/.ntred_serverlist.
.IP "\fB\-\-ps\-kill\fR" 8
.IX Item "--ps-kill"
Similar to \f(CW\*(C`\-\-kill\*(C'\fR but tries to identify btred server processes by
looking at the output of the system command \f(CW\*(C`ps x \-o pid,command\*(C'\fR. This may help if
\&\f(CW\*(C`killall \-TERM btred\*(C'\fR doesn't work.
.IP "\fB\-\-list\-files\fR" 8
.IX Item "--list-files"
List all files currently open on servers.
.IP "\fB\-\-list\-changed\-files\fR" 8
.IX Item "--list-changed-files"
List all files that have been changed by some macro. Note, that a macro
has to claim that the file was changed by setting
\&\f(CW$TredMacro::FileChanged\fR variable to 1, otherwise the btred server
would never notice.
.IP "\fB\-\-listed\-files|\-L\fR" 8
.IX Item "--listed-files|-L"
Apply request only on listed files (currently only works for queries
and \f(CW\*(C`\-\-reload\-files\*(C'\fR request).
.IP "\fB\-\-count\-files\fR" 8
.IX Item "--count-files"
Query number of files open on each server.
.IP "\fB\-\-reload\-files\fR" 8
.IX Item "--reload-files"
Send a command to the btred servers to reload all open files.  If
\&\f(CW\*(C`\-\-filelist\*(C'\fR or \f(CW\*(C`\-\-listed\-files\*(C'\fR options are given, reload only
files occuring in the given lists (all other files remain intact in
servers' memory).
.IP "\fB\-\-reload\-changed\-files\fR" 8
.IX Item "--reload-changed-files"
Send a command to the btred servers to reload files that have been
modified since (re)loaded.
.IP "\fB\-\-reload\-macros\fR" 8
.IX Item "--reload-macros"
Send command to the btred servers to reload the initial macro file.
If \f(CW\*(C`\-m\*(C'\fR (\f(CW\*(C`\-\-macro\-file\*(C'\fR) is specified, the servers use the given
macro-file instead of the original one (specified when initializing
btred servers). Note, that the file (with exactly the same path) must
be visible from all server hosts.
.Sp
Options \f(CW\*(C`\-\-disable\-extensions\*(C'\fR and \f(CW\*(C`\-\-enable\-extensions\*(C'\fR can be used
to define a set of extensions to use.
.IP "\fB\-\-load\-files\fR" 8
.IX Item "--load-files"
Send a command to the hub to distribute files given on the
command-line or those specified using \f(CW\*(C`\-\-filelist\*(C'\fR of in
~/.ntred_filelist to the servers.
.Sp
Warning: Do not load files already in servers' memory, otherwise you
may get duplicates (depending on to which server the files get
distributed). Use \f(CW\*(C`\-\-list\-files\*(C'\fR to see which files are already loaded.
.Sp
See also \f(CW\*(C`\-\-reload\-files\*(C'\fR.
.IP "\fB\-\-close\-files\fR" 8
.IX Item "--close-files"
Send a command to the btred servers to close all open files.
.IP "\fB\-\-save\-files\fR" 8
.IX Item "--save-files"
Send a command to the servers to save all open files.  The filenames
of the saved files may be modified using
\&\f(CW\*(C`\-\-add\-prefix\*(C'\fR, \f(CW\*(C`\-\-strip\-prefix\*(C'\fR,
\&\f(CW\*(C`\-\-strip\-suffix\*(C'\fR,
\&\f(CW\*(C`\-\-append\-suffix\*(C'\fR.
.IP "\fB\-\-save\-changed\-files\fR" 8
.IX Item "--save-changed-files"
Same as \f(CW\*(C`\-\-save\-files\*(C'\fR except that only files that have been changed
by some macro will be saved. Note, that a macro has to claim that the
file was changed by setting \f(CW$TredMacro::FileChanged\fR variable to 1,
otherwise the btred server would never notice. See also
\&\f(CW\*(C`\-\-list\-changed\-files\*(C'\fR.
.IP "\fB\-\-knit|K\fR ALL|NONE|name1,name2,..." 8
.IX Item "--knit|K ALL|NONE|name1,name2,..."
If a file is saved, save/update also listed types of reffiles the file
pulled data from. For the moment, this only makes sense with the
\&\f(CW\*(C`PML\*(C'\fR backend which supports so called \fBknitting\fR, i.e. a method to
pull certain data from external resources and push it back (with all
changes) to the original position in the resource when saving the
file. This option allows to list the types of resources (in \s-1PML\s0 the
types are the reference names listed in the \s-1PML\s0 schema) which should
be saved. Default is \f(CW\*(C`NONE\*(C'\fR. This type of resources doesn't include
so called secondary files.
.IP "\fB\-\-dump\-files\fR" 8
.IX Item "--dump-files"
Dumps given files or trees to standard output in \s-1FS\s0 format as they are
in memory of the btred servers. Individual dumps are separated with
`//FSEND' preceded and followed by two newline characters.  To output
a single tree, follow the filename with \f(CW\*(C`##n\*(C'\fR suffix where \f(CW\*(C`n\*(C'\fR is
the absolute position of the tree in the file (starting from one).
The following example shows how \f(CW\*(C`csplit\*(C'\fR command can be used to
save individual dumps into separate files:
.Sp
.Vb 1
\&  ntred \-\-dump <files> | csplit \-z \-f out \-b \*(Aq%d.fs\*(Aq \- \*(Aq/\e/\e/FSEND/+2\*(Aq \*(Aq{*}\*(Aq
.Ve
.Sp
To merge these separate files into one huge \s-1FS\s0 file, use
.Sp
.Vb 1
\&  any2any \-m hugeout.fs out*.fs
.Ve
.IP "\fB\-\-upload\-file\fR" 8
.IX Item "--upload-file"
This command is kind of a reverse to dump. It takes a filename from
the first command line argument and a \s-1FS\s0 file from the standard input
and sends them to the btred servers. The server possessing the file
with the given filename replaces its own in-memory copy of the file
with the one provided on the standard input. To update a single tree,
follow the filename with \f(CW\*(C`##n\*(C'\fR suffix where \f(CW\*(C`n\*(C'\fR is the absolute
position of the tree in the file (starting from one).
.IP "\fB\-\-no\-secondary\-files\fR" 8
.IX Item "--no-secondary-files"
Ignore \*(L"secondary\*(R" files even if loaded. This only affects some
commands, such as \fB\-\-list\-changed\fR, in which particular case is means
that a file, whose secondary file was changed, is not reported as
changed unless the (primary) file itself was marked as changed.
.IP "\fB\-\-allow\-no\-trees|\-0\fR" 8
.IX Item "--allow-no-trees|-0"
Allow files with no trees (normaly such files are considered broken).
Note: the short flag is \-zero.
.SS "\s-1SAVING\s0 \s-1OPTIONS\s0"
.IX Subsection "SAVING OPTIONS"
.IP "\fB\-\-strip\-prefix|\-p\fR regexp" 8
.IX Item "--strip-prefix|-p regexp"
Remove strings matching given regexp from the beginning of filenames
before saving.
.IP "\fB\-\-add\-prefix|\-r\fR prefix" 8
.IX Item "--add-prefix|-r prefix"
Prepend output filenames with the given prefix when saving.
.IP "\fB\-\-strip\-suffix|\-s\fR regexp" 8
.IX Item "--strip-suffix|-s regexp"
Strip strings matching given regexp from the end of filenames
when saving.
.IP "\fB\-\-add\-suffix|\-a\fR suffix" 8
.IX Item "--add-suffix|-a suffix"
Append given suffix to the filenames when saving.
.IP "\fB\-\-output\-format|\-f\fR [fs|csts|trxml|tei|storable]" 8
.IX Item "--output-format|-f [fs|csts|trxml|tei|storable]"
Format to use for files being saved.
.IP "\fB\-\-no\-secondary\-files\fR" 8
.IX Item "--no-secondary-files"
Don't save \*(L"secondary\*(R" files (not even if changed). Normally,
secondary files (if loaded) are saved along with their primary files
(the exactly same file-name prefix/suffix processing and format apply
to both the primary and secondary files).
.SS "\s-1GENERAL\s0 \s-1OPTIONS\s0"
.IX Subsection "GENERAL OPTIONS"
.IP "\fB\-\-glob|\-g\fR" 8
.IX Item "--glob|-g"
Apply Perl \f(CW\*(C`glob\*(C'\fR function on the filename patterns given on the
command-line.  This expands possible wild-card patterns on each of the
filename command-line argument as the standard Unix shell /bin/csh
would do. This can not only help in a situation where the shell used
doesn't support wildcard expansion, but can also be used to reduce the
number of the command-line arguments passed to the process in cases
where the argument list would after the shell-expansion exceed a
system limit. Note, that currently expansion is performed on the
client regardless of the type of request. This may change in the
future versions.
.IP "\fB\-\-usage|\-u\fR" 8
.IX Item "--usage|-u"
Print a brief help message on usage and exits.
.IP "\fB\-\-help|\-h\fR" 8
.IX Item "--help|-h"
Prints the help page and exits.
.IP "\fB\-\-man\fR" 8
.IX Item "--man"
Displays the help as manual page.
.IP "\fB\-\-quiet|\-q\fR" 8
.IX Item "--quiet|-q"
Suppress all \s-1NTRED\-CLIENT/NTRED\-HUB\s0 messages on error output.
.IP "\fB\-\-really\-quiet|\-Q\fR" 8
.IX Item "--really-quiet|-Q"
Redirect all std error output to /dev/null.
.IP "\fB\-\-ssh\fR command" 8
.IX Item "--ssh command"
This option may be used to specify the ssh/rsh command to use to
connect to remote servers. Default value is `ssh \-o ConnectTimeout=10'.
.IP "\fB\-\-local\fR" 8
.IX Item "--local"
Run btred servers locally. It ignores all non-local entries in the
\&.ntred_serverlist (i.e. entries not matching local machine's
hostname). There still may be more BTrEd instances, provided they use
different ports. In this case, \s-1SSH\s0 is not used.
.Sp
Use \-\-servers localhost:XY (where \s-1XY\s0 is port number)
if you wish to run a single server on the loopback interface.
.IP "\fB\-\-btred\fR command" 8
.IX Item "--btred command"
This option may be used to specify the command to use to start a btred
server on a remote host. The command must accept any btred parameters.
.SH "SECURITY ISSUES"
.IX Header "SECURITY ISSUES"
\&\s-1USE\s0 \s-1AT\s0 \s-1YOUR\s0 \s-1OWN\s0 \s-1RISK\s0. \s-1IF\s0 \s-1SECURITY\s0 \s-1IS\s0 A \s-1CRITICAL\s0 \s-1ISSUE\s0 \s-1OR\s0 \s-1IF\s0 \s-1IN\s0 \s-1DOUBT\s0,
\&\s-1DON\s0'T \s-1USE\s0 \s-1IT\s0 \s-1AT\s0 \s-1ALL\s0.
.PP
Why is security an issue here? Because btred servers execute almost
arbitrary Perl code provided by the client. In the \f(CW\*(C`\-\-unrestricted\*(C'\fR
mode such code may contain arbitrary commands such as \fIsystem()\fR or
\&\fIopen()\fR. It is therefore desirable that the servers are not open for
all parties.
.PP
The following precautions have been taken to lower the potential
security risks:
.PP
1) Both btred servers and hub require an authorization based on
   verification of a \s-1MD5\s0 signature of a random data block (generated
   by the server in case of the hub-to-btred-server communication and
   by the hub in case of the client-to-hub communication) xor-ed with
   an authorization key known to both parties. Although the
   communication is unencrypted, the client must with each
   request send a \s-1MD5\s0 checksum of the request XORed with the secret
   authorization key.  Only requests whose signature is verified
   by the server, are responded to.
.PP
2) There may be only one connection from a hub to a server.  As soon as
   it is closed, the server terminates.
.PP
3) If the servers are started by the hub itself (using \f(CW\*(C`\-\-init\*(C'\fR) the
   authorization key is created by the hub and is passed to the btred
   server via a ssh encrypted pipe.
.PP
4) For the client's disposal, the authorization key is stored in
   user's home directory as \f(CW\*(C`~/.ntred_session_key\*(C'\fR with permissions
   set to 600 (only user can read or write). This theoretically
   (depending on the general security of the system) limits the access
   to the hub (and thus to the servers) to the user running the hub
   only. It may, though, be obviously abused from the local root
   account to execute arbitrary perl code on all btred server
   hosts. This might especially be undesirable if the hub runs on a
   machine whose administrator would normaly have no user access to
   the machines running btred servers. Another possible security issue
   might arise if user's home directory is on a remote \s-1NFS\s0 server, so
   that \s-1NFS\s0 intervenes accessing the key file. Since \s-1NFS\s0 uses an
   unencrypted protocol, network sniffing techniques may be used to
   obtain the authorization key and hence run arbitrary code on btred
   hosts. If such situations are likely to happen (e.g. in a large
   network) it is advisable to use a different location for the
   authorization key (see \f(CW\*(C`\-\-key\-file\*(C'\fR), e.g. \f(CW\*(C`/tmp\*(C'\fR.
.PP
5) It is possible to restrict Perl code evaluated on the servers to a
   safer compartment, where some critical Perl commands are disabled.
   In some cases, these restrictions may not be sufficient, in other
   they may be too strict. Some memory leaks can appear when Safe
   compartment is used. See \f(CW\*(C`\-\-safe\-mode\*(C'\fR above for more discussion.
.PP
6) Unless \f(CW\*(C`\-\-hub\*(C'\fR option is used, the hub runs on localhost and as
   such is not (under normal circumstances) open for connections from
   the outside world. If you are considering making the hub listen on
   a non-local interface, note that it is a much better option to
   configure a secure \s-1SSH\s0 tunnel.
.SH "FILES"
.IX Header "FILES"
\&\f(CW\*(C`~/.ntred_serverlist\*(C'\fR  \- default list of servers to use
.PP
\&\f(CW\*(C`~/.ntred_filelist\*(C'\fR    \- default list of files to load on servers
.PP
\&\f(CW\*(C`~/.ntred_session_key\*(C'\fR \- client/hub session key
.SH "LICENSE"
.IX Header "LICENSE"
This software is distributed under \s-1GPL\s0 \- The General Public Licence.
Full text of the \s-1GPL\s0 can be found in the \s-1LICENSE\s0 file distributed with
this program and also on-line at http://www.gnu.org/copyleft/gpl.html.
.SH "AUTHORS"
.IX Header "AUTHORS"
Petr Pajas <pajas@matfyz.cz>
.PP
Zdenek Zabokrtsky <zabokrtsky@ufal.mff.cuni.cz>
.PP
Copyright 2003\-2008 Petr Pajas and Zdenek Zabokrtsky, All rights reserved.
