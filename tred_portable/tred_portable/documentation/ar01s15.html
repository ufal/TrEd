<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>15. User Macros</title><link rel="stylesheet" href="blue.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="tred.html" title="TrEd User's Manual"><link rel="up" href="tred.html" title="TrEd User's Manual"><link rel="prev" href="ar01s14.html" title="14. Command-line options"><link rel="next" href="ar01s16.html" title="16. I/O backends"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15. User Macros</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s14.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s16.html">Next</a></td></tr></table><hr></div><div class="section" title="15. User Macros"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="macros"></a>15. User Macros</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ar01s15.html#id577272">15.1. A Macro</a></span></dt><dt><span class="section"><a href="ar01s15.html#id577427">15.2. Macro files</a></span></dt><dt><span class="section"><a href="ar01s15.html#macroencodings">15.3. Using various character encodings</a></span></dt><dt><span class="section"><a href="ar01s15.html#id577902">15.4. Conditional macro code</a></span></dt><dt><span class="section"><a href="ar01s15.html#bindings">15.5. Associating macros with menu entries and keyboard shortcuts</a></span></dt><dt><span class="section"><a href="ar01s15.html#id578417">15.6. When macro ends</a></span></dt><dt><span class="section"><a href="ar01s15.html#id578758">15.7. Accessing tree nodes</a></span></dt><dt><span class="section"><a href="ar01s15.html#defaultmacros">15.8. Public API: pre-defined macros</a></span></dt><dt><span class="section"><a href="ar01s15.html#hooks">15.9. Hooks: automatically executed macros</a></span></dt><dt><span class="section"><a href="ar01s15.html#contexts">15.10. Using different sets of macros in different situations</a></span></dt></dl></div><p>
      This section describes in detail
      <span class="application">TrEd</span>'s support for user macros
      and is dedicated mainly to programmers.
    </p><p>
      As was already mentioned, <span class="application">TrEd</span> is
      itself written in Perl and therefore it is natural that also
      user macros are written in the Perl language. The details of the
      Perl language syntax are not described here. You may find
      them in various literature on programming in Perl as well as in
      manual pages of Perl language. A large volume of documentation
      on Perl and many specific Perl modules is collected for example
      by <a class="ulink" href="http://www.activestate.com/ASPN/Reference" target="_top">ActiveState</a>.
      In this text, we concentrate on the 
      <span class="application">TrEd</span>'s macro
      specifics only.
    </p><div class="section" title="15.1. A Macro"><div class="titlepage"><div><div><h3 class="title"><a name="id577272"></a>15.1. A Macro</h3></div></div></div><p>
	A macro for <span class="application">TrEd</span> is simply a Perl
	routine defined using the <code class="literal">sub
	  <em class="replaceable"><code>name</code></em> { ... }</code>
	construct, e.g.:
      </p><pre class="programlisting">sub my_first_macro {
 print "Hallo World\n";
}</pre><p>
	Macros may be called from other macros in the same way as
	any other sub-routines in Perl, for example:
      </p><pre class="programlisting">sub my_first_macro {
	my_second_macro();  # call to another macro
}</pre><p>
	In this case, macros may use the usual Perl mechanisms
	to pass any number of argumens to the called macro.
      </p><p>
	To make the macro accessible from
	<span class="application">TrEd</span>, two more things should be
	done. First, a special <span class="quote">&#8220;<span class="quote">binding directive</span>&#8221;</span> can be added,
	so that the macro is associated with a keyboard shortcut
	and/or
	added to the list of named macros and filed under
	the <span class="guimenu">Macros</span> menu under a short descriptive name, where users can easily find and invoke it.
	Second, the macro
	must be stored in some file and
	<span class="application">TrEd</span>
	must be told where to look for the file. This (and more) is
	discussed in the following sections.
      </p></div><div class="section" title="15.2. Macro files"><div class="titlepage"><div><div><h3 class="title"><a name="id577427"></a>15.2. Macro files</h3></div></div></div><p>
	On startup, <span class="application">TrEd</span>
	looks for two files with macros.
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The default set of macros (described in more detail
	      in <a class="xref" href="ar01s15.html#defaultmacros" title="15.8. Public API: pre-defined macros">Section 15.8, &#8220;Public API: pre-defined macros&#8221;</a>)
	      <code class="filename">tred.def</code>
	    </p></li><li class="listitem"><p>The set of extension macros <code class="filename">tred.mac</code>
	      or any other file given after the
	      <em class="parameter"><code>-m</code></em> parameter on the command line 
	      or a file specified in the
	      <span class="application">TrEd</span>'s configuration
	      option <code class="literal">MacroFile</code>.	      
	    </p></li></ol></div><p>
	Developers of macros should never modify the
	<code class="filename">tred.def</code> file directly.
	In theory, 
	the file <code class="filename">tred.mac</code> can be modified when
	preparing a customized installation of TrEd, but it is seldom needed.
	In fact, in the current development model, the file <code class="filename">tred.mac</code>
	plays the role of a testing ground for macros that are supposed to eventually make it into 
	<code class="filename">tred.def</code> but whose API is not yet guaranteed to remain unchanged.
	It also creates initial keyboard and menu bindings for the <code class="literal">TredMacro</code> annotation
	mode (see <a class="xref" href="ar01s15.html#contexts" title="15.10. Using different sets of macros in different situations">Section 15.10, &#8220;Using different sets of macros in different situations&#8221;</a>).
      </p><p>
	Instead, the developers of macros are encouraged either to place
	their macros into an 
	<a class="link" href="ar01s17.html" title="17. Extension Packages">extension package</a>,
	or to create a subfolder with a <code class="filename">contrib.mac</code> file
	in <code class="filename">tredlib/contrib/</code>, e.g. <code class="filename"><em class="replaceable"><code>tredlib/contrib/subdir_name</code></em>/contrib.mac</code>, which will be automatically included into <code class="filename">tred.mac</code>
	(the standard version of <code class="filename">tred.mac</code>
	includes the file <code class="filename">tredlib/contrib/contrib.mac</code>
	which in turn does a wildcard include of <code class="filename">*/contrib.mac</code>,
	as described below).
      </p><p>
	One Macro file may be included into other macro file
	using one of the following
	<code class="literal">#include</code> directives where
	<em class="replaceable"><code>filename</code></em> is supposed to provide
	a relative or absolute path to the macro file, under the
	terms described below:
      </p><div class="variablelist"><dl><dt><span class="term"><code class="literal">#include "<em class="replaceable"><code>filename</code></em>"</code></span></dt><dd><p>The <em class="replaceable"><code>filename</code></em> must be
	      relative to the directory of the file to which it is
	      included.
	    </p></dd><dt><span class="term"><code class="literal">#include &lt;<em class="replaceable"><code>filename</code></em>&gt;</code></span></dt><dd><p>The <em class="replaceable"><code>filename</code></em> must
	      be relative to the TrEd's library directory.</p></dd><dt><span class="term"><code class="literal">#include "&lt;<em class="replaceable"><code>wildcard</code></em>&gt;"</code></span></dt><dd><p>Expands <em class="replaceable"><code>wildcard</code></em> 
	      relatively to the directory of the file containing the
	      directive and includes all matching file.</p></dd><dt><span class="term"><code class="literal">#include <em class="replaceable"><code>filename</code></em></code></span></dt><dd><p>
	      The <em class="replaceable"><code>filename</code></em> may be
	      both absolute or relative. In the latter case the directories are
	      searched in the following order:
	      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Current directory is searched.</p></li><li class="listitem"><p>The directory of the file where the
		    <code class="literal">#include</code> directive occured
		    is searched.
		  </p></li><li class="listitem"><p><span class="application">TrEd</span>'s library directory
		    is searched.
		  </p></li></ol></div><p>
	    </p></dd></dl></div><p>
	If <code class="literal">#include</code> fails to find given file,
	it is a fatal error and
	<span class="application">TrEd</span>/<span class="application">bTrEd</span>
	immediatelly stops. You may use
	<code class="literal">#ifinclude</code> directive, if you wish
	<code class="literal">TrEd</code> to continue (without error or warning)
	even if the requested file was not found.
      </p></div><div class="section" title="15.3. Using various character encodings"><div class="titlepage"><div><div><h3 class="title"><a name="macroencodings"></a>15.3. Using various character encodings</h3></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This section applies only to <span class="application">TrEd</span>/<span class="application">bTrEd</span> running under Perl 5.8
	and higher.</p></div><p>
	If non-ASCII characters should occur in macro code, it is
	necessary to indicate the character encoding used.  Otherwise
	<span class="application">TrEd</span> wouldn't be able to translate the non-ASCII characters
	into an internal Unicode representation.  Failing to indicate
	encoding used in macro code can therefore lead to unexpected
	behaviour of the code and/or fatal run-time errors.
      </p><p>
	By default, <span class="application">TrEd</span> 
	expects UTF-8 encoded macro code (unless specified
	otherwise using the <a class="link" href="ar01s13.html#defaultmacroencoding">
	  <code class="literal">defaultMacroEncoding</code> configuration option</a>).
	Any other character encoding must be indicated using
	<code class="literal">#encoding</code> directive, followed by name of
	the encoding, such as <code class="literal">utf-8</code>,
	<code class="literal">iso-8859-1</code>, <code class="literal">windows-1256</code>,
	etc. The encoding indicated by an <code class="literal">#encoding</code>
	directive applies on the macro file strating from the line following the directive
	to the end of the file or to another <code class="literal">#encoding</code>
	directive occurence, whichever happens first. Encoding directive does not
	apply to included macro files.
      </p><div class="example"><a name="id577888"></a><p class="title"><b>Example 2. Indicating macro character encoding</b></p><div class="example-contents"><pre class="programlisting">
  (UTF-8 encoded macro code)

#encoding iso-8859-2
  
  (latin-2 encoded macro code)

#encoding utf-8

  (UTF-8 encoded macro code continues)
	</pre></div></div><br class="example-break"></div><div class="section" title="15.4. Conditional macro code"><div class="titlepage"><div><div><h3 class="title"><a name="id577902"></a>15.4. Conditional macro code</h3></div></div></div><p>
	If macro code is spanned across	several files or is shared
	between <span class="application">TrEd</span> and
	<span class="application">bTrEd</span>, it may be useful
	to make some parts of the macro code (such as an
	<code class="literal">#include</code> directive) conditional.
      </p><p>
	For this purpose <span class="application">TrEd</span>,
	provides similar mechanisms as standard <code class="literal">C</code>
	pre-processors using
	<code class="literal">#define</code>,
	<code class="literal">#undefine</code>,
	<code class="literal">#ifdef</code>,
	<code class="literal">#ifndef</code>, and
	<code class="literal">#endif</code> directives.
	These directives must appear on the very beginning of line.
	Any code enclosed within
	</p><div class="literallayout"><p>#ifdef	<em class="replaceable"><code>symbol-name</code></em></p></div><p> 
	and </p><div class="literallayout"><p>#endif</p></div><p> directives
	is included if and only if
	the symbol <code class="literal"><em class="replaceable"><code>symbol-name</code></em></code>
	was previously defined using a <code class="literal">#define
	<em class="replaceable"><code>symbol-name</code></em></code>
	directive. 
	Any code enclosed within
	</p><div class="literallayout"><p>#ifndef <em class="replaceable"><code>symbol-name</code></em></p></div><p> 
	and </p><div class="literallayout"><p>#endif</p></div><p> directives
	is included if and only if
	the symbol <code class="literal"><em class="replaceable"><code>symbol-name</code></em></code>
	is not defined.
	A defined
	symbol can later be undefined 
	with <code class="literal">#undefine
	<em class="replaceable"><code>symbol-name</code></em></code>.
	Unlike <code class="literal">C</code> macros,
	symbols in <span class="application">TrEd</span> have no other
	purpose than this.
      </p><p>
	Except for symbols defined by a <code class="literal">#define</code>
	directive, symbol <code class="literal">TRED</code> is always initially
	defined in <span class="application">TrEd</span>, symbol
	<code class="literal">BTRED</code> is always initially defined in
	<span class="application">bTrEd</span>. This may help to simplify
	sharing macro code with specific parts for
	<span class="application">TrEd</span> and
	<span class="application">bTrEd</span> between these two
	applications.
      </p></div><div class="section" title="15.5. Associating macros with menu entries and keyboard shortcuts"><div class="titlepage"><div><div><h3 class="title"><a name="bindings"></a>15.5. Associating macros with menu entries and keyboard shortcuts</h3></div></div></div><p>
	The last set of directives is used to 
	associate a macro with a keyboard shortcut
	and to add it to the list of macros and 
	and the <span class="guimenu">Macros</span> menu under a short descriptive name, so that the user can easily find and invoke it.
      </p><p>
	To connect a macro named <code class="literal">my_first_macro</code> with a 
	new entries labeled <span class="guimenuitem">My First
	Macro</span>
	in the
	<span class="guisubmenu">Macros</span> &#8594; <span class="guimenuitem">List of Macros...</span>
	dialog and also in the menu 
	<span class="guisubmenu">Macros</span> &#8594; <span class="guisubmenu">All Modes</span> &#8594; <span class="guimenuitem"><em class="replaceable"><code>mode</code></em></span>,
	the following directive should appear in some macro
	file read by <span class="application">TrEd</span>:
      </p><div class="literallayout"><p>#insert <em class="replaceable"><code>my_first_macro</code></em> as menu <em class="replaceable"><code>My First Macro</code></em></p></div><p>
	Actually the words <code class="literal">as</code> and
	<code class="literal">menu</code> may be omitted, so it is
	possible to write the above directive also as:
      </p><div class="literallayout"><p>#insert <em class="replaceable"><code>my_first_macro</code></em> as <em class="replaceable"><code>My First Macro</code></em></p></div><p>or even</p><div class="literallayout"><p>#insert <em class="replaceable"><code>my_first_macro</code></em> <em class="replaceable"><code>My First Macro</code></em></p></div><p>
	Association between a macro and a keyboard shortcut is defined
	using the directive <code class="literal">#bind</code>.
	For example, to <span class="quote">&#8220;<span class="quote">bind</span>&#8221;</span> a macro named
	<code class="literal">my_first_macro</code> to say
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>Del</strong></span>
	keyboard shortcut, the following line should appear somewhere
	in the macro file:
      </p><div class="literallayout"><p>#bind <em class="replaceable"><code>my_first_macro</code></em> to key <em class="replaceable"><code>Ctrl+Alt+Del</code></em></p></div><p>
	Again, the <code class="literal">to</code> and
	<code class="literal">key</code> keywords may be omitted.	
      </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	  Using the particular shortcut chosen here as a funny example
	  is a silly idea indeed, since this very shortcut is typicaly
	  used to restart the system. Remember that only shortcuts
	  that are not interpreted by the operating system or the
	  desktop environment can possibly work as expected.
	</p></div><p>Both a menu item and a keyboard shortcut can be associated
	with a macro in one step with a directive of the following :
      </p><div class="literallayout"><p>#bind <em class="replaceable"><code>my_first_macro</code></em> to key <em class="replaceable"><code>Ctrl+Alt+Del</code></em> menu <em class="replaceable"><code>My First Macro</code></em></p></div><p>
	If more than one keyboard shortcut or menu item are associated
	with the same macro, any of them may be used to invoke the
	macro. If more than one macro was associated with the same
	keyboard shortcut, then the latest binding is used.  Also, if
	two or more macros with the same name appear in the loaded
	macro files (within the same package), the last one is used,
	but that holds in general for any Perl subroutine.
      </p><div class="literallayout"><p>#unbind-key <em class="replaceable"><code>Ctrl+Alt+Del</code></em></p></div><div class="literallayout"><p>#remove-menu <em class="replaceable"><code>My First Macro</code></em></p></div><p>
	The first of the  directives above removes an existing key-bindning from
	current annotation mode(s). The second one removes an existing menu entry
	from the macro menu
	of the current annotation mode (<span class="guisubmenu">Macros</span> &#8594; <span class="guisubmenu">All Modes</span> &#8594; <span class="guimenuitem"><em class="replaceable"><code>annotation mode</code></em></span>).
	These directives is especially useful for disabling certain functionality and bindings of an incuded
	macro file.
      </p></div><div class="section" title="15.6. When macro ends"><div class="titlepage"><div><div><h3 class="title"><a name="id578417"></a>15.6. When macro ends</h3></div></div></div><p>
	When an interactively invoked macro returns, <span class="application">TrEd</span> performs the following
	steps:
	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>the node referenced in <code class="literal">$this</code>
	      is activated in the current view (provided it belongs to
	      the current tree)
	    </p></li><li class="listitem"><p>
	      all views are redrawn (unless specified otherwise in the
	      variable<code class="literal">$Redraw</code>), see
	      below.
	    </p></li><li class="listitem"><p>
	      unless the value of the variable <code class="literal">$FileChanged</code> (see <a class="xref" href="ar01s15.html#defaultmacros" title="15.8. Public API: pre-defined macros">Section 15.8, &#8220;Public API: pre-defined macros&#8221;</a>) is set to 0,
	      the save-status of the current file is turned to <code class="literal">modified</code>
	      (as indicated by the state of the
		<span class="inlinemediaobject"><img src="pics/filesave.png" alt="save-file"></span>
		button). 
	    </p></li></ul></div><p>
      </p><p>
	The variable <code class="literal">$Redraw</code> may have the following
	values:
	</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">file</code> (the default)</span></dt><dd><p>redraw all windows displaying current file</p></dd><dt><span class="term"><code class="literal">tree</code></span></dt><dd><p>redraw all windows displaying current tree</p></dd><dt><span class="term"><code class="literal">win</code></span></dt><dd><p>redraw current window</p></dd><dt><span class="term"><code class="literal">all</code></span></dt><dd><p>redraw all windows</p></dd><dt><span class="term"><code class="literal">tie</code></span></dt><dd><p>redraw all windows if TrEd windows are tied
		otherwise redraw only the current one</p></dd><dt><span class="term"><code class="literal">none</code></span></dt><dd><p>disables redrawing</p></dd></dl></div><p>
      </p><p>
	Because <span class="application">TrEd</span> has no way to identify
	whether the current file (or in fact any other file) was
	actually modified by the macro, it always assumes it was.  To
	prevent this and indicate that no actual changes which would
	require the user to save the file were done to the current
	file, the macro must explicitly set a special variable named
	<code class="literal">$FileChanged</code> to zero.  Even
	better (to prevent accidental collisions between several
	assignments to this variable), instead of directly assigning
	to this variable, call the default macro
	<code class="literal">ChangingFile(0)</code>.
      </p><p>
	To make things more complicated, it should be noted, that
	<span class="command"><strong>btred</strong></span>, the off-line variant of
	TrEd, never saves any processed file unless the variable
	<code class="literal">$FileChanged</code> has been explicitely set to
	<code class="literal">1</code> or <code class="literal">-S</code> command-line
	switch is used. So, conversely, in <span class="command"><strong>btred</strong></span>, a macro
	should indicate making a change worth saving by calling <code class="literal">ChangingFile(1)</code>.
      </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If the state of the file was already
	  <span class="emphasis"><em>modified and not saved</em></span> when a
	  macro was interactively invoked, then any changes to
	  the <code class="literal">$FileChanged</code> variable made
	  by the macro are ignored. Macro may however force the
	  file status to return to <span class="emphasis"><em>saved</em></span>
	  by setting the variable <code class="literal">$forceFileSaved</code>
	  to <code class="literal">1</code> (typically after an
	  explicit call to <code class="literal">Save()</code>).
	</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For historical reasons, there exists an alias for
	  <code class="literal">$FileChanged</code> named
	  <code class="literal">$FileNotSaved</code>. These variables are
	  identical.
	</p></div></div><div class="section" title="15.7. Accessing tree nodes"><div class="titlepage"><div><div><h3 class="title"><a name="id578758"></a>15.7. Accessing tree nodes</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ar01s15.html#id578860">15.7.1. Node types</a></span></dt><dt><span class="section"><a href="ar01s15.html#id578948">15.7.2. Accessing node attributes</a></span></dt><dt><span class="section"><a href="ar01s15.html#id579256">15.7.3. Accessing neighboring nodes</a></span></dt><dt><span class="section"><a href="ar01s15.html#id579535">15.7.4. Accessing other trees</a></span></dt></dl></div><p>A tree in <span class="application">TrEd</span> is represented by its root node.
      The root node can be distinguished from other nodes by having no parent node.
      Similarly leaf nodes have no children (see <code class="literal">firstson()</code> method described bellow).
      </p><p>All tree nodes in
      <span class="application">TrEd</span> are represented
      by <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> Perl objects. These objects are
      basically only hash references where the
      attribute-name/attribute-value information is stored as a
      key/value pair (except that some hash keys are reserved for
      representing the tree structure).  
      <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> objects provide several basic
      methods, most of which are related to accessing their neighbouring nodes
      (i.e. traversing the tree) and modifying the tree structure
      by means of cut and paste operations.
      </p><p>Macros usually start from the nodes accessible via
	global variables (these variables are declared in the <code class="literal">TredMacro</code>
	package, but exported by default to any other derived package):
      </p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$this</code></span></dt><dd><p>is the active node in the current tree.
	      Macros may use this variable to access the active node,
	      its attributes, methods etc. They also may assign
	      to this variable to activate a different node.
	    </p></dd><dt><span class="term"><code class="literal">$root</code></span></dt><dd><p>is the root of the current tree.  Macros may use
	      this variable to access the root of the tree and (by
	      following the tree edges) to access the whole tree.
	      Assigning to this variable has no visible effect.
	    </p></dd></dl></div><div class="section" title="15.7.1. Node types"><div class="titlepage"><div><div><h4 class="title"><a name="id578860"></a>15.7.1. Node types</h4></div></div></div><p>
	  Each node may be associated with a PML type
	  (see also <a class="xref" href="ar01s16.html#pml_representation" title="16.6.3. Internal representation of PML data">Section 16.6.3, &#8220;Internal representation of PML data&#8221;</a>)
	  dictating e.g. which the attributes the node may or must carry
	  and for each attribute its data type.
	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    Some older I/O backends do not provide PML-based typing
	    and produce nodes that are untyped.
	    In such a case, the names, types, and roles of the attributes
	    can be
	    obtained from the
	    <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/FSFormat.pm" target="_top"><code class="classname">Treex::PML::FSFormat</code></a> object
	    associated with the document (see below).
	  </p></div><p>
	  The object representation of the data type of a node is returned
	  by the method <code class="literal">$node-&gt;type()</code>
	  (see <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a>).
	  It may be either from the class
	  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Schema/Struct.pm" target="_top"><code class="classname">Treex::PML::Schema::Struct</code></a>
	  (or derived)
	  if the node is represented in PML by a structure
	  or
	  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Schema/Container.pm" target="_top"><code class="classname">Treex::PML::Schema::Container</code></a>
	  (or derived)
	  if the node is represented in PML by a container.
	  To get the object representation of the complete PML schema
	  where the node type is declared
	  (<a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Schema.pm" target="_top"><code class="classname">Treex::PML::Schema</code></a>), one 
	  may call <code class="literal">$node-&gt;type()-&gt;schema()</code>,
	  provided <code class="literal">$node-&gt;type()</code> is known to be defined.
	</p></div><div class="section" title="15.7.2. Accessing node attributes"><div class="titlepage"><div><div><h4 class="title"><a name="id578948"></a>15.7.2. Accessing node attributes</h4></div></div></div><p>
	  Let <code class="literal">$node</code> be a
	  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> object, i.e. a node of the
	  tree. Typically, nodes are attribute-value structures, so the
	  attribute named <code class="literal"><em class="replaceable"><code>attrib</code></em></code>
	  is accessible as <code class="literal">$node-&gt;{<em class="replaceable"><code>attrib</code></em>}</code>.
	  Assigning a different value, say <em class="replaceable"><code>$val</code></em>, to the attribute
	  <code class="literal"><em class="replaceable"><code>attrib</code></em></code> is
	  as simple as this:
	</p><div class="literallayout"><p>$node-&gt;{<em class="replaceable"><code>attrib</code></em>}=$val;</p></div><p>
	  Attribute values may not always be atomic, i.e. numbers or
	  strings (although for most backends this is the case). They
	  may also be AVS structures (represented as
	  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Struct.pm" target="_top"><code class="classname">Treex::PML::Struct</code></a> objects, which are
	  basically just Perl hashes), lists (represented as Perl ARRAY
	  references of the <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/List.pm" target="_top"><code class="classname">Treex::PML::List</code></a> class)
	  and alternatives (represented as Perl ARRAY references of
	  the <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/List.pm" target="_top"><code class="classname">Treex::PML::List</code></a> class). So let's
	  suppose for a while, that the value of <code class="literal">$node-&gt;{<em class="replaceable"><code>attrib</code></em>}</code>
	  is an AVS structure with attribute
	  <em class="replaceable"><code>level2-attrib</code></em> and its value is a
	  list of structures with an attribute
	  <em class="replaceable"><code>level3-attrib</code></em> whose value (of
	  whatever type it is) we want to get and possibly change.  To
	  access the attribute
	  <em class="replaceable"><code>level3-attrib</code></em>, we may either use
	  Perl-only syntax and proceed e.g. as follows:
	  </p><div class="literallayout"><p>$node-&gt;{attrib}{level2-attrib}[0]{level3-attrib}</p></div><p>
	  Notice, that from the list of structures in
	  <em class="replaceable"><code>level2-attrib</code></em> we have only
	  selected the first one (in Perl, array indexes start with
	  0).  This approach has a non-obvious drawback: if on some
	  level the value is not defined, Perl
	  <span class="quote">&#8220;<span class="quote">auto-creates</span>&#8221;</span> an empty structure on that level
	  (this <span class="quote">&#8220;<span class="quote">auto-creation</span>&#8221;</span> continues also for all
	  further levels of the expression). Hence, by querying a
	  value, we have actually made a change. This typically is an
	  undesirable effect. There are two ways to avoid it: first
	  would be to follow the nesting of the Perl structures one
	  level at a time and on every step first check that the value
	  on that level is non-empty. This is however makes the code
	  less readable and unnecessarily complex.  Second method
	  provides the same functionality with a nice syntax using so
	  called <em class="firstterm">attribute-paths</em>.  Attribute
	  path is an expression similar to a directory path or XPath
	  and expresses a path in the nesting of the Perl structures.
	  Using attribute-paths, the expression
	  </p><pre class="programlisting">$node-&gt;{<em class="replaceable"><code>attrib</code></em>}{<em class="replaceable"><code>level2-attrib</code></em>}[0]{<em class="replaceable"><code>level3-attrib</code></em>}</pre><p>
	  could be rewritten as
	  </p><pre class="programlisting">$node-&gt;attr('<em class="replaceable"><code>attrib</code></em>/<em class="replaceable"><code>level2-attrib</code></em>/[1]/<em class="replaceable"><code>level3-attrib</code></em>')</pre><p>
	  The method <code class="methodname">attr</code> resolves
	  attribute-paths safely, avoiding auto-creation of Perl
	  structures on the way. Note, that in the attribute-path,
	  list and alternative members are indexed starting from 1.
	  In fact, if we want to access the 1st element, we may
	  completely skip the index specification and write:
	  </p><pre class="programlisting">$node-&gt;attr(<em class="replaceable"><code>'attrib</code></em>/<em class="replaceable"><code>level2-attrib</code></em>/<em class="replaceable"><code>level3-attrib</code></em>')</pre><p>
	  Sometimes it is necessary to iterate over all list members
	  of some attributes. The macro <code class="literal">ListV</code> (and
	  its cousin macro <code class="literal">AltV</code> used for
	  alternatives) can be used to produce a list of all values of
	  a given attribute, e.g.  </p><pre class="programlisting">foreach my $member
	  (ListV($node-&gt;attr('<em class="replaceable"><code>attrib</code></em>/<em class="replaceable"><code>level2-attrib</code></em>')))
	  { # process list member $member print
	  $member-&gt;{<em class="replaceable"><code>level3-attrib</code></em>},"\n";
	  }</pre><p>
	</p><p>Values of attributes can be changed by pure Perl
	assignments, e.g.
	  </p><pre class="programlisting">$node-&gt;{<em class="replaceable"><code>attrib</code></em>} = <em class="replaceable"><code>new_value</code></em>;</pre><p>
	  or
	  </p><pre class="programlisting">$node-&gt;{<em class="replaceable"><code>attrib</code></em>}{<em class="replaceable"><code>level2-attrib</code></em>}[0]{<em class="replaceable"><code>level3-attrib}</code></em> = <em class="replaceable"><code>new_value</code></em></pre><p>
	  The previous assign ment may also be achieved using
	  </p><pre class="programlisting">$node-&gt;set_attr('<em class="replaceable"><code>attrib</code></em>/<em class="replaceable"><code>level2-attrib</code></em>/[1]/<em class="replaceable"><code>level3-attrib</code></em>',<em class="replaceable"><code>new_value</code></em>);</pre><p>
	</p><p>The macro <code class="literal">List</code> can be used to
	  construct a new list value. Several other default macros for
	  dealing with list and alternative values exists (see <a class="xref" href="ar01s15.html#defaultmacros" title="15.8. Public API: pre-defined macros">Section 15.8, &#8220;Public API: pre-defined macros&#8221;</a>).</p></div><div class="section" title="15.7.3. Accessing neighboring nodes"><div class="titlepage"><div><div><h4 class="title"><a name="id579256"></a>15.7.3. Accessing neighboring nodes</h4></div></div></div><p>
	  There is a few methods provided by every
	  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> reference that can be used
	  to access other nodes in the tree. Each of the methods
	  returns either a <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> reference
	  pointing to the requested node, or zero if 
	  the requested node does not exist. For example, the
	  following code may be used to make the active node's
	  parent node active:
	</p><pre class="programlisting">$this = $this-&gt;parent if ($this-&gt;parent);</pre><p>
	  The above code states: activate the parent node of the
	  currently active node in case the currently active node
	  has a parent.
	</p><p>
	  The following table describes some
	  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> methods.
	  For a complete list, refer to the documentation of <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML.pm" target="_top">Treex::PML.pm</a>.
	</p><div class="table"><a name="fsnode_methods"></a><p class="title"><b>Table 4. <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> methods</b></p><div class="table-contents"><table summary="Treex::PML::Node methods" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">Method name</th><th align="justify">Description</th></tr></thead><tbody><tr><td align="left"><code class="literal">parent</code></td><td align="justify">Return node's parent node.</td></tr><tr><td align="left"><code class="literal">firstson</code></td><td align="justify">Return the first child node of the given node
		  (the first node depending on the given node).</td></tr><tr><td align="left"><code class="literal">rbrother</code></td><td align="justify">
		  Return the right
		  brother of the given node. However, hence the nodes
		  may be displayed in the order given by the special
		  FS-format numbering attribute <code class="literal">@N</code>,
		  the returned node need not necessarily be displayed to
		  the right of the given node. This is because the
		  ordering according to the special numbering attribute
		  does not have to correspond to the deep-first structure
		  ordering of the tree.
		</td></tr><tr><td align="left"><code class="literal">lbrother</code></td><td align="justify">
		  Return the left
		  brother of the given node. However, as for the 
		  right brother, hence the nodes
		  may be displayed in the order given by the special
		  FS-format numbering attribute <code class="literal">@N</code>,
		  the returned node need not necessarily be displayed to
		  the left of the given node. This is because the
		  ordering according to the special numbering attribute
		  does not have to correspond to the deep-first structure
		  ordering of the tree.
		</td></tr><tr><td align="left"><code class="literal">following(<em class="replaceable"><code>top</code></em>?)</code></td><td align="justify">
		  Return the next node of the given node in the
		  natural ordering of the tree provided by the
		  tree structure. E.g. if the given node has a child,
		  this child is returned. If the node has no childs
		  but does have a right brother,
		  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a>
		  reference to the right brother is returned.
		  If no child and no right brother exists for the
		  given node, the method looks for a right brother
		  of its nearest ancestor, etc. Starting from the root
		  of the tree and calling this method repeatedly
		  on the returned nodes ensures that all the nodes
		  in the trees are accessed during the procedure.
		  If the optional argument <em class="replaceable"><code>top</code></em>
		  contains a <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> reference,
		  the searching is limited to the subtree governed by 
		  the node of <em class="replaceable"><code>top</code></em>.
		</td></tr><tr><td align="left"><code class="literal">previous(<em class="replaceable"><code>top</code></em>?)</code></td><td align="justify">
		  Return the previous node of the given node in the
		  deep-first ordering of the tree provided by the tree
		  structure (see the above description of the
		  <code class="literal">following</code>
		  method for more detail on the ordering).
		  If the optional argument <em class="replaceable"><code>top</code></em>
		  contains a <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a> reference,
		  the searching is limited to the subtree governed by 
		  the node of <em class="replaceable"><code>top</code></em>.
		</td></tr><tr><td align="left"><code class="literal">children</code></td><td align="justify">
		  Return a list of all child-nodes of the given node.
		  The nodes in the list are ordered in their
		  structural order starting from the first son of their parent,
		  each node followed by its right brother.
		</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="15.7.4. Accessing other trees"><div class="titlepage"><div><div><h4 class="title"><a name="id579535"></a>15.7.4. Accessing other trees</h4></div></div></div><p>
	  For this purpose many default macros exist and we recommend
	  read their documentation first (see <a class="xref" href="ar01s15.html#defaultmacros" title="15.8. Public API: pre-defined macros">Section 15.8, &#8220;Public API: pre-defined macros&#8221;</a>). In this section we describe more
	  low-level approach that utilizes one of the most fundamental
	  internal structures used by <span class="application">TrEd</span>,
	  namely the <span class="quote">&#8220;<span class="quote">grouping</span>&#8221;</span> structure. This structure
	  may be accessed using the <code class="literal">$grp</code> variable.  There is really a
	  lot of things that can be achieved by using this variable in
	  a proper way, but because it is an open gate to
	  <span class="application">TrEd</span> internals, it may also be
	  dangerous. Here, we only pay our attention to a few of the
	  safe features of <code class="literal">$grp</code>. In most cases,
	  using wrappers over this structure provided by default
	  macros, is still a much safer option.
	</p><p>
	  The current file is accessed via the
	  <code class="literal">CurrentFile()</code> reference. This reference
	  is a pointer to an object of the <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Document.pm" target="_top"><code class="classname">Treex::PML::Document</code></a>
	  class. The following methods are provided for the class:
	</p><div class="table"><a name="fsfile_methods"></a><p class="title"><b>Table 5. <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Document.pm" target="_top"><code class="classname">Treex::PML::Document</code></a> class methods</b></p><div class="table-contents"><table summary="Treex::PML::Document class methods" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">Method name</th><th align="justify">Description</th></tr></thead><tbody><tr><td align="left"><code class="literal">filename</code></td><td align="justify">Returns current file's name.</td></tr><tr><td align="left"><code class="literal">changeFilename(<em class="replaceable"><code>name</code></em>)</code></td><td align="justify">Change current file's name.</td></tr><tr><td align="left"><code class="literal">FS</code></td><td align="justify">Return a reference to an associated
		  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/FSFormat.pm" target="_top"><code class="classname">Treex::PML::FSFormat</code></a> object.
		</td></tr><tr><td align="left"><code class="literal">trees</code></td><td align="justify">Return a list of all trees (i.e.
		  a list of <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a>
		  object references pointing to the roots
		  of the trees).
		</td></tr><tr><td align="left"><code class="literal">hint</code></td><td align="justify">Return the <span class="application">TrEd</span>'s
		hint pattern associated with the file.</td></tr><tr><td align="left"><code class="literal">changeHint(<em class="replaceable"><code>pattern</code></em>)</code></td><td align="justify">Change the <span class="application">TrEd</span>'s
		  hint pattern associated with the file.
		</td></tr><tr><td align="left"><code class="literal">pattern(<em class="replaceable"><code>n</code></em>)</code></td><td align="justify">Return the <em class="replaceable"><code>n</code></em>'th 
		  attribute pattern associated with the file.</td></tr><tr><td align="left"><code class="literal">patterns</code></td><td align="justify">Return a list of all attribute patterns
		associated with the file.</td></tr><tr><td align="left"><code class="literal">pattern_count</code></td><td align="justify">Return the number of display attribute patterns
		associated with the file.</td></tr><tr><td align="left"><code class="literal">changePatterns(<em class="replaceable"><code>patterns</code></em>)</code></td><td align="justify">Change the list of  attribute patterns
		  associated with the file.</td></tr></tbody></table></div></div><br class="table-break"><p>
	  Actually, some other <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Document.pm" target="_top"><code class="classname">Treex::PML::Document</code></a> methods
	  exist, but as they are not intended to be used from the
	  macros directly, there is no reason to describe them here.
	</p><p>
	  The most important of the methods above is the <code class="literal">FS</code> method which may be used to
	  access the <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/FSFormat.pm" target="_top"><code class="classname">Treex::PML::FSFormat</code></a> class object
	  associated with the given file. Similarly as in the case of
	  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Document.pm" target="_top"><code class="classname">Treex::PML::Document</code></a> class, only the most importand
	  methods of the <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/FSFormat.pm" target="_top"><code class="classname">Treex::PML::FSFormat</code></a> class are
	  described here.
	</p><div class="table"><a name="id579878"></a><p class="title"><b>Table 6. <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/FSFormat.pm" target="_top"><code class="classname">Treex::PML::FSFormat</code></a> class methods</b></p><div class="table-contents"><table summary="Treex::PML::FSFormat class methods" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">Method name</th><th align="justify">Description</th></tr></thead><tbody><tr><td align="left"><a name="FS.order"></a><code class="literal">order</code></td><td align="justify">Return the name of the special numerical FS attribute
		  responsible for providing the tree order. This
		  attribute is declared in the FS file as <code class="literal">@N</code>.
		</td></tr><tr><td align="left"><a name="FS.sentord"></a><code class="literal">sentord</code></td><td align="justify">Return the name of the special numerical FS attribute
		  responsible for providing the order of the values
		  to form a <span class="quote">&#8220;<span class="quote">sentence</span>&#8221;</span>. This
		  attribute is declared in the FS file as
		  <code class="literal">@W</code>.
		</td></tr><tr><td align="left"><a name="FS.value"></a><code class="literal">value</code></td><td align="justify">Return the name of the special FS attribute
		  providing a descriptive value of the node used when
		  forming a <span class="quote">&#8220;<span class="quote">sentence</span>&#8221;</span>. This
		  attribute is declared in the FS file as
		  <code class="literal">@V</code>.</td></tr><tr><td align="left"><code class="literal">hide</code></td><td align="justify">Return the name of the special FS attribute
		  which can be used for hiding subtrees. This
		  attribute is declared in the FS file as
		  <code class="literal">@H</code>; a subtree is
		  hidden if its governing node's value for this
		  attribute is <code class="literal">'hide'</code> or
		  <code class="literal">1</code>.</td></tr><tr><td align="left"><code class="literal">isHidden(<em class="replaceable"><code>node</code></em>)</code></td><td align="justify">Return true if the given <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top"><code class="classname">Treex::PML::Node</code></a>
		<em class="replaceable"><code>node</code></em> belongs to a hidden subtree.
		</td></tr><tr><td align="left"><code class="literal">isList(<em class="replaceable"><code>attr</code></em>)</code></td><td align="justify">Return true if the given attribute is of list
		  type with a strictly defined set of possible
		  values. This type of attributes is declared by
		  the <code class="literal">@L</code> header in the FS format.
		</td></tr><tr><td align="left"><code class="literal">listValues(<em class="replaceable"><code>attr</code></em>)</code></td><td align="justify">Return a list of all possible values for the
		given attribute <em class="replaceable"><code>attr</code></em>. Empty
		list is retured in case the attribute is not of the
		list type.
		</td></tr><tr><td align="left"><code class="literal">color(<em class="replaceable"><code>attr</code></em>)</code></td><td align="justify">
		  Return one of the <code class="literal">Shadow</code>,
		  <code class="literal">Hilite</code>,
		  <code class="literal">XHilite</code> and
		  <code class="literal">normal</code>
		  values, depending on the
		  color specified in the FS file header.
		  See also <a class="link" href="ar01s13.html#usefscolors">UseFSColors</a> configuration option.
		</td></tr><tr><td align="left"><code class="literal">attributes</code></td><td align="justify">Return a list containing names of all the
		attributes declared in the FS file header.</td></tr><tr><td align="left"><code class="literal">atno(<em class="replaceable"><code>n</code></em>)</code></td><td align="justify">Return name of the
		  <em class="replaceable"><code>n</code></em>'th
		  attribute.
		</td></tr><tr><td align="left"><code class="literal">indexOf(<em class="replaceable"><code>attr</code></em>)</code></td><td align="justify">Return index of the attribute named 
		  <em class="replaceable"><code>attr</code></em>, according
		  to the order in which attributes are defined in the
		  FS file.
		</td></tr><tr><td align="left"><code class="literal">count</code></td><td align="justify">Return the number of attributes defined in the FS file.</td></tr><tr><td align="left"><code class="literal">exists(<em class="replaceable"><code>attr</code></em>)</code></td><td align="justify">Return true if attribute named
		  <em class="replaceable"><code>attr</code></em> exists for the FS
		  file. If it is not the case, false (i.e. zero) is returned.
		</td></tr><tr><td align="left"><code class="literal">make_sentence(<em class="replaceable"><code>root_node</code></em>)</code></td><td align="justify">Return a string forming a
		  <span class="quote">&#8220;<span class="quote">sentence</span>&#8221;</span> for the given node's subtree. 
		  The sentence is formed in the following way:
		  <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
			All the nodes of the
			<em class="replaceable"><code>root_node</code></em> node's
			subtree and ordered according to their values
			for the special numerical FS sentence ordering
			attribute (see method <a class="link" href="ar01s15.html#FS.sentord"><code class="literal">sentord</code></a>
			above). The special FS numbering attribute
			(see method <a class="link" href="ar01s15.html#FS.order"><code class="literal">order</code></a>
			above) is used if no sentence ordering
			attribute is declared in the FS file.
		      </p></li><li class="listitem"><p>
			For every such node, its descriptive value
			(see
			method <a class="link" href="ar01s15.html#FS.order"><code class="literal">value</code></a>
			above) is taken.
		      </p></li><li class="listitem"><p>
			The values obtained in this way and order
			are joined into a single string with fields
			separated by the value of
			<em class="replaceable"><code>separator</code></em>.  </p></li></ol></div>
		</td></tr></tbody></table></div></div><br class="table-break"><p>
	  The methods <code class="literal">sentord</code>,
	  <code class="literal">order</code>,
	  <code class="literal">value</code>, and
	  <code class="literal">hide</code> described above
	  are useful especially in macros of
	  general purposes, where names of the corresponding
	  attributes are not known in advance
	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    In PML there is no equivalent of 
	    <code class="literal">sentord</code>, <code class="literal">value</code> and <code class="literal">hide</code>.
	    Nodes associated with a PML type implement
	    the methods 
	    <code class="literal">$node-&gt;get_ordering_member_name()</code>
	    and
	    <code class="literal">$node-&gt;get_order()</code>
	    to get the name and value of their ordering attribute
	    (i.e. associated with PML role #ORDER).
	  </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Calling the FSFormat methods
	  <code class="literal">sentord</code>,
	  <code class="literal">order</code>,
	  <code class="literal">value</code>, and
	  <code class="literal">hide</code>
	  (as well as Node methods
	  <code class="literal">get_order</code> and
	  <code class="literal">get_ordering_member_name</code>
	  too many times (e.g. in a sort or map operations on a set of nodes)
	  may result in bad performence,
	  so it is recommended to store their return values
	  in local variables. Here is an example:
	</p><div class="informalexample"><pre class="programlisting">
  my $ord    = FS()-&gt;sentord or FS()-&gt;order;
  my $value  = FS()-&gt;value;
  return join( ' ',
	       map { $_-&gt;{$value} }
	       sort { $a-&gt;{$ord} &lt;=&gt; $b-&gt;{$ord} } GetDisplayedNodes() );
	  </pre></div><p>
	  If the values of <code class="literal">value</code>, <code class="literal">sentord</code> or
	  possibly <code class="literal">order</code> were evaluated each
	  time the Perl <code class="literal">sort</code> or
	  <code class="literal">map</code> function needs to compare or map
	  nodes, the performance of the code would considerably decrease.
	</p></div></div></div><div class="section" title="15.8. Public API: pre-defined macros"><div class="titlepage"><div><div><h3 class="title"><a name="defaultmacros"></a>15.8. Public API: pre-defined macros</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ar01s15.html#id514304">15.8.1. Global variables</a></span></dt><dt><span class="section"><a href="ar01s15.html#id587646">15.8.2. Navigation</a></span></dt><dt><span class="section"><a href="ar01s15.html#id592230">15.8.3. Tree editing API</a></span></dt><dt><span class="section"><a href="ar01s15.html#id592861">15.8.4. Helper macros for attributes with list or alternatives of values</a></span></dt><dt><span class="section"><a href="ar01s15.html#id593212">15.8.5. General-purpose list functions</a></span></dt><dt><span class="section"><a href="ar01s15.html#id593293">15.8.6. GUI-related macros</a></span></dt><dt><span class="section"><a href="ar01s15.html#id593809">15.8.7. Create/modify keyboard shortcuts</a></span></dt><dt><span class="section"><a href="ar01s15.html#id594044">15.8.8. Stylesheet API</a></span></dt><dt><span class="section"><a href="ar01s15.html#id594370">15.8.9. Context API</a></span></dt><dt><span class="section"><a href="ar01s15.html#id594422">15.8.10. Treex::PML::FSFormat API</a></span></dt><dt><span class="section"><a href="ar01s15.html#id594548">15.8.11. Treex::PML::Document I/O API</a></span></dt><dt><span class="section"><a href="ar01s15.html#id595162">15.8.12. General I/O macros</a></span></dt><dt><span class="section"><a href="ar01s15.html#sect-0">15.8.13. Printing trees</a></span></dt><dt><span class="section"><a href="ar01s15.html#id595864">15.8.14. Other macros</a></span></dt><dt><span class="section"><a href="ar01s15.html#id595898">15.8.15. Implementation of TredMacro::import</a></span></dt><dt><span class="section"><a href="ar01s15.html#id595960">15.8.16. XPath extension (slow)</a></span></dt></dl></div><p>
	The role of a public API available to macros is played by a set of
	macros defined in the <code class="literal">TredMacro</code> package
	in the file named <code class="filename">tred.def</code>.
	Most of these pre-defined macros are just safe wrappers for 
	<span class="application">TrEd</span> internal function
	calls. Pre-defined macros and object methods (namely those of
	<code class="literal"><a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top">Treex::PML::Node</a></code>, <code class="literal">Treex::PML::Document</code> and
	<a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/FSFormat.pm" target="_top"><code class="classname">Treex::PML::FSFormat</code></a> should be the only access points
	used by a macro to interact with <span class="application">TrEd</span>. 
	All other ways of creeping into <span class="application">TrEd</span>'s
	internals are dangerous and should be avoided.
      </p><div class="section" title="15.8.1. Global variables"><div class="titlepage"><div><div><h4 class="title"><a name="id514304"></a>15.8.1. Global variables</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">$this</code></span></dt><dd><p>
Current node (i.e. the active node in TrEd and the node in turn if
<code class="literal">-N</code> or <code class="literal">-H</code> flag was used in bTrEd). Assigning a different node
from the current tree to this variable results in changing the active
node in TrEd and continuing processing at that node in bTrEd.
</p></dd><dt><span class="term"><code class="literal">$root</code></span></dt><dd><p>
Root of the current tree. If possible, avoid changing this variable in
a macro, so that called macros may rely on its value too.
</p></dd><dt><span class="term"><code class="literal">$FileChanged</code> (alias <code class="literal">$FileNotSaved</code> - still valid but obsolete)</span></dt><dd><p>
See also <code class="literal">ChangingFile()</code>.
</p><p>
If this variable is set to 1, TrEd/bTrEd considers the current file to
be modified and in case of bTrEd makes the program to save it before
it is closed (in case of TrEd, user is prompted before the file is
closed). If the macro does not change this variable, bTrEd does not
change the file status, while TrEd still assumes that the file <span class="emphasis"><em>was</em></span>
modified. In other words, set this variable to 1 in bTrEd if you want
the file to be saved at last, and set this variable to 0 in TrEd if
you are sure you did not make any change to the file that would be
worth saving it. As there is a danger that calling one macro from
another may result in a mess in the value of <code class="literal">$FileChanged</code> it is
adviced to use the default macro <code class="literal">ChangingFile()</code> which tries to set
the file status only if really intended (see below).
</p></dd><dt><span class="term"><code class="literal">$Redraw</code></span></dt><dd><p>
This variable makes sense only in TrEd.  You may set it to one of
<code class="literal">file</code>, <code class="literal">tree</code>, <code class="literal">win</code>, <code class="literal">all</code>, <code class="literal">tie</code> to alter the mechanism of redrawing the
screen. The default value is <code class="literal">file</code> (redraw all windows displaying
current file), while <code class="literal">tree</code> means redraw all windows displaying
current tree, <code class="literal">win</code> means redraw only current window and <code class="literal">tie</code> means
redraw all if windows are tied or (if not) redraw only current window.
To disable redrawing set this variable to <code class="literal">none</code>.
</p></dd><dt><span class="term"><code class="literal">$forceFileSaved</code></span></dt><dd><p>
In TrEd, you may wish to set this variable to 0 if you wish to change
the status of the file to <code class="literal">saved</code> (e.g. after saving the file from
your macro).
</p></dd><dt><span class="term"><code class="literal">$libDir</code></span></dt><dd><p>
This variable contains a path to TrEd library directory.
</p></dd></dl></div></div><div class="section" title="15.8.2. Navigation"><div class="titlepage"><div><div><h4 class="title"><a name="id587646"></a>15.8.2. Navigation</h4></div></div></div><p>
Methods of <a class="link" href="">Treex::PML::Node</a> 
objects should be used for basic navigation within
trees. Here are described means to navigate from one tree to another
and a few extra macros for specific navigation in trees.
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">GotoTree(n)</code></span></dt><dd><p>
Display the n'th tree in the current file.
The number of the first tree for this function is 1.
</p></dd><dt><span class="term"><code class="literal">TieGotoTree(n)</code></span></dt><dd><p>
Go to n'th tree in all tied windows.
The number of the first tree for this function is 1.
</p></dd><dt><span class="term"><code class="literal">TieNextTree()</code></span></dt><dd><p>
Display the next tree in all tied windows.
</p></dd><dt><span class="term"><code class="literal">TiePrevTree()</code></span></dt><dd><p>
Display the previous tree in all tied windows.
</p></dd><dt><span class="term"><code class="literal">NextTree()</code></span></dt><dd><p>
Display the next tree in the current file.
</p></dd><dt><span class="term"><code class="literal">PrevTree()</code></span></dt><dd><p>
Display the previous tree in the current file.
</p></dd><dt><span class="term"><code class="literal">GetTrees()</code></span></dt><dd><p>
Return a list of trees in current <a class="link" href="">Treex::PML::Document</a>. Equivallent to
<code class="literal">CurrentFile()-&gt;trees</code>.
</p></dd><dt><span class="term"><code class="literal">GetSecondaryFiles($fsfile?)</code></span></dt><dd><p>
Return a list of secondary <a class="link" href="">Treex::PML::Document</a> objects for the given (or current)
file.  A secondary file is a file required by a file to be loaded
along with it; this is typical for files containing some form of a
stand-off annotation where one tree is built upon another. Note
however, that this does not include so called knitting - an operation
where the stand-off annotation is handled by a IO backend and the
resulting knitted file appears to btred as a single unit.
Only those secondary files that are already open are returned.
</p></dd><dt><span class="term"><code class="literal">NextNode(node,top?)</code></span></dt><dd><p>
Return the first displayed node following the given node in the
subtree of top. This function behaves in the same manner as the
node-&gt;following(top) method, except it works only on the nodes which
are actually visible according to the state of the View-&gt;Show Hidden
Nodes menu item.
</p></dd><dt><span class="term"><code class="literal">PrevNode(node,top?)</code></span></dt><dd><p>
Return the first displayed node preceding the given node in the
subtree of top. This function behaves in the same manner as the
node-&gt;previous(top) method, except it works only on the nodes which
are actually visible according to the state of the View-&gt;Show Hidden
Nodes menu item.
</p></dd><dt><span class="term"><code class="literal">NextVisibleNode(node,top?)</code></span></dt><dd><p>
Return the first visible node following the given node in the subtree
of top. This function behaves in the same manner as the
<code class="literal">$node-&gt;following($top)</code> method, except that nodes of hidden subtrees
are skipped.
</p></dd><dt><span class="term"><code class="literal">PrevVisibleNode(node,top?)</code></span></dt><dd><p>
Return the first visible node preceding the given node in the subtree
of top. This function behaves in the same manner as the
<code class="literal">$node-&gt;previous($top)</code> method, except that nodes of hidden subtrees
are skipped.
</p></dd><dt><span class="term"><code class="literal">IsHidden(node)</code></span></dt><dd><p>
Return true if the given node is member of a hidden subtree. This
macro is only an abbreviation for
<code class="literal">FS()-&gt;isHidden(node)</code>
</p></dd><dt><span class="term"><code class="literal">Hide(node)</code></span></dt><dd><p>
Hide a given node.
</p></dd><dt><span class="term"><code class="literal">GetNodes(top?)</code></span></dt><dd><p>
Get a list of all nodes in the current tree or (if top is given) in
the subtree of top (the root of the tree is icluded as well). The list
returned is ordered in the depth-first ordering.
(This function automatically returns array reference in scalar context.)
</p></dd><dt><span class="term"><code class="literal">GetVisibleNodes(top?)</code></span></dt><dd><p>
Return the list of all visible nodes in the subtree of the given top
node (or the whole current tree if no top is given). The list returned
is ordered in the depth-first ordering and all members of hidden
subtrees are skipped.
</p></dd><dt><span class="term"><code class="literal">GetDisplayedNodes($win?)</code></span></dt><dd><p>
Return the list of all nodes actually currently displayed in the
current window in TrEd (which nodes are actually displayed can be
e.g. specified with get_nodelist_hook).
</p></dd><dt><span class="term"><code class="literal">PrevNodeLinear(node,attribute,top?)</code></span></dt><dd><p>
Returns nearest node in the tree preceding the given node in linear
ordering provided by the given attribute. If top node is present, only
a subtree of top is examined.
</p></dd><dt><span class="term"><code class="literal">NextNodeLinear(node,attribute,top?)</code></span></dt><dd><p>
Returns nearest node in the tree following the given node in linear
ordering provided by the given attribute. If top node is present, only
a subtree of top is examined.
</p></dd><dt><span class="term"><code class="literal">CurrentTreeNumber( $win? )</code></span></dt><dd><p>
Return current tree number.  Note that the number of the first tree if
file reported by this function is 0, so you have to add 1 before
passing the number to functions like GotoTree.  If used in TrEd,
optional argument win can be used to specify TrEd window (defaults to
the current window).
</p></dd><dt><span class="term"><code class="literal">GetNodeIndex()</code></span></dt><dd><p>
Return given node's position in the deep-first tree ordering.
</p></dd><dt><span class="term"><code class="literal">LocateNode(node?,fsfile?)</code></span></dt><dd><p>
Return current filename, index of a tree (starting from 1) in the file
to which the node belongs (0 if not found) and node's position in the tree
in the deep-first tree ordering.
</p><p>
If <code class="literal">node</code> is not given, <code class="literal">$this</code> is assumed. Should the node be from a
different file than the current one, the second argument must specify
the corresponding <a class="link" href="">Treex::PML::Document</a> object.
</p></dd><dt><span class="term"><code class="literal">ThisAddress(node?,fsfile?)</code></span></dt><dd><p>
Return a given node's address string in a form of
filename#tree_no.index (tree_no starts from 1 to reflect TrEd's UI
convention).  If the correct tree number could not be determined (the
node does not belong to any top-level tree in the file) and the node
has an ID, the address is returned in the form filename#ID.
</p><p>
If <code class="literal">node</code> is not given, <code class="literal">$this</code> is assumed. Should the node be from a
different file than the current one, the second argument must specify
the corresponding <a class="link" href="">Treex::PML::Document</a> object.
</p></dd><dt><span class="term"><code class="literal">ThisAddressNTRED(node?,fsfile?)</code></span></dt><dd><p>
Return a given node's address string in a form of
ntred://filename@tree_no#1.index (tree_no starts from 1 to reflect
TrEd's UI convention). If the correct tree number could not be
determined (the node does not belong to any top-level tree in the
file) and the node has an ID, the address is returned in the form
ntred://filename#ID.
</p><p>
The returned address may be opened in TrEd to examine the tree in
memory of a remote btred server.
</p><p>
If <code class="literal">node</code> is not given, <code class="literal">$this</code> is assumed. Should the node be from a
different file than the current one, the second argument must specify
the corresponding <a class="link" href="">Treex::PML::Document</a> object.
</p></dd><dt><span class="term"><code class="literal">FPosition(node?,fsfile?)</code></span></dt><dd><p>
Prints the result of <code class="literal">ThisAddress</code> on stdout.
</p></dd><dt><span class="term"><code class="literal">NPosition(node?,fsfile?)</code></span></dt><dd><p>
Prints the result of <code class="literal">ThisAddressNTRED</code> on stdout.
</p></dd><dt><span class="term"><code class="literal">ParseNodeAddress(address)</code></span></dt><dd><p>
Split given address into a filename/URL and a suffix and return these
as a two element list.
</p></dd></dl></div></div><div class="section" title="15.8.3. Tree editing API"><div class="titlepage"><div><div><h4 class="title"><a name="id592230"></a>15.8.3. Tree editing API</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">CutPaste(node,new-parent)</code></span></dt><dd><p>
Cut given node (including its subtree) and paste it to a new
parent. This macro is safer than PasteNode since it checks that
new-parent is not a descendant of node or node itself. If the check
fails, the macro dies with an error before any change is made.
</p><p>
Note: this macro does not verify node types. Use
<code class="literal">$parent-&gt;test_child_type($node)</code> to be sure that type declarations permit
the node as a child node of the new parent.
</p></dd><dt><span class="term"><code class="literal">CutPasteBefore(node,ref_node)</code></span></dt><dd><p>
Cut given node (including its subtree) nd paste it on ref_node's
parent node just before ref_node. This macro is safer than
PasteNodeBefore since it checks that new-parent is not a descendant of
node or node itself. This macro dies on error before any change is
made.
</p><p>
Note: this macro does not verify node types. Use
<code class="literal">$parent-&gt;test_child_type($node)</code> to be sure that type declarations permit
the node as a child node of the new parent.
</p></dd><dt><span class="term"><code class="literal">CutPasteAfter(node,ref_node)</code></span></dt><dd><p>
Cut given node (including its subtree) and paste it on ref_node's parent node just after
ref_node. This macro is safer than PasteNodeBefore since it checks
that new-parent is not a descendant of node or node itself. This macro
dies on error before any change is made.
</p><p>
Note: this macro does not verify node types. Use
<code class="literal">$parent-&gt;test_child_type($node)</code> to be sure that type declarations permit
the node as a child node of the new parent.
</p></dd><dt><span class="term"><code class="literal">PasteNode(node,new-parent)</code></span></dt><dd><p>
Paste the subtree of the node under the new-parent.  The root of the
subtree is placed among other children of new-parent with respect to
the numbering attribute.
</p><p>
Note: this macro does not verify node types. Use
<code class="literal">$parent-&gt;test_child_type($node)</code> to be sure that type declarations permit
the node as a child node of the new parent.
</p></dd><dt><span class="term"><code class="literal">PasteNodeBefore(node,ref_node)</code></span></dt><dd><p>
Cut given node (including its subtree) and paste it on ref_node's
parent node just before ref_node.
</p><p>
Note: this macro does not verify node types. Use
<code class="literal">$parent-&gt;test_child_type($node)</code> to be sure that type declarations permit
the node as a child node of the new parent.
</p></dd><dt><span class="term"><code class="literal">PasteNodeAfter(node,ref_node)</code></span></dt><dd><p>
Cut given node (including its subtree) and paste it on ref_node's
parent node just after ref_node.
</p><p>
Note: this macro does not verify node types. Use
<code class="literal">$parent-&gt;test_child_type($node)</code> to be sure that type declarations permit
the node as a child node of the new parent.
</p></dd><dt><span class="term"><code class="literal">CloneSubtree(node)</code></span></dt><dd><p>
Return an identical copy (except that only declared attributes are
preserved) of the given subtree.
</p></dd><dt><span class="term"><code class="literal">CopyNode(node)</code></span></dt><dd><p>
Return an identical copy (except that only declared attributes are
preserved) of the given node. The input node must belong to the
current file.
</p></dd><dt><span class="term"><code class="literal">CutNode(node)</code></span></dt><dd><p>
Cut the node's subtree off the tree and return it. By cuttin a subtree
we mean disconnecting it from the rest of the tree. Use PasteNode to
attach it to some node again.
</p></dd><dt><span class="term"><code class="literal">NewTree()</code></span></dt><dd><p>
Create a new tree before the current tree. The new tree consists of
exactly one node. This node is activated and a reference to its <a class="link" href="">Treex::PML::Node</a>
object is returned.
</p></dd><dt><span class="term"><code class="literal">NewTreeAfter()</code></span></dt><dd><p>
Create a new tree after the current tree. The new tree consists of
exactly one node. This node is activated and a reference to its <a class="link" href="">Treex::PML::Node</a>
object is returned.
</p></dd><dt><span class="term"><code class="literal">NewRBrother(node)</code></span></dt><dd><p>
Create a new brother of the given node and recalculate the special FS
numbering attribute values in the whole tree so that the new node is
the first right sibling of the given node.
</p><p>
If no node is given, this function operates on <code class="literal">$this</code> and <span class="emphasis"><em>resets</em></span>
<code class="literal">$this</code> to the newly created node. If some node is given the value
of <code class="literal">$this</code> is preserved.
</p></dd><dt><span class="term"><code class="literal">NewLBrother(node)</code></span></dt><dd><p>
Create a new brother of the given node and recalculate the special FS
numbering attribute values in the whole tree so that the new node is
the first left sibling of the given node.
</p><p>
If no node is given, this function operates on <code class="literal">$this</code> and <span class="emphasis"><em>resets</em></span>
<code class="literal">$this</code> to the newly created node. If some node is given the value
of <code class="literal">$this</code> is preserved.
</p></dd><dt><span class="term"><code class="literal">NewSon(parent)</code></span></dt><dd><p>
Create a new child of the given parent node and recalculate the
special FS numbering attribute values in the whole tree so that the
new node is the first node right to the given parent.
</p><p>
If no parent node is given, this function operates on <code class="literal">$this</code> and
<span class="emphasis"><em>resets</em></span> <code class="literal">$this</code> to the newly created node. If a parent node is
given the value of <code class="literal">$this</code> is preserved.
</p></dd><dt><span class="term"><code class="literal">NewParent(node)</code></span></dt><dd><p>
Create a node between given node and its parent and recalculate the
special FS numbering attribute values in the whole tree so that the
new node is the first node left to the given node.
</p><p>
If no node is given, this function operates on <code class="literal">$this</code> and
<span class="emphasis"><em>resets</em></span> <code class="literal">$this</code> to the newly created node. If a parent node is
given the value of <code class="literal">$this</code> is preserved.
</p></dd><dt><span class="term"><code class="literal">DeleteThisNode()</code></span></dt><dd><p>
Delete the current (<code class="literal">$this</code>) node and recalculate the special FS
numbering attribute values in the whole tree so that there is no gap
in the numbering. If the current node is not a leaf or if it is the
root of the current tree, this macro does nothing.
</p></dd><dt><span class="term"><code class="literal">DeleteLeafNode(node)</code></span></dt><dd><p>
Delete a leaf node and recalculate the special FS numbering attribute
values in the whole tree so that there is no gap in the numbering. If
a given node is not a leaf, this macro does nothing.
</p></dd><dt><span class="term"><code class="literal">DeleteSubtree(node)</code></span></dt><dd><p>
Deletes a whole node's subtree and recalculate the special FS
numbering attribute values in the whole tree so that there is no gap
in the numbering.
</p></dd><dt><span class="term"><code class="literal">RemoveTree(n?,fsfile?)</code></span></dt><dd><p>
Removes n-th tree from a given <a class="link" href="">Treex::PML::Document</a> (trees are numbered starting from 0).
If no <a class="link" href="">Treex::PML::Document</a> is specified, uses the current file (see CurrentFile()).
</p><p>
Calling RemoveTree() without arguments, it is equivalent to
</p><div class="literallayout"><p><br>
RemoveTree(CurrentTreeNumber(),CurrentFile())<br>
</p></div><p>
Returns the deleted tree. If you do not reattatch the tree to the <a class="link" href="">Treex::PML::Document</a>,
use $tree-&gt;destroy method on the returned tree to prevent a memory leak.
</p></dd><dt><span class="term"><code class="literal">DestroyTree(n?,fsfile?)</code></span></dt><dd><p>
Like RemoveTree but immediatelly destroys the removed tree. Returns 1
on success.
</p></dd><dt><span class="term"><code class="literal">DetermineNodeType($node)</code></span></dt><dd><p>
For trees with <a class="link" href="">Treex::PML::Schema</a>-based node typing, try to determine the type
of the node from the type of its parent, and associate the node with
the type (using $node-&gt;set_type). If there are more possibilities, the
user is asked to choose the correct type.
</p></dd><dt><span class="term"><code class="literal">CopyValues()</code></span></dt><dd><p>
Copy the values of all the attributes except the special FS numbering
attribute of the current node to a global hash variable named
%ValuesClipboard.
</p></dd><dt><span class="term"><code class="literal">PasteValues()</code></span></dt><dd><p>
Replace existing values of the current node's attributes by all values
stored in the global hash variable named %ValuesClipboard. The
function does not perform any node-type validity checks.
</p></dd><dt><span class="term"><code class="literal">PlainNewSon(parent)</code></span></dt><dd><p>
Add a new child node to the given parent and make it the current
node (by setting <code class="literal">$this</code> to point to it).
</p></dd><dt><span class="term"><code class="literal">PlainDeleteNode()</code></span></dt><dd><p>
Delete the given node. The node must be a leaf of the tree (may not
have any children) and must have a parent (may not be the root of the
tree).
</p></dd><dt><span class="term"><code class="literal">PlainDeleteSubtree(node)</code></span></dt><dd><p>
Cut a the given node's subtree and destroy all its nodes.
This macro does not recalculate ordering attributes.
</p></dd><dt><span class="term"><code class="literal">NormalizeOrds(listref)</code></span></dt><dd><p>
Adjusts the special FS numbering attribute of every node of the list
referenced by the listref argument so that the value for the attribute
corresponds to the order of the node in the list and repaste each node
so that the structural order corresponds with this new numbering.
</p><p>
If no numbering FS numbering attribute is available, all this macro
does is to ensure that the structural order of sibling nodes
corresponds to their order in the given list.
</p></dd><dt><span class="term"><code class="literal">SortByOrd(listref)</code></span></dt><dd><p>
Sort the list of nodes referenced by the listref argumnt according to
the values of the special FS numbering attribute.
</p></dd><dt><span class="term"><code class="literal">RepasteNode(node)</code></span></dt><dd><p>
Cut the given node and paste it immediately on the same parent so that
its structural position between its parent children is brought to
correspondence with the values of the special FS numbering attribute.
</p></dd><dt><span class="term"><code class="literal">ShiftNodeRightSkipHidden(node)</code></span></dt><dd><p>
Shift the current node in the tree to the right leaping over all
hidden subtress by modifying the tree structure and value of the
special FS numbering attribute appropriately.
</p></dd><dt><span class="term"><code class="literal">ShiftNodeLeftSkipHidden(node,min?)</code></span></dt><dd><p>
Shift the current node in the tree to the left leaping over all hidden
subtress by modifying the tree structure and value of the special FS
numbering attribute appropriately. The optional argument min may be
used to specify the minimum left boundary for the value of the
ordering attribute of node.
</p></dd><dt><span class="term"><code class="literal">ShiftNodeRight(node)</code></span></dt><dd><p>
Shift the current node in the tree to the right by modifying the tree
structure and value of the special FS numbering attribute
accordingly.
</p></dd><dt><span class="term"><code class="literal">ShiftNodeLeft(node)</code></span></dt><dd><p>
Shift the current node in the tree to the right by modifying the tree
structure and value of the special FS numbering attribute
appropriately.
</p></dd><dt><span class="term"><code class="literal">GetNodesExceptSubtree(node)</code></span></dt><dd><p>
Returns the reference to an array containing the whole tree except the
nodes strictly in the subtrees of nodes given in an array referenced
by the parameter. (The returned array does contain the nodes passed in
the parameter.)
</p></dd><dt><span class="term"><code class="literal">MoveNode(source-node,target-node)</code></span></dt><dd><p>
Move the node specified by the first parameter after the node specified by
the second parameter in the ordering on nodes.
</p></dd><dt><span class="term"><code class="literal">MoveSubtree(source-node,target-node)</code></span></dt><dd><p>
Move the subtree of the node specified by the first parameter after
the node specified by the second parameter in the ordering on
nodes. The subtree of the first argument is made contiguous in the
ordering on nodes, if it happens not to be so. (We use the fact that
the technical root node is always first in the ordering.)
</p></dd></dl></div></div><div class="section" title="15.8.4. Helper macros for attributes with list or alternatives of values"><div class="titlepage"><div><div><h4 class="title"><a name="id592861"></a>15.8.4. Helper macros for attributes with list or alternatives of values</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">CloneValue(value)</code></span></dt><dd><p>
Return an identical deep copy of a given scalar. Useful for copying
attribute values (and any value below them), including structured
attributes, lists or alternatives.
</p><p>
Warning: do not apply this macro to an entire <a class="link" href="">Treex::PML::Node</a> since otherwise
you might result with a copy of the complete tree, schema, etc.
</p></dd><dt><span class="term"><code class="literal">IsList(value)</code></span></dt><dd><p>
Check that a given value is a list, i.e. <a class="link" href="">Treex::PML::List</a> object.
</p></dd><dt><span class="term"><code class="literal">IsAlt(value)</code></span></dt><dd><p>
Check that a given value is an alternative, i.e. <a class="link" href="">Treex::PML::Alt</a> object.
</p></dd><dt><span class="term"><code class="literal">IsSeq(value)</code></span></dt><dd><p>
Check that a given value is a sequence, i.e. <a class="link" href="">Treex::PML::Seq</a> object.
</p></dd><dt><span class="term"><code class="literal">List(value,value,...)</code></span></dt><dd><p>
Return a new list (<a class="link" href="">Treex::PML::List</a> object) populated with given values.
</p></dd><dt><span class="term"><code class="literal">Alt(value,value,...)</code></span></dt><dd><p>
Return a new alternative (<a class="link" href="">Treex::PML::Alt</a> object) populated with given values.
</p></dd><dt><span class="term"><code class="literal">AltV(value)</code></span></dt><dd><p>
If the value is an alternative (i.e. a <a class="link" href="">Treex::PML::Alt</a> object), return
all its values. Otherwise return value.
</p></dd><dt><span class="term"><code class="literal">ListV(value)</code></span></dt><dd><p>
If the value is a list (i.e. a <a class="link" href="">Treex::PML::List</a> object), return
all its values. Otherwise return empty (Perl) list.
</p></dd><dt><span class="term"><code class="literal">SeqV(value)</code></span></dt><dd><p>
If the value is a sequence (i.e. a <a class="link" href="">Treex::PML::Seq</a> object), return all its
elements (<a class="link" href="">Treex::PML::Seq::Element</a> objects). Otherwise return empty (Perl)
list.
</p></dd><dt><span class="term"><code class="literal">AddToAlt(node,attr,value,value...)</code></span></dt><dd><p>
Add given values as alternatives to the current value of
<code class="literal">$node-&gt;{$attr}</code>.  If only one value is given and <code class="literal">$node-&gt;{$attr}</code> is
empty or same as value, the given value is simply assigned to it. If
<code class="literal">$node-&gt;{$attr}</code> is a <a class="link" href="">Treex::PML::Alt</a> object, the new values are simply added
to it. Otherwise, if <code class="literal">$node-&gt;{$attr}</code> is a simple value, <code class="literal">$node-&gt;{$attr}</code>
is set to a new <a class="link" href="">Treex::PML::Alt</a> object containing the original value as
well as the given values.
</p></dd><dt><span class="term"><code class="literal">AddToList(node,attr,value,value,...)</code></span></dt><dd><p>
Add values to a given attribute. If <code class="literal">$node-&gt;attr($attr)</code> is not defined or
empty, a new <a class="link" href="">Treex::PML::List</a> containing given values is created. If
<code class="literal">$node-&gt;attr($attr)</code> is a <a class="link" href="">Treex::PML::List</a> object, given values are simply added
to it. Error is issued if <code class="literal">$node-&gt;attr($attr)</code> is defined, non-empty, yet not
a <a class="link" href="">Treex::PML::List</a> object.
</p></dd><dt><span class="term"><code class="literal">AddToListUniq(node,attr,value,value,...)</code></span></dt><dd><p>
Add values to a given attribute, unless already present among the
current values. If <code class="literal">$node-&gt;attr($attr)</code> is not defined or empty,
a new <a class="link" href="">Treex::PML::List</a> containing given values is created. If
<code class="literal">$node-&gt;attr($attr)</code> is a <a class="link" href="">Treex::PML::List</a> object, given values are
simply added to it. Error is issued if <code class="literal">$node-&gt;attr($attr)</code> is
defined, non-empty, yet not a <a class="link" href="">Treex::PML::List</a> object.
</p></dd><dt><span class="term"><code class="literal">AddToSeq(node, attr, name =</code> value, name =&gt; value,...)&gt; or <code class="literal">AddToSeq(node, attr, element, ...)</code></span></dt><dd><p>
Add elements to a given sequence attribute. If <code class="literal">$node-&gt;attr($attr)</code> is not defined or
empty, a new <a class="link" href="">Treex::PML::Seq</a> object containing given name-value pairs (<a class="link" href="">Treex::PML::Seq::Element</a> objects) is created. If
<code class="literal">$node-&gt;attr($attr)</code> is a <a class="link" href="">Treex::PML::Seq</a> object, given elements are simply added
to it. Error is issued if <code class="literal">$node-&gt;attr($attr)</code> is defined, non-empty, yet not
a <a class="link" href="">Treex::PML::Seq</a> object.
</p></dd></dl></div></div><div class="section" title="15.8.5. General-purpose list functions"><div class="titlepage"><div><div><h4 class="title"><a name="id593212"></a>15.8.5. General-purpose list functions</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">Index(array-ref,item)</code></span></dt><dd><p>
A helper function which returns the index of the first occurence of a
given item in an array. Returns nothing (empty list) if the item is
not found. Note: 'eq' is used for comparison.
</p></dd><dt><span class="term"><code class="literal">ListIntersect(array-ref,array-ref,...)</code></span></dt><dd><p>
Compute intersection of given lists. In scalar context returns an
array-ref, in list context returns a list. All duplicities are
removed.
</p></dd><dt><span class="term"><code class="literal">ListSubtract(array-ref, array-ref)</code></span></dt><dd><p>
Return elements occuring in the first list but not in the second list.
In scalar context returns a <a class="link" href="">Treex::PML::List</a> object (array-ref), in list
context returns a list. All duplicities are removed.
</p></dd><dt><span class="term"><code class="literal">ListUnion(array-ref, array-ref, ...)</code></span></dt><dd><p>
Return union of given lists. In scalar context returns an array-ref,
in list context returns a <a class="link" href="">Treex::PML::List</a> object (array-ref). All
duplicities are removed.
</p></dd><dt><span class="term"><code class="literal">ListRegroupElements(array-ref, array-ref, ...)</code></span></dt><dd><p>
This is rotate-matrix like operation. The input is a list of
rows (array-refs each representing a row in a matrix); the output
is a list of columns in the matrix (a list of array-refs, each
representing a column in the matrix).
</p></dd></dl></div></div><div class="section" title="15.8.6. GUI-related macros"><div class="titlepage"><div><div><h4 class="title"><a name="id593293"></a>15.8.6. GUI-related macros</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">GUI()</code></span></dt><dd><p>
Return a reference if running from TrEd, i.e., GUI is available;
otherwise return <code class="literal">undef</code>. If running from TrEd the returned value is
a TrEd::Window object representing the currently focused window.
</p></dd><dt><span class="term"><code class="literal">CloseGUI()</code></span></dt><dd><p>
This macro is only available in TrEd. It closes TrEd's main window and
exits.
</p></dd><dt><span class="term"><code class="literal">TrEdWindows()</code></span></dt><dd><p>
Return a list of TrEd::Window objects representing current TrEd
windows.
</p></dd><dt><span class="term"><code class="literal">CurrentWindow()</code></span></dt><dd><p>
Return a TrEd::Window object representing the currently focused
window.
</p></dd><dt><span class="term"><code class="literal">SetCurrentWindow(win)</code></span></dt><dd><p>
Focus a given window.
</p></dd><dt><span class="term"><code class="literal">SplitWindowHorizontally(\%opts?)</code></span></dt><dd><p>
Split current window horizontally. Returns an object represening the
newly created window.
</p><p>
An optional HASHref with the following options can be passed as an argument:
</p><div class="variablelist"><dl><dt><span class="term">no_focus =&gt; 0|1</span></dt><dd><p>
do not focus the new view (default value is 1)
</p></dd><dt><span class="term">no_init =&gt; 0|1</span></dt><dd><p>
do not initialize the new view with the file, context, etc. from the
current vie (default value is 0)
</p></dd><dt><span class="term">no_redraw =&gt; 0|1</span></dt><dd><p>
do not redraw the new view
</p></dd><dt><span class="term">ratio =&gt; float</span></dt><dd><p>
A float value between 0 and 1 indicating the ratio of the height of
the new view to the current height of the active view.
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">SplitWindowVertically()</code></span></dt><dd><p>
Split current window horizontally. Returns an object represening the
newly created window.
</p><p>
An optional HASHref with the following options can be passed as an argument:
</p><div class="variablelist"><dl><dt><span class="term">no_focus =&gt; 0|1</span></dt><dd><p>
do not focus the new view (default value is 1)
</p></dd><dt><span class="term">no_init =&gt; 0|1</span></dt><dd><p>
do not initialize the new view with the file, context, etc. from the
current vie (default value is 0)
</p></dd><dt><span class="term">no_redraw =&gt; 0|1</span></dt><dd><p>
do not redraw the new view
</p></dd><dt><span class="term">ratio =&gt; float</span></dt><dd><p>
A float value between 0 and 1 indicating the ratio of the height of
the new view to the current height of the active view.
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">CloseWindow(win?)</code></span></dt><dd><p>
Close a given window, unless it is the last window that exists.  If no
window is given as an argument, try closing the current window.  If
the closed window was focused, then a next sibling window gets focus.
</p></dd><dt><span class="term"><code class="literal">CurrentFile(win?)</code></span></dt><dd><p>
Return a <a class="link" href="">Treex::PML::Document</a> object representing the file currently open in a given
TrEd window or in the currently focused window if called without
arguments.
</p></dd><dt><span class="term"><code class="literal">CurrentNodeInOtherWindow(win)</code></span></dt><dd><p>
Return the node currently active in a given window.
</p></dd><dt><span class="term"><code class="literal">SetCurrentNodeInOtherWindow(win,node)</code></span></dt><dd><p>
Set active node for a given window.
</p></dd><dt><span class="term"><code class="literal">InVerticalMode()</code></span></dt><dd><p>
Return true if the tree is currently displayed in the vertical mode.
</p></dd><dt><span class="term"><code class="literal">ToplevelFrame()</code></span></dt><dd><p>
Returns the Tk::Toplevel object containing the current window.
</p></dd><dt><span class="term"><code class="literal">PrintDialog(...)</code></span></dt><dd><p>
See the description in the <a class="link" href="ar01s15.html#sect-0" title="15.8.13. Printing trees">Printing trees</a> section.
</p></dd><dt><span class="term"><code class="literal">Redraw($win?.$ignoreThis)</code></span></dt><dd><p>
Force TrEd to immediately redraw the current (or given) window. Hence
TrEd redraws the tree right after an interactively invoked macro
finishes, explicit calls to Redraw macro are needed rather rearly (for
example from a hook). If the flag $ignoreThis is used, then current
value of $this variable will not be used to determine the current node
of the window (i.e. $win-&gt;{currentNode}).
</p></dd><dt><span class="term"><code class="literal">Redraw_FSFile()</code></span></dt><dd><p>
Force TrEd to immediately redraw all windows displaying current
file.
</p></dd><dt><span class="term"><code class="literal">Redraw_FSFile_Tree()</code></span></dt><dd><p>
Force TrEd to immediately redraw all windows displaying current
tree.
</p></dd><dt><span class="term"><code class="literal">Redraw_All()</code></span></dt><dd><p>
Force TrEd to immediately redraw all windows.
</p></dd><dt><span class="term"><code class="literal">RedrawStatusLine()</code></span></dt><dd><p>
Force TrEd to immediately redraw status line.
</p></dd><dt><span class="term"><code class="literal">EditAttribute(node,attribute)</code></span></dt><dd><p>
Open edit attribute GUI.
</p></dd><dt><span class="term"><code class="literal">Undo()</code></span></dt><dd><p>
Act as if the user pressed the undo button. Note that this macro also
changes $this and $root (since undo replaces the current tree with an
in-memory copy).
</p><p>
WARNING: Be aware that calling Undo() from a hook may conflict with
some macros, more specifically, with macros triggering such a hook
(indirectly, i.e. via some API call). In a case, changes to $this and
$root caused by Undo() do not propagate to the macro, which in turn
ends up working with incorrect (already replaced) nodes. Thus, if
calling Undo() within a hook, make sure to reset $this from
$grp-&gt;{currentNode} and $root from $this-&gt;root after all calls from
your macros which may possibly invoke the hook.
</p></dd><dt><span class="term"><code class="literal">Redo()</code></span></dt><dd><p>
Act as if the user pressed the undo button. Note that this macro also
changes $this and $root.
</p></dd><dt><span class="term"><code class="literal">SaveUndo(comment)</code></span></dt><dd><p>
Save a snapshot of the current tree so that following operations on it
can be reverted with Undo. The <code class="literal">comment</code> argument should provide
user-visible one-line diescription of the action following SaveUndo.
</p></dd><dt><span class="term"><code class="literal">ForgetRedo()</code></span></dt><dd><p>
Disable redo. This is useful if you programmatically Undo user's
action and do not want the user to be able to redo the action with
Redo.
</p></dd><dt><span class="term"><code class="literal">Find()</code></span></dt><dd><p>
Open the Find Node by Attributes GUI dialog.
</p></dd><dt><span class="term"><code class="literal">FindNext()</code></span></dt><dd><p>
Searches for the first node matching the criteria of the previous use
of the Find... menu command or FindNode macro usage.
</p></dd><dt><span class="term"><code class="literal">FindPrev()</code></span></dt><dd><p>
Searches for the previous node matching the criteria of the previous
use of the Find... menu command or FindNode macro usage.
</p></dd><dt><span class="term"><code class="literal">ErrorMessage(message)</code></span></dt><dd><p>
In TrEd, show a dialog box containing the given error-message in a
text window.  In BTrEd print the error message on standard error output.
</p></dd><dt><span class="term"><code class="literal">InfoMessage(message)</code></span></dt><dd><p>
In TrEd, show a dialog box containing the given info-message in a
text window.  In BTrEd print the message on standard output.
</p></dd><dt><span class="term"><code class="literal">StandardTredFont()</code></span></dt><dd><p>
Return a string or Tk::Font object representation of the font used in
TrEd to label tree-nodes.
</p></dd><dt><span class="term"><code class="literal">StandardTredValueLineFont()</code></span></dt><dd><p>
Return a string or Tk::Font object representation of the font used in
TrEd to display the "sentence" above the tree.
</p></dd><dt><span class="term"><code class="literal">CenterOtherWinTo(win,node)</code></span></dt><dd><p>
Center given window to a given node.
</p></dd><dt><span class="term"><code class="literal">HiddenVisible(win?)</code></span></dt><dd><p>
Return true if TrEd displays hidden nodes in a given window (or the
currently focused window if called without an argument).
</p></dd><dt><span class="term"><code class="literal">ToggleHiding($win?)</code></span></dt><dd><p>
If TrEd displays hidden nodes (or the currently focused window if
called without an argument), hide them and vice versa.
</p></dd></dl></div></div><div class="section" title="15.8.7. Create/modify keyboard shortcuts"><div class="titlepage"><div><div><h4 class="title"><a name="id593809"></a>15.8.7. Create/modify keyboard shortcuts</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">Bind( macro =&gt; bind-options,...)</code></span></dt><dd><p>
This macro can be used to dynamically create keyboard bindings and
menu items for user-defined macros in TrEd. The arguments consist of
one or more (macro =&gt; bind-options ) pairs
where macro is a subroutine name or a CODE reference and
bind-options is either a keyboard shortcut (e.g. 'Ctrl+a') or a HASH references
with the following keys and values (all optional):
</p><div class="variablelist"><dl><dt><span class="term">context</span></dt><dd><p>
the binding context, e.g. the package in which context the macro is
evaluated. Only relevant if the macro is specified by name. If not
given, the caller package is used.
</p></dd><dt><span class="term">key</span></dt><dd><p>
a keyboard binding for the macro (e.g. 'Ctrl+a'); if not given, no
keyboard binding is created.
</p></dd><dt><span class="term">menu</span></dt><dd><p>
a label to be used for a menu-item created for the macro. If not
given, no menu-item is created for the macro.
</p></dd><dt><span class="term">changing_file</span></dt><dd><p>
if the key <code class="literal">changing_file</code> exists in the bind-options hash and its
value is <span class="emphasis"><em>value</em></span>, a call to the macro <code class="literal">ChangignFile(<span class="emphasis"><em>value</em></span>)</code>
is made immediatelly after each invocation of the macro via this
binding.
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">UnbindBuiltin(key-binding)</code></span></dt><dd><p>
(TrEd only). Remove default TrEd's keybinding for a given key so that
custom macro can be bound to that key.
E.g. UnbindBuiltin('Ctrl+Home'); Note: use with care. Built-in
key-bining once removed cannot be restored (except by restarting TrEd).
</p></dd><dt><span class="term"><code class="literal">OverrideBuiltinBinding(context,key-binding, binding_spec )</code></span></dt><dd><p>
(TrEd only). Get or modify default TrEd's keybinding.
</p><p>
The <code class="literal">binding_spec</code> argument, if given, must be an array reference with two elements:
</p><div class="literallayout"><p><br>
[ sub { ... }, 'description' ]<br>
</p></div><p>
WARNING: You have to be very careful when overriding a builtin
binding, since your code is not called as a macro or a hook! The routine is
called with the following three arguments:
</p><div class="literallayout"><p><br>
$tk_window, $grp-&gt;{framegroup}, $key<br>
</p></div><p>
You may obtain $grp from the second argument using
$_[1]-&gt;{currentWindow}.  You should probably call Tk-&gt;break at the end
of your code, so that the event does not propagate. There is no
<code class="literal">$root</code> or <code class="literal">$this</code> available within the callback.
</p><p>
A safer way (with slower execution, though) is to use a macro wrapped
into a MacroCallback() instead of a sub:
</p><div class="literallayout"><p><br>
[ MacroCallback(...), 'description' ]<br>
</p></div><p>
See <code class="literal">MacroCallback</code> macro for details. The macro is called with the
same arguments (appended to a list of arguments provided in
<code class="literal">MacroCallback</code>). The macro can use all standard macro functions and
variables.
</p><p>
If the <code class="literal">context</code> argument is a name of a binding context, the binding
is only used in the specific context.  If <code class="literal">context</code> is <code class="literal">'*'</code>, the
binding applies to all contexts (except for contexts that specifically
overrid it).
</p><p>
If called without a binding_spec, the current binding_spec is returned, otherwise
the previous binding_spec is returned.
</p><p>
Example (swaps the behavior of normal <code class="literal">left/right</code> with <code class="literal">Shift+left/right</code>)
</p><div class="literallayout"><p><br>
my @keys = qw(Left Right);<br>
my %normal = map { $_ =&gt; OverrideBuiltinBinding('*',$_) } @keys;<br>
my %shift = map { $_ =&gt; OverrideBuiltinBinding('*',"Shift+$_") } @keys;<br>
for (@keys) {<br>
  OverrideBuiltinBinding(__PACKAGE__, $_, $shift{$_});<br>
  OverrideBuiltinBinding(__PACKAGE__, "Shift+$_", $normal{$_});<br>
}<br>
</p></div><p>
Here is another example that changes the Up arrow to move to the
grand-parent instead of a parent:
</p><div class="literallayout"><p><br>
# Using TrEd internals (faster, but prone to changes in the internal API):<br>
<br>
OverrideBuiltinBinding(<br>
  __PACKAGE__,<br>
  'Up',<br>
  [sub { main::currentUp($_[1]) for 1..2 },<br>
  'Move to grand-parent']);<br>
<br>
# Using a macro (slower):<br>
<br>
OverrideBuiltinBinding(<br>
  __PACKAGE__,<br>
  "Up",<br>
  [MacroCallback(sub { $this=$this-&gt;parent; $this=$this-&gt;parent if $this }),<br>
  'Move to grand-parent']);<br>
</p></div></dd><dt><span class="term"><code class="literal">MacroCallback(macro_spec,@args)</code></span></dt><dd><p>
This macro can be used to safely wrap a given macro into a code that
can be used to override a TrEd builtin or passed as a callback to a Tk
widget.
</p><p>
The first argument can take one of the following forms:
</p><div class="literallayout"><p><br>
String:<br>
  "macro_name" or "Package-&gt;macro_name"<br>
<br>
Anonymous subrutine:<br>
  sub { ...code... }<br>
<br>
Hash reference:<br>
  { -command =&gt; sub { ...code... },<br>
    -changing_file =&gt; 0 | 1,<br>
    -contex =&gt; 'PackageName'<br>
  }<br>
<br>
Array reference:<br>
  [ sub { ..code ...}, arg1, arg2, ...]<br>
</p></div><p>
The macro is called with the arguments provided in the macro_spec,
followed by the arguments provided in the call to MacroCallback,
followed by arguments passed by the caller (e.g. TrEd or the Tk
widget).
</p></dd></dl></div></div><div class="section" title="15.8.8. Stylesheet API"><div class="titlepage"><div><div><h4 class="title"><a name="id594044"></a>15.8.8. Stylesheet API</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">STYLESHEET_FROM_FILE()</code></span></dt><dd><p>
This function returns a symbolic name for a virtual stylesheet that is
constructed from the patterns and hint specified in the currently
displayed file.
</p></dd><dt><span class="term"><code class="literal">SetStylesheetPatterns(patterns,stylesheet,create)</code></span></dt><dd><p>
Set TrEd's display patterns for a given stylesheet. If stylesheet is
undefined, then the stylesheet currently selected for the active view
is used. The patterns argument should either be a string or an array
reference.  If it is a string, then it should provide all the
patterns, each pattern starting on a new line (but possibly spanning
across several lines) which starts with a pattern prefix of the form
"something:", where "something" is hint for the hint pattern, or
"node" for the node pattern, etc.
</p><p>
Patterns can also be provided as an array reference containing three
elements: the first one being a hint text, the second the context
pattern (regular expression), and the second one an array reference
whose each element is the text of an individual pattern.
</p><p>
The create flag can be set to 1 in order to create a new stylesheet in
case that no stylesheet with the given exists.
</p><p>
This function returns 1 if success, 0 if failed (i.e. when create is
not set and a given stylesheet is not found).
</p></dd><dt><span class="term"><code class="literal">DeleteStylesheet(stylesheet)</code></span></dt><dd><p>
Delete given stylesheet. All windows using that stylesheet are
switched to the pattern and hint specified in the respective files
they display.
</p></dd><dt><span class="term"><code class="literal">SaveStylesheet(name)</code></span></dt><dd><p>
Save given TrEd's stylesheet (to ~/.tred.d/stylesheets/name).
</p></dd><dt><span class="term"><code class="literal">SaveStylesheets()</code></span></dt><dd><p>
Save all TrEd's stylesheets (to ~/.tred.d/stylesheets/).
</p></dd><dt><span class="term"><code class="literal">ReloadStylesheet(name,dir?)</code></span></dt><dd><p>
Reload a given stylesheet. If no dir is specified, the
default path "~/.tred.d/stylesheets/" is used.
</p></dd><dt><span class="term"><code class="literal">ReloadStylesheets(dir?)</code></span></dt><dd><p>
Reload stylesheets from a given file or directory. If no filename is
specified, the default path "~/.tred.d/stylesheets/" is used.
</p></dd><dt><span class="term"><code class="literal">GetStylesheetPatterns(stylesheet)</code></span></dt><dd><p>
For a given stylesheet, return it's patterns. In a scalar context,
returns a string consisting of all patterns, including the hint.  In
the array context returns three scalars: the first one containing the
text of the hint pattern, the second the context pattern (regexp) and
the other a reference to a list containing the stylesheet
patterns. Returns empty list in case of failure.
</p></dd><dt><span class="term"><code class="literal">GetPatternsByPrefix(prefix,stylesheet?)</code></span></dt><dd><p>
Return all patterns of a given stylesheet starting with a given prefix.
If no stylesheet name is given, a current stylesheet is used.
</p></dd><dt><span class="term"><code class="literal">StylesheetExists(stylesheet)</code></span></dt><dd><p>
Returns true if stylesheet with a given name exists.
</p></dd><dt><span class="term"><code class="literal">Stylesheets()</code></span></dt><dd><p>
Returns a list of TrEd's stylesheet names.
</p></dd><dt><span class="term"><code class="literal">GetCurrentStylesheet()</code></span></dt><dd><p>
Returns name of the stylesheet currently selected for the active
window.
</p></dd><dt><span class="term"><code class="literal">SetCurrentStylesheet(stylesheet_name)</code></span></dt><dd><p>
Set stylesheet for the active window.
</p></dd><dt><span class="term"><code class="literal">GetSpecialPattern(prefix)</code> - OBSOLETE!!</span></dt><dd><p>
This macro is obsoleted by GetPatternsByPrefix.
</p></dd><dt><span class="term"><code class="literal">SetDisplayAttrs(pattern,...)</code> - OBSOLETE!!</span></dt><dd><p>
Setup given patterns as a stylesheet of
the currently displayed <a class="link" href="">Treex::PML::Document</a>. This does not include
a hint pattern.
</p></dd><dt><span class="term"><code class="literal">SetBalloonPattern(string,...)</code> - OBSOLETE!!</span></dt><dd><p>
Use given strings as a <code class="literal">hint:</code> pattern for
the currently displayed <a class="link" href="">Treex::PML::Document</a>.
</p></dd><dt><span class="term"><code class="literal">GetDisplayAttrs()</code> - OBSOLETE!!</span></dt><dd><p>
Get patterns of the currently displayed <a class="link" href="">Treex::PML::Document</a>'s stylesheet, except
for a <code class="literal">hint:</code> pattern.
</p></dd><dt><span class="term"><code class="literal">GetBalloonPattern()</code> - OBSOLETE!!</span></dt><dd><p>
Get a <code class="literal">hint:</code> pattern of the currently displayed
<a class="link" href="">Treex::PML::Document</a>'s stylesheet.
</p></dd><dt><span class="term"><code class="literal">CustomColor(name,new-value?)</code></span></dt><dd><p>
Get or set user defined custom color.
</p></dd><dt><span class="term"><code class="literal">UserConf(name,new-value?)</code></span></dt><dd><p>
Get or set value of a user defined configuration option.
</p></dd><dt><span class="term"><code class="literal">AddStyle(styles,object,key =&gt; value,...)</code></span></dt><dd><p>
Auxiliary funcion: add styles for an object to a given
style-hash (can be used e.g. from node_style_hook).
</p></dd><dt><span class="term"><code class="literal">GetStyles(styles,object,$feature?)</code></span></dt><dd><p>
Auxiliary funcion: if feature is given, retrieves and returns a
feature of a particular object from the given style-hash.  If feature
is not given or undef, returns a (flat) list of feature =&gt; value pairs
consisting of the style features of a given type of object obtained
from the style-hash.
</p><p>
This function can be used e.g. from node_style_hook.
</p></dd></dl></div></div><div class="section" title="15.8.9. Context API"><div class="titlepage"><div><div><h4 class="title"><a name="id594370"></a>15.8.9. Context API</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">CurrentContext()</code></span></dt><dd><p>
Return the name of the current macro context.
</p></dd><dt><span class="term"><code class="literal">SwitchContext(context)</code></span></dt><dd><p>
Switch to given macro context.
</p></dd><dt><span class="term"><code class="literal">CurrentContextForWindow(win)</code></span></dt><dd><p>
Get a macro context currently selected in a given window.
</p></dd><dt><span class="term"><code class="literal">SwitchContextForWindow(win,context)</code></span></dt><dd><p>
Switch given window to given macro context.
</p></dd></dl></div></div><div class="section" title="15.8.10. Treex::PML::FSFormat API"><div class="titlepage"><div><div><h4 class="title"><a name="id594422"></a>15.8.10. Treex::PML::FSFormat API</h4></div></div></div><p>
Here are described for working with <a class="link" href="">Treex::PML::FSFormat</a> objects. Beside these
macros, <a class="link" href="">Treex::PML::FSFormat</a> object methods can be used.
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">FS()</code></span></dt><dd><p>
Return <a class="link" href="">Treex::PML::FSFormat</a> object associated with the current <a class="link" href="">Treex::PML::Document</a>.
</p></dd><dt><span class="term"><code class="literal">GetOrd(node)</code></span></dt><dd><p>
Return value of the special numbering FS attribute. This macro
actually returns the same value as
<code class="literal">$node-&gt;{FS()-&gt;order()}</code>
</p></dd><dt><span class="term"><code class="literal">Attributes(node?,normal_fields?)</code></span></dt><dd><p>
If no node is given or the node is not associated with a type, return
a list of names of all attributes declared in the FS-file header or
Schema.
</p><p>
If node is associated with a type and the 2nd attribute is undef or
false, return list of paths to all its (possibly nested) atomic-value
attributes.  This is equivalent to
</p><div class="literallayout"><p><br>
$node-&gt;type-&gt;schema-&gt;attributes($node-&gt;type)<br>
</p></div><p>
If node is associated with a type and the 2nd attribute is true,
return only first-level attribute names. This is equivalent to
</p><div class="literallayout"><p><br>
$node-&gt;type-&gt;get_normal_fields()<br>
</p></div></dd><dt><span class="term"><code class="literal">SubstituteFSHeader(declarations)</code></span></dt><dd><p>
Substitute a new FS header for current document. A list of valid FS
declarations must be passed to this function.
</p></dd><dt><span class="term"><code class="literal">AppendFSHeader(declarations)</code></span></dt><dd><p>
Merge given FS header declarations with the present header
of the current document.
</p></dd><dt><span class="term"><code class="literal">UndeclareAttributes(attribute,...)</code></span></dt><dd><p>
Remove declarations of given attributes from the FS header
</p></dd></dl></div></div><div class="section" title="15.8.11. Treex::PML::Document I/O API"><div class="titlepage"><div><div><h4 class="title"><a name="id594548"></a>15.8.11. Treex::PML::Document I/O API</h4></div></div></div><p>
See also <a class="link" href="">Treex::PML::Document</a> object methods defined in the <a class="link" href="">Treex::PML</a> module.
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">ChangingFile(0|1)</code></span></dt><dd><p>
If no argument given the default is 1. If <code class="literal">$FileChanged</code> is already
set to 1, does nothing. If <code class="literal">$FileChanged</code> has not yet been
assigned or is zero, sets it to the given value. Returns the resulting
value. <code class="literal">ChangingFile(1)</code> also resets <code class="literal">$forceFileSaved</code> to 0.
</p></dd><dt><span class="term"><code class="literal">CurrentFile()</code></span></dt><dd><p>
Return a <a class="link" href="">Treex::PML::Document</a> object representing the currently processed file.
</p></dd><dt><span class="term"><code class="literal">Open(filename,flags)</code></span></dt><dd><p>
Open a given <a class="link" href="">Treex::PML::Document</a> in TrEd. Flags is an optional HASH reference
that may contain various flags internally used by TrEd.
</p></dd><dt><span class="term"><code class="literal">OpenSecondaryFiles($fsfile)</code></span></dt><dd><p>
Open secondary files for a given <a class="link" href="">Treex::PML::Document</a> in TrEd.
</p></dd><dt><span class="term"><code class="literal">ReloadCurrentFile()</code></span></dt><dd><p>
Close and reload current fsfile.
</p></dd><dt><span class="term"><code class="literal">Resume($fsfile)</code></span></dt><dd><p>
Resume a previously open fsfile a given window in TrEd.
</p></dd><dt><span class="term"><code class="literal">CloseFile(file?)</code></span></dt><dd><p>
Close a given <a class="link" href="">Treex::PML::Document</a>.
</p></dd><dt><span class="term"><code class="literal">CloseFileInWindow(window?)</code></span></dt><dd><p>
This macro is for TrEd only. It closes the <a class="link" href="">Treex::PML::Document</a> open in the given or
current window.  If the file is open in other windows, it is kept
among postponed files. If the file is modified, the user is asked to
save it.
</p></dd><dt><span class="term"><code class="literal">Save()</code></span></dt><dd><p>
Save the current <a class="link" href="">Treex::PML::Document</a>.
</p></dd><dt><span class="term"><code class="literal">SaveAs({ option=</code>value,... })&gt;</span></dt><dd><p>
NOTE: This macro is currently only available in TrEd.
</p><p>
Save the current <a class="link" href="">Treex::PML::Document</a> under a new filename.
Returns 1 if the file was saved successfully.
</p><p>
Options:
</p><div class="variablelist"><dl><dt><span class="term">filename</span></dt><dd><p>
The new-filename. If undefined, the usual "Save As..." dialog prompts
the user to select the output filename.
</p></dd><dt><span class="term">fsfile</span></dt><dd><p>
operate on a given fsfile rather than the current one
</p></dd><dt><span class="term">backend</span></dt><dd><p>
save using a given I/O backend
</p></dd><dt><span class="term">update_refs</span></dt><dd><p>
update references from other files to this file.  Values can be:
'ask', 'all', an array of <a class="link" href="">Treex::PML::Document</a> objects; all
other values mean no update. Default is 'ask'.
</p></dd><dt><span class="term">update_filelist</span></dt><dd><p>
update references from the current filelist to this file.  Values can
be: 'ask', 'current' (update only the current position);
any other value means no update. Default is 'ask'.
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">GetOpenFiles()</code></span></dt><dd><p>
Return a list of <a class="link" href="">Treex::PML::Document</a> objects currently open in TrEd (including
postponed files).
</p></dd><dt><span class="term"><code class="literal">Backends()</code></span></dt><dd><p>
Return a list of currently registered I/O backends.
</p></dd><dt><span class="term"><code class="literal">AddBackend($classname,$before_backend)</code></span></dt><dd><p>
Register a new I/O backend. Note that the caller is responsible for
loading the required module (e.g. by calling <a class="link" href="">Treex::PML::ImportBackends</a>());
If $before_backend is defined, the new backend is added before a given
backend. Otherwise the backend is added as a last backend.
</p></dd><dt><span class="term"><code class="literal">RemoveBackend($classname)</code></span></dt><dd><p>
Remove (unregister) a given backend.
</p></dd><dt><span class="term"><code class="literal">AddNewFileList($filelist)</code></span></dt><dd><p>
This macro is only available in TrEd.
Creates a new TrED filelist from a given <code class="literal">Filelist</code> object.
</p></dd><dt><span class="term"><code class="literal">RemoveFileList($filelist_object_or_name)</code></span></dt><dd><p>
This macro is only available in TrEd.  It disposes of a given filelist
(identified either by a <code class="literal">Filelist</code> object or by name) by removing it
from TrEd's internal list of open filelists.
</p></dd><dt><span class="term"><code class="literal">GetCurrentFileList($win?)</code></span></dt><dd><p>
This macro is only available in TrEd. It returns the current file-list
(a Filelist object) of this or a given window.
</p></dd><dt><span class="term"><code class="literal">GetFileList($name)</code></span></dt><dd><p>
This macro is only available in TrEd.
Finds a filelist of a given name in TrEd's internal list open filelists
and returns the corresponding <code class="literal">Filelist</code> object. Returns undef if not found.
</p></dd><dt><span class="term"><code class="literal">AbsolutizeFileName($relative_path,$base_path)</code></span></dt><dd><p>
Converts a relative path to an absolute path.  The returned value is
an absolute path or URI, computed relative to a given base_path (file
name or URI). The function is able to strip TrEd position suffixes
(##N, ##N.M, and #ID) from the relative path and reattach them to the
returned absolute path.
</p></dd><dt><span class="term"><code class="literal">SetCurrentFileList($name)</code></span></dt><dd><p>
This macro is only available in TrEd. Selects the filelist of a given
name for the current window.
</p></dd><dt><span class="term"><code class="literal">SetCurrentFileListInWindow($name, $win)</code></span></dt><dd><p>
This macro is only available in TrEd. Selects the filelist of a given
name for the given window.
</p></dd><dt><span class="term"><code class="literal">TrEdFileLists()</code></span></dt><dd><p>
This macro is only available in TrEd. It returns all registered
filelists.
</p></dd><dt><span class="term"><code class="literal">GetFileSaveStatus()</code></span></dt><dd><p>
Return 1 if the document was modified since last save or reload, 0
otherwise.
</p></dd><dt><span class="term"><code class="literal">SetFileSaveStatus()</code></span></dt><dd><p>
Use SetFileSaveStatus(1) to declare that some modification was made to
the file. Use SetFileSaveStatus(0) after the file was saved from a
macro (and TrEd/bTrEd would not notice that).
</p></dd><dt><span class="term"><code class="literal">DefaultInputEncoding()</code></span></dt><dd><p>
Return's TrEd's/bTrEd's default IO encoding.
</p></dd><dt><span class="term"><code class="literal">SetDefaultInputEncoding(encoding)</code></span></dt><dd><p>
Set TrEd's/bTrEd's default IO encoding.
</p></dd><dt><span class="term"><code class="literal">FileName()</code></span></dt><dd><p>
Return current file's name.
</p></dd><dt><span class="term"><code class="literal">FileMetaData(key,value?)</code></span></dt><dd><p>
Get or set meta data associated with the current <a class="link" href="">Treex::PML::Document</a>.  Key is the
meta data key. If value is omitted, current value associated with the
key is returned. Otherwise, the given value is associated with the
key, overwritting any previous value.
</p></dd><dt><span class="term"><code class="literal">FileUserData(key,value?)</code></span></dt><dd><p>
Get or set user data associated with the current <a class="link" href="">Treex::PML::Document</a>.  Key is the
user data key. If value is omitted, current value associated with the
key is returned. Otherwise, the given value is associated with the
key, overwritting any previous value.
</p></dd><dt><span class="term"><code class="literal">FileAppData(key,value?)</code></span></dt><dd><p>
Get or set application specific data associated with the current
<a class="link" href="">Treex::PML::Document</a>.  Key is the appData key. If value is omitted, current value
associated with the key is returned. Otherwise, the given value is
associated with the key, overwritting any previous value.
</p></dd><dt><span class="term"><code class="literal">GotoFileNo(n)</code></span></dt><dd><p>
Goto n'th file in the current filelist.
The number of the first file in filelist is 0.
</p></dd><dt><span class="term"><code class="literal">LastFileNo($win?)</code></span></dt><dd><p>
Return the index of the last file in the current filelist.
</p></dd><dt><span class="term"><code class="literal">CurrentFileNo($win?)</code></span></dt><dd><p>
Return the index of the current file in the current filelist.
</p></dd><dt><span class="term"><code class="literal">SaveAndNextFile()</code></span></dt><dd><p>
Save the current file and open the next file in the current file-list.
</p></dd><dt><span class="term"><code class="literal">NextFile()</code></span></dt><dd><p>
Goto next file in the file-list.
</p></dd><dt><span class="term"><code class="literal">SaveAndPrevFile()</code></span></dt><dd><p>
Save the current file and open the previous file in the current
file-list.
</p></dd><dt><span class="term"><code class="literal">PrevFile()</code></span></dt><dd><p>
Goto previous file in the file-list.
</p></dd></dl></div></div><div class="section" title="15.8.12. General I/O macros"><div class="titlepage"><div><div><h4 class="title"><a name="id595162"></a>15.8.12. General I/O macros</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">ResourcePaths()</code></span></dt><dd><div class="literallayout"><p><br>
Return the current list of directories used to search for<br>
resources.<br>
</p></div></dd><dt><span class="term"><code class="literal">SetResourcePaths(dirs)</code></span></dt><dd><p>
Set given list of directories as a current resource path (discarding
the existing values of ResourcePath).
</p></dd><dt><span class="term"><code class="literal">AddResourcePath(dirs)</code></span></dt><dd><p>
Add given directories to the end of the current resource path (to be
searched last).
</p></dd><dt><span class="term"><code class="literal">AddToResourcePathAsFirst(dirs)</code></span></dt><dd><p>
Add given directories to the beginning of the current resource path
(to be searched first).
</p></dd><dt><span class="term"><code class="literal">RemoveResourcePath(dir-paths)</code></span></dt><dd><p>
Remove given directories from the current resource path (directory
paths must exactly match those listed in the resource path).
</p></dd><dt><span class="term"><code class="literal">FindDirInResources(dirname)</code></span></dt><dd><p>
If a given dirname is a relative path of a directory found in TrEd's
resource directory, return an absolute path for the
resource. Otherwise return dirname.
</p></dd><dt><span class="term"><code class="literal">FindInResources(filename)</code></span></dt><dd><p>
If a given filename is a relative path of a file found in TrEd's
resource directory, return an absolute path for the
resource. Otherwise return filename.
</p></dd><dt><span class="term"><code class="literal">ResolvePath(ref-filename,filename,use_resources?)</code></span></dt><dd><p>
If a given filename is a relative path, try to find the file in the
same directory as ref-filename. In case of success, return a path
based on the directory part of ref-filename and filename.  If the file
cannot be located in this way and use_resources is true, return the
value of <code class="literal">FindInResources(filename)</code>.
</p></dd><dt><span class="term"><code class="literal">SlurpURI($filename_or_uri,$chomp?)</code></span></dt><dd><p>
Given a file name or URI of a resource, the macro returns the content
of the resource. In array context the return value is a list of lines,
in scalar context the value is a scalar. If the chomp flag is true,
chomp() is applied to the returned array or scalar.
</p></dd><dt><span class="term"><code class="literal">writeln(string?,...)</code></span></dt><dd><p>
Print the arguments to standard output appending a new-line if missing.
</p></dd><dt><span class="term"><code class="literal">stdout(string?,...)</code></span></dt><dd><p>
If called without arguments return current standard output filehandle.
Otherwise call print the arguments to standard output.
</p></dd><dt><span class="term"><code class="literal">stderr(string?,...)</code></span></dt><dd><p>
If called without arguments return current standard error output
filehandle.  Otherwise call print the arguments to standard output.
</p></dd><dt><span class="term"><code class="literal">tmpFileName()</code></span></dt><dd><p>
Returns a temporary filename..
</p></dd><dt><span class="term"><code class="literal">DirPart($path)</code></span></dt><dd><p>
Returns directory part of a given path (including volume).
</p></dd><dt><span class="term"><code class="literal">FilePart($path)</code></span></dt><dd><p>
Returns file-name part of a given path.
</p></dd><dt><span class="term"><code class="literal">CallerPath()</code></span></dt><dd><p>
Return path of the perl module or macro-file that invoked this macro.
</p></dd><dt><span class="term"><code class="literal">CallerDir($rel_path?)</code></span></dt><dd><p>
If called without an argument, returns the directory of the perl
module or macro-file that invoked this macro.
</p><p>
If a relative path is given as an argument, a respective absolute path
is computed based on the caller's directory and returned.
</p></dd><dt><span class="term"><code class="literal">FindMacroDir($rel_dir)</code></span></dt><dd><p>
Searches for a given relative path in directories with user-defined
macros and returns an absolute path to the first directory that matches.
</p></dd></dl></div></div><div class="section" title="15.8.13. Printing trees"><div class="titlepage"><div><div><h4 class="title"><a name="sect-0"></a>15.8.13. Printing trees</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">PrintDialog(-option =&gt; value,...)</code></span></dt><dd><p>
Display TrEd's standard print dialog. Possible options providing
substitutes for the default values in the print dialog are:
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">-command</code></span></dt><dd><p>
System command to send the output to (e.g. <code class="literal">lpr</code> to print on the
default printer on UNIX platform).
</p></dd><dt><span class="term"><code class="literal">-toFile</code></span></dt><dd><p>
If set to 1, the output is saved to a file specified in <code class="literal">-filename</code>.
</p></dd><dt><span class="term"><code class="literal">-filename</code></span></dt><dd><p>
Output filename.
</p></dd><dt><span class="term"><code class="literal">-fileExtension</code></span></dt><dd><p>
Default output file extension.
</p></dd><dt><span class="term"><code class="literal">-format</code></span></dt><dd><p>
One of PS, PDF, EPS, ImageMagick. Default is PS.
</p></dd><dt><span class="term"><code class="literal">-imageMagickResolution</code></span></dt><dd><p>
This value is passed to the command <code class="literal">convert</code> of the ImageMagick
toolkit as <code class="literal">-density</code>. It specifies the horizontal and vertical
resolution in pixels of the image.
</p></dd><dt><span class="term"><code class="literal">-noRotate</code></span></dt><dd><p>
Disable automatic landscape rotation of trees which are wider than
taller.
</p></dd><dt><span class="term"><code class="literal">-sentenceInfo</code></span></dt><dd><p>
If set to 1, this command prints also the text associated with the
tree. Instead of 0 or 1, an CODE reference (subroutine) may be passed
in this parameter. This CODE is then evaluated for every tree to
produce the desired text. The CODE obtains two arguments: the current
<a class="link" href="">Treex::PML::Document</a> object and an integer position of the tree (starting from 0).
</p></dd><dt><span class="term"><code class="literal">-fileInfo</code></span></dt><dd><p>
If true, print filename and tree number under each tree.
</p></dd><dt><span class="term"><code class="literal">-colors</code></span></dt><dd><p>
Set to 1 for colour output.
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">Print(-option =&gt; value,...)</code></span></dt><dd><p>
Print trees given from current file according to given printing options:
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">-range</code></span></dt><dd><p>
Lists trees to be printed (e.g. <code class="literal">5,-3,9-12,15-</code> prints trees
5,1,2,3,9,10,11,12,15,16,...)
</p></dd><dt><span class="term"><code class="literal">-to</code></span></dt><dd><p>
Possible values: file (print to file specified by <code class="literal">-filename</code>),
(send output to ImageMagick convert, see <code class="literal">-convert</code>),
pipe (send output to the standard input of command <code class="literal">-command</code>),
string (return output as a string), object (return output as an object -
the exact type of the value depends on the output format).
</p></dd><dt><span class="term"><code class="literal">-command</code></span></dt><dd><p>
System command to send the output to (usually default to <code class="literal">lpr</code> on UNIX platform).
</p></dd><dt><span class="term"><code class="literal">-convert</code></span></dt><dd><p>
Path to ImageMagick 'convert' command.
</p></dd><dt><span class="term"><code class="literal">-filename</code></span></dt><dd><p>
Output filename (only when printing to file).
</p></dd><dt><span class="term"><code class="literal">-format</code></span></dt><dd><p>
One of PS, PDF, EPS, ImageMagick. Default is PS.
</p></dd><dt><span class="term"><code class="literal">-noRotate</code></span></dt><dd><p>
Disable automatic landscape rotation of trees which are wider than
taller.
</p></dd><dt><span class="term"><code class="literal">-sentenceInfo</code></span></dt><dd><p>
If set to 1, this command prints also the text associated with the
tree. Instead of 0 or 1, a CODE reference (subroutine) may be passed
in this parameter. This CODE is then evaluated for every tree to
produce the desired text. The CODE obtains two arguments: the current
<a class="link" href="">Treex::PML::Document</a> object and an integer position of the tree (starting from 0).
</p></dd><dt><span class="term"><code class="literal">-fileInfo</code></span></dt><dd><p>
If true, print filename and tree number under each tree.
</p></dd><dt><span class="term"><code class="literal">-imageMagickResolution</code></span></dt><dd><p>
This value is passed to the command <code class="literal">convert</code> of the ImageMagick
toolkit as <code class="literal">-density</code>. It specifies the horizontal and vertical
resolution in pixels of the image.
</p></dd><dt><span class="term"><code class="literal">-colors</code></span></dt><dd><p>
Set to 1 for colour output.
</p></dd><dt><span class="term"><code class="literal">-hidden</code></span></dt><dd><p>
Set to 1 to print hidden nodes.
</p></dd><dt><span class="term"><code class="literal">-psFontFile</code></span></dt><dd><p>
Specifies the PostScript font file to be used instead of the default
one.
</p></dd><dt><span class="term"><code class="literal">--psFontAFMFile</code></span></dt><dd><p>
Specifies the PostScript ASCII metric font file to be used instead of
the default one.
</p></dd><dt><span class="term"><code class="literal">-ttFont</code></span></dt><dd><p>
Specifies the TrueType font file to be used when printing via PDF.
</p></dd><dt><span class="term"><code class="literal">-fontSize</code></span></dt><dd><p>
Font size.
</p></dd><dt><span class="term"><code class="literal">-fmtWidth</code></span></dt><dd><p>
Page width.
</p></dd><dt><span class="term"><code class="literal">-fmtHeight</code></span></dt><dd><p>
Page height.
</p></dd><dt><span class="term"><code class="literal">-hMargin</code></span></dt><dd><p>
The size of the left and right horizontal margins.
</p></dd><dt><span class="term"><code class="literal">-vMargin</code></span></dt><dd><p>
The size of the top and bottom margins.
</p></dd><dt><span class="term"><code class="literal">-maximize</code></span></dt><dd><p>
Expand small trees to fit the whole page size. (Shrinking is done
automatically).
</p></dd><dt><span class="term"><code class="literal">-psMedia</code></span></dt><dd><p>
Specifies target given media size (used for PostScript and PDF).
Possible values:
</p><p>
User (dimensions specified in -fmtHeight and -fmtWidth), BBox
(bounding box of the tree with only -hMargin and -vMargin added),
Letter, LetterSmall, Legal, Statement, Tabloid, Ledger, Folio, Quarto,
Executive, A0, A1, A2, A3, A4, A4Small, A5, A6, A7, A8, A9, A10, B0,
B1, B2, B3, B4, B5, B6, B7, B8, B9, B10, ISOB0, ISOB1, ISOB2, ISOB3,
ISOB4, ISOB5, ISOB6, ISOB7, ISOB8, ISOB9, ISOB10, C0, C1, C2, C3, C4,
C5, C6, C7, 7x9, 9x11, 9x12, 10x13, 10x14
</p></dd><dt><span class="term"><code class="literal">-stylesheet</code></span></dt><dd><p>
Name of the stylesheet to use (defaults to the current stylesheet).
</p></dd><dt><span class="term"><code class="literal">-toplevel</code></span></dt><dd><p>
Toplevel window (e.g. ToplevelFrame()) if you wish for graphical progress
indicator.
</p></dd></dl></div></dd></dl></div></div><div class="section" title="15.8.14. Other macros"><div class="titlepage"><div><div><h4 class="title"><a name="id595864"></a>15.8.14. Other macros</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">quit()</code></span></dt><dd><p>
This command acts just like a <code class="literal">die</code> but without producing any error
message at all. It can be used to immediatelly stop execution of the
macro code and returning control to TrEd or btred (in which case btred
starts processing the next file) but does not propagate through
<code class="literal">eval{}</code>, so it can also be trapped.
</p><p>
Note that hooks that my follow execution of the macro code (such as
file_close_hook or exit_hook in btred) are executed as if the macro
ended normally.
</p></dd></dl></div></div><div class="section" title="15.8.15. Implementation of TredMacro::import"><div class="titlepage"><div><div><h4 class="title"><a name="id595898"></a>15.8.15. Implementation of TredMacro::import</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">import(names?)</code></span></dt><dd><p>
If specified without parameter, exports every symbol to the caller
package (except for symbols already (re)defined in the caller
package). If parameters are given, exports only names specified by
the parameters and the following few variables that every package
derived from TredMacro (e.g. a context)  <span class="emphasis"><em>must</em></span> share: <code class="literal">$libDir</code>,
<code class="literal">$grp</code>, <code class="literal">$root</code>, <code class="literal">$this</code> <code class="literal">$_NoSuchTree</code> <code class="literal">$Redraw</code>,
<code class="literal">$forceFileSaved</code>, <code class="literal">$FileChanged</code>, <code class="literal">$FileNotSaved</code>,
<code class="literal">$NodeClipboard</code>.
</p></dd></dl></div></div><div class="section" title="15.8.16. XPath extension (slow)"><div class="titlepage"><div><div><h4 class="title"><a name="id595960"></a>15.8.16. XPath extension (slow)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">SetupXPath(function-mapping...)</code></span></dt><dd><div class="literallayout"><p><code class="literal">SetupXPath(<br>
            id         =&gt; \&amp;find_node_by_id,<br>
            pos        =&gt; \&amp;node_position,<br>
            attributes =&gt; \&amp;node_attributes_hashref,<br>
            name       =&gt; \&amp;node_name,<br>
            value      =&gt; \&amp;node_value,<br>
            children   =&gt; \&amp;node_children,<br>
            parent     =&gt; \&amp;node_parent,<br>
            lbrother   =&gt; \&amp;node_left_sibling,<br>
            rbrother   =&gt; \&amp;node_right_sibling,<br>
           )</code></p></div><p>
This macro requires <code class="literal">XML::XPath</code> module to be installed.  It adjusts
<a class="link" href="">Treex::PML::Node</a> API to match XPath model based on a given function mapping.  By
default, 'id' is defined to return nothing, 'pos' returns nodes
sentence-ordering position (or depth-first-ordering position if sentord
attribute is not defined), 'attributes' returs a hashref of node's
attributes (actually a <a class="link" href="">Treex::PML::Node</a> itself), 'name' returns "node", 'value'
returns node's value of the special FS value attribute, and
'children', 'parent', 'lbrother', and 'rbrother' all default to the
respective <a class="link" href="">Treex::PML::Node</a> methods.
</p><p>
Usage example:
</p><div class="literallayout"><p><code class="literal">SetupXPath(id    =&gt; sub { $hashed_ids{ $_[0] } },<br>
           name  =&gt; sub { $_[0]-&gt;{functor} }<br>
           value =&gt; sub { $_[0]-&gt;{t_lemma} });</code></p></div><div class="literallayout"><p><code class="literal">foreach ($node-&gt;findnodes(q{//ACT/PAT[starts-with(@tag,"N") or .="ano"]})) {<br>
    # process matching nodes<br>
}</code></p></div></dd></dl></div></div></div><div class="section" title="15.9. Hooks: automatically executed macros"><div class="titlepage"><div><div><h3 class="title"><a name="hooks"></a>15.9. Hooks: automatically executed macros</h3></div></div></div><p>
	There is a special set of macros that was not
	mentioned yet. These macros, called hooks, are automatically
	executed by <span class="application">TrEd</span> on certain
	occasions. By defining such macros a little more of the
	<span class="application">TrEd</span>'s implicit behaviour may be
	influenced, for example the execution of a planned action may
	be aborted.
      </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Writing hooks correctly is a little bit more difficult than
	  writing simple macros. An incorrectly written hook may result
	  in errorneous behavior of <span class="application">TrEd</span>,
	  which in some cases may even lead to a crash. When in doubt
	  about where exactly is a particular hook called, with what parameters
	  and what it is expected to do, it is best to peek directly
	  into <code class="filename">tred</code> or <code class="filename">btred</code>
	  sources. The possibility of doing so is one of the nice
	  advantages of dealing with free software - in the Richard Stallman's
	  sense - the joy of which I feel obliged not to deprive you of.
	</p></div><p>
	Hooks differ from other macros in the following aspects:
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>User cannot choose a name for a hook; on the
	      contrary, hook is recognized as a macro having a
	      special name identifying it as being a certain hook.
	    </p></li><li class="listitem"><p>Sometimes parameters are passed to hooks.</p></li><li class="listitem"><p>No modifications of the tree or current node
	      are reflected after the hook returns, i.e. the tree is not
	      redrawn, changes to <code class="literal">$this</code> variable
	      are not reflected. If necessary, a hook must provide this
	      functionality itself.
	    </p></li><li class="listitem"><p>
	      Unlike macros, hooks are not expected to modify
	      the tree unless they explicitly state that, typically
	      by calling 
	      <code class="literal">ChangingFile(1)</code>.
	    </p></li></ol></div><p>
      </p><p>
	There is a special class of hooks that may be used to prevent
	<span class="application">TrEd</span> from finishing a planned
	action, e.g. enabling the user to modify certain attribute
	value etc. The value returned by a hook of this class is checked and
	the action is aborted in case the value equals to
	<span class="quote">&#8220;<span class="quote"><code class="literal">stop</code></span>&#8221;</span>.
      </p><p>In the following table the hooks which may be used to
	prevent <span class="application">TrEd</span> from executing a
	certain action are marked by <code class="literal">yes</code> in the
	column <span class="quote">&#8220;<span class="quote">Stop</span>&#8221;</span>.
      </p><div class="table"><a name="id580727"></a><p class="title"><b>Table 7. Hooks</b></p><div class="table-contents"><table summary="Hooks" border="1"><colgroup><col align="left"><col align="center"><col align="justify"></colgroup><thead><tr><th align="left">Name</th><th align="center">Stop</th><th align="justify">Hook event description</th></tr></thead><tbody><tr><td align="left"><a name="about_file_hook"></a><code class="literal">about_file_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>stringref</code></em></code></p><p>This hook is executed before the
		<span class="guilabel">About</span> window is displayed.
		The hook takes one argument: a reference to a scalar
		variable. The hook may populate the referenced
		variable with any information which is then displayed
		as a part of the <span class="guilabel">About</span> window message.
	      </p></td></tr><tr><td align="left"><a name="after_autosave_hook"></a><code class="literal">after_autosave_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>output_filename</code></em></code>, 
		  <code class="literal"><em class="replaceable"><code>success</code></em></code>
		</p><p>Executed after TrEd's attempt to auto-save a file.
		  This hook is intended to be used e.g. for post-processing
		  of auto-saved files.
		  The hook obtains the filename of the auto-saved file
		  and a save status
		  (which is 1 in case of success and 0 or undefined if auto-saving failed). 
		  Warnings or die messages produced by the hook
		  appear as warnings on the standard output.
		  The hook may return the string <code class="literal">"stop"</code> to
		  indicate that TrEd should consider auto-saving failed.
		</p>
	      </td></tr><tr><td align="left"><a name="after_edit_attr_hook"></a><code class="literal">after_edit_attr_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>attr</code></em>,<em class="replaceable"><code>result</code></em></code></p><p>Executed after a node's attribute was edited
		in the <span class="guilabel">Edit Attribute</span>
		dialog window. The <em class="replaceable"><code>result</code></em>
		argument contains <code class="literal">1</code> if the user pressed
		<span class="guibutton">Ok</span> button to close the dialog,
		and it contains <code class="literal">0</code> if the user
		closed the dialog with the
	      <span class="guibutton">Close</span> button.
	      </p></td></tr><tr><td align="left"><a name="after_edit_node_hook"></a><code class="literal">after_edit_node_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>result</code></em></code></p><p>Executed after a node's attribute values were edited
		in the <span class="guilabel">Edit Node ...</span>
		dialog window. The <em class="replaceable"><code>result</code></em>
		argument contains <code class="literal">1</code> if the user pressed
		<span class="guibutton">Ok</span> button to close the dialog,
		and it contains <code class="literal">0</code> if the user
		closed the dialog with the
	      <span class="guibutton">Close</span> button.
	      </p></td></tr><tr><td align="left"><a name="after_redraw_hook"></a><code class="literal">after_redraw_hook</code></td><td align="center">no</td><td align="justify"><p>Executed every time a tree is redrawn.
	      The hook gets a TrEd::TreeView object as an argument.</p></td></tr><tr><td align="left"><a name="after_save_hook"></a><code class="literal">after_save_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>output_filename</code></em></code>, 
		  <code class="literal"><em class="replaceable"><code>success</code></em></code>
		</p><p>Executed after TrEd's attempt to save a file
		  (but not after auto-saves).
		  This hook is intended to be used e.g. for post-processing
		  of saved files.
		  The hook obtains the filename and a save status
		  (which is 1 in case of success and 0 or undefined if saving failed). 
		  Warnings or die messages produced by the hook
		  are presented to the user as warnings.
		  The hook may return the string <code class="literal">"stop"</code> to
		  indicate that TrEd should abort further actions
                  like opening a next file, etc. 
		  The document is however considered to be saved.
		  The hook may return the string <code class="literal">"stop_nonfatal"</code>  to indicate that TrEd should abort further actions
                  like opening a next file, etc, 
		  keep the output file but
		  consider the document not saved.
                  Finally, the hook may return the string <code class="literal">"stop_fatal"</code>
		  to make TrEd revert the output file from a backup and report the save operation as failed; the document is considered not saved.
		</p></td></tr><tr><td align="left"><a name="allow_switch_context_hook"></a><code class="literal">allow_switch_context_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>previous</code></em>,<em class="replaceable"><code>next</code></em></code></p><p>Executed in the new annotation mode, but before the 
		annotation mode is actually changed (see <a class="xref" href="ar01s15.html#contexts" title="15.10. Using different sets of macros in different situations">Section 15.10, &#8220;Using different sets of macros in different situations&#8221;</a>)
		and before <code class="literal">pre_switch_context_hook</code>
		is called (in the old-annotation mode).
		The <em class="replaceable"><code>previous</code></em> argument
		contains the name of the current annotation mode while
		<em class="replaceable"><code>next</code></em> contains the name of the
		target annotation mode.
	      </p></td></tr><tr><td align="left"><a name="attr_choices_hook"></a><code class="literal">attr_choices_hook</code></td><td align="center">no</td><td align="justify"><p>Executed when a CDATA attribute value
	      is editied in the 
	      <a class="link" href="ar01s08.html#new_editnode_interface" title="8.2. New interface">attribute editor</a>
	      and may be used to provide a list of values
	      to offer to the user using a list box. The hook gets the following
	      arguments:
	      an attribute path, the node, the <code class="literal"><a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Schema/Decl.pm" target="_top">Treex::PML::Schema::Decl</a></code> object
	      corresponding to the attribute type, and
	      a reference to the <code class="literal">Tk::TrEdNodeEdit</code>
	      which is an object derived from <code class="literal">Tk::HList</code>.
	      The hook may return a reference to a list of strings.
	      </p></td></tr><tr><td align="left"><a name="attr_validate_hook"></a><code class="literal">attr_validate_hook</code></td><td align="center">no</td><td align="justify"><p>
		Executed when the user modifies a CDATA attribute value
		in the
		<a class="link" href="ar01s08.html#new_editnode_interface" title="8.2. New interface">attribute editor</a>.
		May be used to provide custom validation
		for attribute values. The hook gets the following
		arguments:
		current value of the attribute,
		an attribute path, the node, the <code class="literal"><a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Schema/Decl.pm" target="_top">Treex::PML::Schema::Decl</a></code> object
		corresponding to the attribute type, and
		a reference to the <code class="literal">Tk::TrEdNodeEdit</code>
		which is an object derived from <code class="literal">Tk::HList</code>.
		The hook must return a non-zero defined value to indicate that the value is valid
		or 0 to indicate that the value is invalid.
		If the hook returns undef, the default <code class="literal"><a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Schema.pm" target="_top">Treex::PML::Schema</a></code>-based validation
		takes place.
	      </p></td></tr><tr><td align="left"><a name="current_node_change_hook"></a><code class="literal">current_node_change_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>current_node</code></em>,<em class="replaceable"><code>prev_current_node</code></em></code></p><p>executed when a new active node is selected.</p></td></tr><tr><td align="left"><a name="customize_attrs_hook"></a><code class="literal">customize_attrs_hook</code></td><td align="center">yes</td><td align="justify"><p>Executed before the dialog for customizing attribute
		patterns is displayed.
	      </p></td></tr><tr><td align="left"><a name="determine_node_type_hook"></a><code class="literal">determine_node_type_hook</code></td><td align="center">no</td><td align="justify"><p>Executed when TrEd attempts to determine
	      the node type of a node that has no type associated with it.
	      The hook may be used to set type of the node.
	      Otherwise the user is asked to choose the node type
	      (if ambiguous). Gets the node as an argument.
	      </p></td></tr><tr><td align="left"><a name="do_edit_attr_hook"></a><code class="literal">do_edit_attr_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>attr</code></em>,<em class="replaceable"><code>node</code></em></code></p><p>
		Executed before a dialog window for editing an
		attribute value is displayed (usually when the 
		user double-clicks the displayed attribute value).
		If <code class="literal">stop</code> is returned,
		the dialog is suppressed.
	      </p></td></tr><tr><td align="left"><a name="do_edit_node_hook"></a><code class="literal">do_edit_node_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em></code></p><p>Executed before the <span class="guilabel">Edit Node</span>
		dialog is displayed, i.e. when the user
		double-clicks a node, presses <span class="keysym">Enter</span> in the
		main window or issues <span class="guimenu">Node</span> &#8594; <span class="guimenuitem">Edit Node Attributes...</span>.
		If the hook returns <code class="literal">stop</code>, the dialog is suppressed.
	      </p></td></tr><tr><td align="left"><a name="enable_attr_hook"></a><code class="literal">enable_attr_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>attr</code></em>,<em class="replaceable"><code>type</code></em>,<em class="replaceable"><code>node</code></em></code></p><p>
		Executed before any text field for an attribute value
		modification or list of possible values
		is created. If the hook returns
		<span class="quote">&#8220;<span class="quote"><code class="literal">stop</code></span>&#8221;</span>,
		the field or list is made read-only. The
		<em class="replaceable"><code>type</code></em>
		argument may have one of the following values:
		<code class="literal">ambiguous</code> (in case
		of multiple values or an attribute with
		a given list of possible values) or
		<code class="literal">normal</code>.
		The argument <em class="replaceable"><code>node</code></em>
		is the node whose attribute is to be edited.
		If this hook returns <code class="literal">stop</code>, the 
		corresponding edit fields in a displayed dialog are
		disabled (read-only); for a dialog that only displays
		the particular attribute, this means that the confirmation 
		<span class="guibutton">OK</span> button is removed.
	      </p></td></tr><tr><td align="left"><a name="enable_edit_node_hook"></a><code class="literal">enable_edit_node_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em></code></p><p>Executed before the <span class="guilabel">Edit Node</span>
		dialog is displayed, i.e. when the user
		double-clicks a node, presses <span class="keysym">Enter</span> in the
		main window or issues <span class="guimenu">Node</span> &#8594; <span class="guimenuitem">Edit Node Attributes...</span>, but
		after <code class="literal">do_edit_node_hook</code> was called (and
		only if it didn't return <code class="literal">stop</code>). 
		If this hook returns <code class="literal">stop</code>, the dialog is
		displayed, but only with a <span class="guibutton">Cancel</span>
		button, i.e. making it impossible to confirm and save the edits.
	      </p></td></tr><tr><td align="left"><a name="event_hook"></a><code class="literal">event_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>Tk-XEvent</code></em>,<em class="replaceable"><code>Tk-win</code></em>,<em class="replaceable"><code>shortcuts...</code></em></code></p><p>This is a very low-level hook, executed when a non-predefined keyboard shortcut
		was issued. It can be used to block certain keyboard events
		(in which case it should return <code class="literal">stop</code>) or 
		to provide <span class="quote">&#8220;<span class="quote">on-the-fly</span>&#8221;</span> bindings (by returning
		the name of a macro to be executed).
		The first argument is an Tk::XEvent object which can be used to
		obtain a detailed information of the event. The second argument
		is a Tk::Widget that caught the event and the rest of the
		arguments are keyboard-binding shortcuts computed from the event
		(these are the shortcuts that TrEd would try to look up in the current annotation mode
		bindings if this hook returns no macro name).
	      </p></td></tr><tr><td align="left"><a name="exit_hook"></a><code class="literal">exit_hook</code></td><td align="center">no</td><td align="justify"><p>Executed when the main window
		of <span class="application">TrEd</span> is destroyed,
		before the user is prompted to save the modified files.
	      </p></td></tr><tr><td align="left"><a name="file_autosave_hook"></a><code class="literal">file_autosave_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>fsfile</code></em></code></p><p>Executed before TrEd attempts to create an auto-save file
		for the given<em class="replaceable"><code>fsfile</code></em>. Note that
		this is not necessarily the file displayed in the
		active view and accessible via the <code class="literal">$grp</code> variable.
	      </p></td></tr><tr><td align="left"><a name="file_close_hook"></a><code class="literal">file_close_hook</code></td><td align="center">no</td><td align="justify"><p>Executed before TrEd attempts to close a file
		(this hook is called even if the file remains open
		but postponed if the close fails e.g. because
		the file being closed is required by another open file).</p></td></tr><tr><td align="left"><a name="file_opened_hook"></a><code class="literal">file_opened_hook</code></td><td align="center">no</td><td align="justify"><p>Executed after a file is opened but before the first
		tree is displayed.
	      </p></td></tr><tr><td align="left"><a name="file_reloaded_hook"></a><code class="literal">file_reloaded_hook</code></td><td align="center">no</td><td align="justify"><p>Executed after a file has been successfully
		  reloaded during the <span class="guibutton">Reload file</span>
		  action accessible from TrEd's main
		  <a class="link" href="ar01s06.html" title="6. Toolbar">tollbar</a>.
		  (Note that this is the only hook called during this 
		  action, since
		  neither <a class="link" href="ar01s15.html#file_opened_hook">file_opened_hook</a>
		  nor <a class="link" href="ar01s15.html#file_resumed_hook">file_resumed_hook</a> are called!)
	      </p></td></tr><tr><td align="left"><a name="guess_context_hook"></a><code class="literal">guess_context_hook</code></td><td align="center">no</td><td align="justify"><p>This hook is defined
	      in the default <code class="filename">tredlib/contrib/contrib.mac</code> file
	      and there is usually no need to redefine it!
	      Instead, use
	      </p><pre class="programlisting">context_guessing { <em class="replaceable"><code>...callback-code...</code></em> };</pre><p>
	      or (for compatibility with older TrEd versions)
	      </p><pre class="programlisting">push @TredMacro::AUTO_CONTEXT_GUESSING, sub { <em class="replaceable"><code>...callback-code...</code></em> };</pre><p>
	      where <em class="replaceable"><code>...callback-code...</code></em> is a code
	      that attempts to detect a suitable annotation mode for the current file and
	      return the annotation mode name if successful. If the callback code
	      cannot positively determine a suitable annotation mode, it should return nothing (empty list).
	      The standard <code class="literal">guess_context_hook</code> will
	      call all registered callbacks one by one (but in no particular order) until
	      it gets a defined value and will then use
	      the value to set a the current annotation mode.
	      The callbacks are supposed to be very reserved,
	      i.e. they should only return some annotation mode name if
	      the file schema, attribute-set or whatever exactly
	      matches the data type for which the particular annotation 
	      mode is primarily intended. This will prevent
	      extensions to steal files one from another.
	    </p>
	    </td></tr><tr><td align="left"><a name="file_resumed_hook"></a><code class="literal">file_resumed_hook</code></td><td align="center">no</td><td align="justify"><p>Executed after an already open (kept) file is resumed.</p></td></tr><tr><td align="left"><a name="file_save_hook"></a><code class="literal">file_save_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>output_filename</code></em></code></p><p>Executed before TrEd attempts to save a file.</p></td></tr><tr><td align="left"><a name="get_backends_hook"></a><code class="literal">get_backends_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>backends...</code></em></code></p><p>Executed before a new file is opened. It receives a list 
		of available I/O backends known by TrEd as arguments. It should
		return a new array-ref consisting of backends that TrEd
		should actually try to use. This may be used both to
		add custom backends to the list or to prevent some
		standard backends from being used (by omitting them in the
		returned array-ref).
	      </p></td></tr><tr><td align="left"><a name="get_nodelist_hook"></a><code class="literal">get_nodelist_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>fsfile</code></em>,<em class="replaceable"><code>treeNo</code></em>,<em class="replaceable"><code>recentActiveNode</code></em>,<em class="replaceable"><code>show_hidden</code></em></code></p><p>This hook may be used to supply
	      custom node ordering given a fsfile, treeNo and hidden
	      node visibility state.  If used, it should return a
	      two-element array reference with the first element being
	      a array reference to a list of nodes to be displayed (in
	      a left-to-right order) and the second element being a
	      node to be set up as the initial active node.
	      </p></td></tr><tr><td align="left"><a name="get_status_line_hook"></a><code class="literal">get_status_line_hook</code></td><td align="center">no</td><td align="justify"><p>Supply status-line content.
		This hook is responsible for providing the content for
		a status-line. The value returned from 
		<code class="literal">get_status_line_hook</code> should
		have the form 
		<code class="literal">[<em class="replaceable"><code>field-definitions</code></em>,
		  <em class="replaceable"><code>style-definitions</code></em>,
		  ]</code>.
		<em class="replaceable"><code>field-definitions</code></em>
		is an array reference of the form
		<code class="literal">[<em class="replaceable"><code>text1</code></em>,<em class="replaceable"><code>tags1</code></em>,
		  <em class="replaceable"><code>text2</code></em>,<em class="replaceable"><code>tags2</code></em>,...
		  ]</code> specifying
		one or more pieces of textual content of the
		status-line. Each piece of text is followed
		by another array reference, containing a list of
		<code class="literal">tags</code> associated with the text.
		Tags may be arbitrary strings.
		<em class="replaceable"><code>style-definitions</code></em> is 
		an array reference which can map some tags
		to visual appearance attributes. It has a form
		<code class="literal">[<em class="replaceable"><code>tag1</code></em>,
		  [<em class="replaceable"><code>option =&gt; value</code></em>,
	      <em class="replaceable"><code>option =&gt; value</code></em>, ...],
		  <em class="replaceable"><code>tag2</code></em>,
		  [<em class="replaceable"><code>option =&gt; value</code></em>,
		  <em class="replaceable"><code>option =&gt; value</code></em>, ...], ...
		  ]</code>
		where <em class="replaceable"><code>option</code></em> may
		be one of <code class="literal">-foreground</code>,
		<code class="literal">-background</code> and <code class="literal">-underline</code>.
	      </p></td></tr><tr><td align="left"><a name="get_value_line_hook"></a><code class="literal">get_value_line_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>fsfile</code></em>,<em class="replaceable"><code>treeNo</code></em>,<em class="replaceable"><code>type</code></em></code></p><p>Supply custom value-line content based on given
		<em class="replaceable"><code>fsfile</code></em>,
		<em class="replaceable"><code>treeNo</code></em>, and 
		<em class="replaceable"><code>type</code></em>,
		where type determines the situation
		in which the hook is used:
		<code class="literal">value_line</code> (value is used 
		as the content of the value line, i.e.
		the text field
		above tree views),
		<code class="literal">print</code> (value used for a label
		under a printed tree),
		<code class="literal">sent_list</code> (value used
		in the list of sentences),
		<code class="literal">html</code>
		(value used for HTML export).
		</p><p>
		The value returned from the hook may be either 
		a string or an array reference
		consisting of a list of array references
		representing individual nodes. In the later case,
		the array references representing individual nodes
		must be of the form
		<code class="literal">[<em class="replaceable"><code>text</code></em>,
		  <em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>options...</code></em>]</code>
		where <em class="replaceable"><code>text</code></em> is a text
		to be used,
		<em class="replaceable"><code>node</code></em>
		is the node represented by the array reference
		and <code class="literal">options...</code> is arbitrary set 
		of strings (tags). If these strings are of the form
		<code class="literal">-option =&gt; value</code>
		where <code class="literal">option</code> is
		one of <code class="literal">foreground</code>,
		<code class="literal">background</code>,
		<code class="literal">underline</code>,
		they are used to alter visual appearance
		of the corresponding part of the text displayed on the
		value-line. All other strings are used as tags	
		(<code class="literal">value_line</code> type only)
		and are passed to hooks
		like
		<a class="link" href="ar01s15.html#value_line_doubleclick_hook">value_line_doubleclick_hook</a> or <a class="link" href="ar01s15.html#value_line_click_hook">value_line_click_hook</a> if the user clicks the corresponding part of the text.
	      </p></td></tr><tr><td align="left"><a name="goto_file_hook"></a><code class="literal">goto_file_hook</code></td><td align="center">yes</td><td align="justify"><p>
		Executed before the next or previous file in the current
		file list is opened.
	      </p></td></tr><tr><td align="left"><a name="highlight_value_line_tag_hook"></a><code class="literal">highlight_value_line_tag_hook</code></td><td align="center">no</td><td align="justify">
		<p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em></code></p>
		<p>Invoked every time a node is selected. The hook should
		return a tag associated with some text in the value
		line. The text is then highlighted in the value line.</p></td></tr><tr><td align="left"><a name="init_hook"></a><code class="literal">init_hook</code></td><td align="center">yes</td><td align="justify"><p>Executed on start-up, before the first file specified on
		the command-line is opened (i.e. also before the <code class="literal">start_hook</code>).</p></td></tr><tr><td align="left"><a name="initialize_bindings_hook"></a><code class="literal">initialize_bindings_hook</code></td><td align="center">no</td><td align="justify"><p>Executed immediatelly after macros are loaded or re-loaded.
	      The hook has no arguments.
	      </p></td></tr><tr><td align="left"><a name="line_click_hook"></a><code class="literal">line_click_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>tag</code></em>,<em class="replaceable"><code>button</code></em>,<em class="replaceable"><code>double</code></em>,<em class="replaceable"><code>mod</code></em>,<em class="replaceable"><code>XEvent</code></em></code></p><p>Called when a line (segment of an edge) is clicked or double-clicked. Argument values are as follows:
		  <em class="replaceable"><code>node</code></em> is the node the line pertains to (i.e. the one whose stylesheet specification caused the line to be drawn); <em class="replaceable"><code>tag</code></em>
		  is the part of the stylesheet value <code class="literal">Line-tag</code>
		  corresponding to the particular segment of the  line;
		  <em class="replaceable"><code>button</code></em> is the number of mouse button (1,2,3);
		  <em class="replaceable"><code>double</code></em> is 1 if the event was a double-click
		  and 0 otherwise; <em class="replaceable"><code>mod</code></em>
		  is a keyboard modifier (<code class="literal">Control</code>,
		<code class="literal">Shift</code>,
		<code class="literal">Alt</code>, or
		<code class="literal">Meta</code>);
		  <em class="replaceable"><code>XEvent</code></em> is a <code class="literal">Tk::XEvent</code> object
		  which can be used to obtain detailed information
		  of the event (such as position of the mouse pointer, etc.).
		  The hook is responsible for calling
		<code class="literal">Redraw_FSFile_Tree()</code> or
		similar default macro to redraw the tree as well as for 
		setting <code class="literal">$FileChanged=1</code> if needed.
	      </p></td></tr><tr><td align="left"><a name="macros_reloaded_hook"></a><code class="literal">macros_reloaded_hook</code></td><td align="center">no</td><td align="justify"><p>Executed after macros has been re-loaded
		(i.e. after the user issued <span class="guimenu">Macros</span> &#8594; <span class="guimenuitem">Reload Macros</span>). At the moment of the call to this hook,
		the newly loaded macros are already in effect.
	      </p></td></tr><tr><td align="left"><a name="node_click_hook"></a><code class="literal">node_click_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>modifier</code></em>,<em class="replaceable"><code>XEvent</code></em></code></p><p>Executed when the user clicks on a node
		with a mouse button while holding a keyboard modifier
		(one of <span class="keycap"><strong>Shift</strong></span>, <span class="keycap"><strong>Control</strong></span>,
		<span class="keycap"><strong>Alt</strong></span>, <span class="keycap"><strong>Meta</strong></span>).
		The first argument is a node the user clicked on.
		The second argument is the keyboard modifier
		to which the suffix <code class="literal">-2</code> or
		<code class="literal">-3</code> has been appended 
		if the user pressed mouse button <span class="mousebutton">2</span>
		or <span class="mousebutton">3</span> respectivelly.
		The last argument is a raw <code class="literal">Tk::XEvent</code> object
		  which can be used to obtain details about 
		  the event (such as position of the mouse pointer, etc.).
	      </p></td></tr><tr><td align="left"><a name="node_doubleclick_hook"></a><code class="literal">node_doubleclick_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>mod</code></em></code></p><p>Called when a node is double-clicked
		  while a modifier key was pressed.
		  <em class="replaceable"><code>mod</code></em> is a keyboard
		modifier string, such as <code class="literal">Control</code>,
		<code class="literal">Shift</code>,
		<code class="literal">Alt</code>, or
		<code class="literal">Meta</code>.
		  The hook is responsible for calling
		<code class="literal">Redraw_FSFile_Tree()</code> or
		similar default macro to redraw the tree as well as for 
		setting <code class="literal">$FileChanged=1</code> if needed.
	      </p></td></tr><tr><td align="left"><a name="node_motion_hook"></a><code class="literal">node_motion_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>modifier</code></em>,<em class="replaceable"><code>XEvent</code></em></code></p><p>Executed repeatedly while the user drags 
		a node while holding a keyboard modifier.
		Arguments passed to this hook
		are same as for the <code class="literal">node_click_hook</code>.
	      </p></td></tr><tr><td align="left"><a name="node_moved_hook"></a><code class="literal">node_moved_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>old-parent</code></em></code></p><p>called after a node is moved using a mouse</p></td></tr><tr><td align="left"><a name="node_release_hook"></a><code class="literal">node_release_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>target-node</code></em>,<em class="replaceable"><code>mod</code></em></code></p><p>Called when a node is released
		over another node after a mouse
		drag. <em class="replaceable"><code>mod</code></em> is a keyboard
		modifier string, such as <code class="literal">Control</code>,
		<code class="literal">Shift</code>,
		<code class="literal">Alt</code>, or
		<code class="literal">Meta</code>.
		  It can also be empty.  If
		<code class="literal">mod</code> is empty, the hook should
		either result 'stop', to disable the default action
		of cutting <em class="replaceable"><code>node</code></em> and pasting it on
		<em class="replaceable"><code>target-node</code></em>, or 
		take no action. In all other cases, the hook may
		reorganize the tree in arbitrary way, but
		it should call <code class="literal">Redraw_FSFile_Tree()</code>
		and set <code class="literal">$FileChanged=1</code> if needed.
	      </p></td></tr><tr><td align="left"><a name="node_style_hook"></a><code class="literal">node_style_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>syles</code></em></code></p><p>This hook is called for every node of a tree every time
		the tree is being drawn. It may be used to provide
		additional styling information on top of
		the information provided by a current stylesheet.
		The first argument is the particular
		node. The second argument is a hash-reference containing
		current styling information provided by defaults 
		and the current stylesheet.
		It consists of key - value pairs, where key is 
		a styled object
		(<code class="literal">Node</code>,<code class="literal">NodeLabel</code>,
		<code class="literal">EdgeLabel</code>, <code class="literal">Oval</code>,
		<code class="literal">Line</code>, <code class="literal">Text</code>,
		<code class="literal">TextBg</code>, <code class="literal">TextBox</code>)
		and values are array-references consisting
		of feature - value pairs for these objects.
		The hook may alter this hash-reference and thus
		the styling of the particular node. It is recommended
		to take the advantage of the <code class="literal">AddStyle</code>
		default macro when altering the content of the
		<em class="replaceable"><code>styles</code></em> hash-ref.
	      </p></td></tr><tr><td align="left"><a name="open_file_hook"></a><code class="literal">open_file_hook</code></td><td align="center">yes</td><td align="justify"><p>Executed before TrEd
	      attempts to open a document. The hook
	      gets a filename and a HASH reference
	      containing various flags.
	      The hook may be used for example to redirect 
	      to a different filename by
	      calling the <code class="literal">Open()</code> macro
	      passing it the filename and the hash-reference flags.
	      </p></td></tr><tr><td align="left"><a name="pre_switch_context_hook"></a><code class="literal">pre_switch_context_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>previous</code></em>,<em class="replaceable"><code>next</code></em>,<em class="replaceable"><code>window</code></em></code></p><p>Executed in the old annotation mode before the 
		  annotation mode is changed (see <a class="xref" href="ar01s15.html#contexts" title="15.10. Using different sets of macros in different situations">Section 15.10, &#8220;Using different sets of macros in different situations&#8221;</a>)
		and when switching to a different view,
		and when closing a view.
		The <em class="replaceable"><code>previous</code></em> argument
		contains the name of the
		current annotation mode while
		<em class="replaceable"><code>next</code></em> contains the name of the
		new annotation mode, or the string '&lt;NONE&gt;' if the current view is being closed.
		The <em class="replaceable"><code>window</code></em> argument is the next view 
		to be focused. If the annotation mode is changed without focusing a different view,
		<em class="replaceable"><code>window</code></em> is equal to
		<code class="literal">$grp</code>. If the focus moves to a different view 
		with the same annotation mode as in the current view,
		<em class="replaceable"><code>previous</code></em> and <em class="replaceable"><code>next</code></em>
		are equal and both contain the name of the annotation mode.
	      </p></td></tr><tr><td align="left"><a name="pre_switch_stylesheet_hook"></a><code class="literal">pre_switch_stylesheet_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>previous</code></em>,<em class="replaceable"><code>next</code></em></code></p><p>Executed when user attempts to switch the current
		stylesheet from <em class="replaceable"><code>previous</code></em> to
		<code class="literal">next</code>.
	      </p></td></tr><tr><td align="left"><a name="preload_hook"></a><code class="literal">preload_hook</code></td><td align="center">yes</td><td align="justify"><p>Only used by <span class="application">btred</span>.
		Executed before a file is preloaded.
	      </p></td></tr><tr><td align="left"><a name="print_tree_filename_hook"></a><code class="literal">print_tree_filename_hook</code></td><td align="center">no</td><td align="justify"><p>Executed when
		<span class="guimenu">File</span> &#8594; <span class="guimenuitem">Print ...</span>
		command is invoked in order to obtain a suggestion for
		the target file-name used when printing to file.
	      </p></td></tr><tr><td align="left"><a name="reload_macros_hook"></a><code class="literal">reload_macros_hook</code></td><td align="center">no</td><td align="justify"><p>Executed before macros are re-loaded
		(i.e. when the user issues <span class="guimenu">Macros</span> &#8594; <span class="guimenuitem">Reload Macros</span>).
		This macro may be used to do clean-up (e.g. cleanly deallocate
		non-perl resources, break circular dependences, etc.) before TrEd sweeps away
		the memory and code currently occupied and used by macros.</p></td></tr><tr><td align="left"><a name="root_style_hook"></a><code class="literal">root_style_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>root-node</code></em>,<em class="replaceable"><code>syles</code></em></code></p><p>This hook is executed once every time
		the tree is being drawn before
		the content of a currently selected stylesheet
		is applied and before <code class="literal">node_style_hook</code>
		is called. The first argument is the root node of
		the tree and <em class="replaceable"><code>styles</code></em> are
		as in <code class="literal">node_style_hook</code> above.
	      </p></td></tr><tr><td align="left"><a name="sort_attrs_hook"></a><code class="literal">sort_attrs_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>arrayRef</code></em>,<em class="replaceable"><code>baseAttrPath</code></em>,<em class="replaceable"><code>node</code></em></code></p>
	      <p>Executed when attributes are to be sorted by name
		(see <a class="link" href="ar01s13.html#sortattributes"><code class="literal">SortAttributes</code></a>
		configuration options). The
		<em class="replaceable"><code>arrayRef</code></em>
		parameter passed to the hook is an array reference
		containing a list of attribute names to sort.
		The hook may modify this list (in place) by
		changing the order of its elements
		or by removing certain elements from the list.
		If a true value is returned by the hook,
		the (possibly modified) list is used for displaying purposes 
		without any further reordering.
		The arguments
		<em class="replaceable"><code>baseAttrPath</code></em>
		and <em class="replaceable"><code>node</code></em>
		contain, respectively,
		a base attribute path for the given list of attributes
		and optionally the <em class="replaceable"><code>Treex::PML::Node</code></em>
		whose attributes are being displayed (optional).
	      </p>
	    </td></tr><tr><td align="left"><a name="sort_attr_values_hook"></a><code class="literal">sort_attr_values_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>arrayRef</code></em>,<em class="replaceable"><code>baseAttrPath</code></em>,<em class="replaceable"><code>node</code></em></code></p>
	      <p>Executed when values in an attribute value choice are to be ordered
		(see <a class="link" href="ar01s13.html#sortattributevalues"><code class="literal">SortAttributeValues</code></a>
		configuration options). The
		<em class="replaceable"><code>arrayRef</code></em>
		parameter passed to the hook is an array reference
		containing a list of values to sort.
		The hook may modify this list (in place) by
		changing the order of its elements
		or by removing certain elements from the list.
		If a true value is returned by the hook,
		the (possibly modified) list is used for displaying purposes 
		without any further reordering.
		The arguments
		<em class="replaceable"><code>attrPath</code></em> 
		and <em class="replaceable"><code>node</code></em> 
		contain, respectively,
		an attribute path for the attribute whose possible values
		are being listed
		and the <em class="replaceable"><code>Treex::PML::Node</code></em>
		whose attribute is involved (optional).
	      </p></td></tr><tr><td align="left"><a name="start_hook"></a><code class="literal">start_hook</code></td><td align="center">yes</td><td align="justify"><p>Executed on start-up, before the main event loop
		is entered.</p></td></tr><tr><td align="left"><a name="status_line_click_hook"></a><code class="literal">status_line_click_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>tags...</code></em></code></p><p>Called when the user clicks the status-line
		with the same arguments as
		<code class="literal">status_line_doubleclick_hook</code>
		above.
	      </p></td></tr><tr><td align="left"><a name="status_line_doubleclick_hook"></a><code class="literal">status_line_doubleclick_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>tags...</code></em></code></p><p>Called when the user double-clicks the status-line.
		Arguments are the tags associated with
		the clicked field (see above). Tag may be arbitrary
		strings and it is up to user's will to
		set up some useful convention for tagging text of
		the status-line.
	      </p></td></tr><tr><td align="left"><a name="switch_context_hook"></a><code class="literal">switch_context_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>previous</code></em>,<em class="replaceable"><code>current</code></em></code></p><p>Executed just after an annotation mode is changed (see <a class="xref" href="ar01s15.html#contexts" title="15.10. Using different sets of macros in different situations">Section 15.10, &#8220;Using different sets of macros in different situations&#8221;</a>).
		The <em class="replaceable"><code>previous</code></em> argument
		contains the name of the previous annotation mode while
		<em class="replaceable"><code>next</code></em> contains the name of the
		new current annotation mode.
	      </p></td></tr><tr><td align="left"><a name="switch_stylesheet_hook"></a><code class="literal">switch_stylesheet_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>previous</code></em>,<em class="replaceable"><code>current</code></em></code></p>
	      <p>Executed after switching stylesheets.
		The fist argument is the previous stylesheet.
		The second argument is the newly selected current stylesheet.
	      </p></td></tr><tr><td align="left"><a name="text_click_hook"></a><code class="literal">text_click_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>attribute</code></em>,<em class="replaceable"><code>modifier</code></em>,<em class="replaceable"><code>XEvent</code></em></code></p>
	      <p>Executed when the user double-clicks on
		a node label linked to a particular node attribute.
		The <em class="replaceable"><code>modifier</code></em> and 
		<em class="replaceable"><code>XEvent</code></em> arguments are 
		as described in <code class="literal">node_click_hook</code> above.
	      </p>
	      </td></tr><tr><td align="left"><a name="text_doubleclick_hook"></a><code class="literal">text_doubleclick_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>node</code></em>,<em class="replaceable"><code>attr</code></em>,<em class="replaceable"><code>mod</code></em></code></p><p>Called when an attribute in a displayed
		  node or edge label is double-clicked
		  while a modifier key was pressed.
		  <em class="replaceable"><code>mod</code></em> is a keyboard
		modifier string, such as <code class="literal">Control</code>,
		<code class="literal">Shift</code>,
		<code class="literal">Alt</code>, or
		<code class="literal">Meta</code>.
		  <em class="replaceable"><code>node</code></em> is the  <a class="ulink" href="http://search.cpan.org/dist/Treex-PML/lib/Treex/PML/Node.pm" target="_top">Treex::PML::Node</a> object
		  whose attribute was clicked.
		  <em class="replaceable"><code>attr</code></em> is name of the
		  attribute which was clicked.
		  The hook is responsible for calling
		<code class="literal">Redraw_FSFile_Tree()</code> or
		similar default macro to redraw the tree as well as for 
		setting <code class="literal">$FileChanged=1</code> if needed.
	      </p></td></tr><tr><td align="left"><a name="value_line_click_hook"></a><code class="literal">value_line_click_hook</code></td><td align="center">no</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>$button,$modif,$tags_array_ref</code></em></code></p><p>Called when the user clicks or doubleclicks the text window displayed above the tree
		  with any mouse button and possibly a keyboard modifier.
		Arguments are:
		  the mouse button (1,2,3),
		  the modifier (Alt, Meta, Control, Shift),
		  and an array-ref consisting of
		  the tags associated with
		the clicked part of the text. Tag may be arbitrary
		strings associated with the text in the
		<code class="literal">value_line_hook</code> or
		a serialized form of a node reference
		if the text is associated with a particular node.
		(More specifically,
		the Perl expression <code class="literal">$tag eq $node</code> is
		true for one of the tags and the corresponding node,
		where <code class="literal">$tag</code> is a simple scalar, i.e. astring.
		Hence, if necessary, the macro has to iterated through the tree
		in order to find the corresponding node.)
		For a double-click with the 1st mouse button, 
		<code class="literal">value_line_doubleclick_hook</code> is called
		before this hook.
	      </p></td></tr><tr><td align="left"><a name="value_line_doubleclick_hook"></a><code class="literal">value_line_doubleclick_hook</code></td><td align="center">yes</td><td align="justify"><p>Arguments: <code class="literal"><em class="replaceable"><code>@tags</code></em></code></p><p>Called when the user double-clicks the text
		in the value line, i.e. text field above the tree view.
		Arguments are the tags associated with
		the clicked part of the text. Tag may be arbitrary
		strings associated with the text in the
		<code class="literal">value_line_hook</code> or
		a serialized form of a node reference
		if the text is associated with a particular node.
		(More specifically,
		the Perl expression <code class="literal">$tag eq $node</code> is
		true for one of the tags and the corresponding node,
		where <code class="literal">$tag</code> is a simple scalar, i.e. astring.
		Hence, if necessary, the macro has to iterated through the tree
		in order to find the corresponding node.)
		The hook may return a node to focus or 'stop' to prevent
		focusing a node associated with the part of the text that was double-clicked.
	      </p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="15.10. Using different sets of macros in different situations"><div class="titlepage"><div><div><h3 class="title"><a name="contexts"></a>15.10. Using different sets of macros in different situations</h3></div><div><h4 class="subtitle">Annotation modes</h4></div></div></div><p>
	<span class="application">TrEd</span> adopts a mechanism similar
	e.g. to <span class="application">Emacs</span> major-modes which
	allow the user to safely create several sets of macros with possibly
	coliding key and menu bindings, macro names, and other functionality.
	In TrEd, this mechanism is called <span class="emphasis"><em>annotation mode</em></span>.
      </p><p>
	TrEd macros are organized into Perl packages (namespaces).
	The default package for TrEd macros is called
	<code class="literal">TredMacro</code>. Most pre-defined macros are defined within this package.
	<span class="emphasis"><em>Never</em></span> use the package <code class="literal">main</code>
	or a package starting with <code class="literal">TrEd::</code> or
	<code class="literal">Treex::PML::</code> for your macros.
      </p><p>
	A new package for a set of TrEd macros named, say <em class="replaceable"><code>MyPackage</code></em>,
	use the following commands:
</p><div class="informalexample"><pre class="programlisting">
package MyPackage;
BEGIN { import TredMacro; }

sub my_first_macro {
  InfoMessage("Hallo from my first macro!")
}
</pre></div><p>This also imports the default 
	<code class="literal">TredMacro</code> package (e.g. the pre-defined
	macros) so that the macros and global variables defined there can be called used
	without a package namespace prefix. Finally, it defines a new macro named
	<em class="replaceable"><code>my_first_macro</code></em> in the new package.
      </p><p>
	The macro <em class="replaceable"><code>my_first_macro</code></em>
	from the last example can be called from a different package
	using its full name:
	</p><pre class="programlisting">
MyPackage::my_first_macro();   # call to a macro defined in MyPackage
</pre><p>
      </p><p>
	In the interactive work, packages are used to create
	so called <span class="emphasis"><em>annotation modes</em></span>,
	which usually correspond to macro packages.
	Only one annotation mode can be	active in TrEd at a time. 
	The current annotation mode is displayed on and may be selected from a
	menu on the right end of the menu bar.
      </p><p>
	To turn a package into an annotation mode
	we just need to assign at least one keyboard or menu
	binding to some of the macros we have defined.
	(Note that annotation modes are refered to as
	binding contexts or just contexts in the old TrEd API jargon.)
	This is done using a special comment-like directives
	understood by TrEd anywhere in the macro code
	</p><div class="literallayout"><p>#binding-context MyPackage<br>
#bind my_first_macro to key Alt+e<br>
#insert my_first_macro as menu Run My First Macro<br>
</p></div><p>
        First, the <code class="literal">#binding-context</code> directive says that
	all subsequent directives should apply to the <code class="literal">MyPackage</code>
	annotation mode
	and also that non-qualified subroutine names are to be assumed
	to belong to the package named <code class="literal">MyPackage</code>.
	Then the <code class="literal">#bind</code> directive
	creates a new keyboard shortcut for the
	macro <code class="literal">my_first_macro</code>
	(which upon pressing <span class="keysym">Alt</span>+<span class="keysym">e</span>
	invokes the Perl subroutine as <code class="literal">MyPackage-&gt;my_first_macro</code>).
	Finally, the <code class="literal">#insert</code> directive creates a menu entry
	for the current macro in the <span class="guimenu">Macros</span> menu hierarchy.
	All directives must start at the beginning of a new line.
      </p><p>
	An annotation mode may also copy all
	menu and keyboard bindings from other annotation mode(s) using
	</p><div class="literallayout"><p>#key-binding-adopt <em class="replaceable"><code>other_mode(s)</code></em></p></div><p>
	and
	</p><div class="literallayout"><p>#menu-binding-adopt <em class="replaceable"><code>other_mode(s)</code></em></p></div><p>
	directives. To remove some of the copied bindings from the current context,
	use <code class="literal">#unbind-key</code> and
	<code class="literal">#remove-menu</code> directives.
      </p><p>
	For each annotation mode,
	a separate submenu with macros is created 
	in the 
	<span class="guimenuitem">Macros</span> &#8594; <span class="guimenuitem">All Modes</span> menu;
	  the <span class="guimenuitem">Macros</span> &#8594; <span class="guimenuitem">Current Mode</span> menu
	provides a short cut to the submenu with macros for the current annotation mode.
	For annotation modes with a large number of menu bindings it
	is usually more comfortable to select a macro 
	using <span class="guimenuitem">Macros</span> &#8594; <span class="guimenuitem">List of Macros</span>.</p><p> When a keyboard shortcut
	is pressed, <span class="application">TrEd</span> first searches for a
	macro bound to the shortcut within the active annotation mode
	and if such macro exists, <span class="application">TrEd</span>
	invokes it. In this case, the macro is supposed to be defined
	or imported in a package of the same name as is the name of
	the current annotation mode. If no macro is
	bound to the shortcut within the active annotation mode,
	<span class="application">TrEd</span> tries to find a binding in the
	default <code class="literal">TredMacro</code> annotation mode. The macro
	is then supposed to be defined within the
	<code class="literal">TredMacro</code> package.
	If the search
	fails, no action is taken. The same holds for hooks as well.
      </p><p>The following example shows a mechanism 
	which enables <span class="application">TrEd</span> to automatically
	decide which annotation mode to use when a file is opened. It is
	quite similar to the <span class="application">Emacs</span> concept
	of <span class="quote">&#8220;<span class="quote">auto-modes</span>&#8221;</span>, except that content of the file
	is considered here, not the file-name extension. In the
	example, the name of a PML schema is used
	to decide which annotation mode to use.
	This mechanism is used by the default implementation
	of the <a class="link" href="ar01s15.html#guess_context_hook">guess_context_hook</a>:
      </p><div class="example"><a name="id584268"></a><p class="title"><b>Example 3. Guessing correct annotation modes</b></p><div class="example-contents"><pre class="programlisting">
package Conll2009;
BEGIN { import TredMacro; }

#binding-context Conll2009
#bind EditAttributes to space

use strict;

# check if this annotation mode applies to the current file
sub is_conll2009_file {
  return (((PML::SchemaName()||'') eq 'conll2009') ? 1 : 0);
}

push @TredMacro::AUTO_CONTEXT_GUESSING, sub {
  my ($hook)=@_;
  my $resuming = ($hook eq 'file_resumed_hook');
  my $current = CurrentContext();
  if (is_conll2009_file()) {
    SetCurrentStylesheet('conll2009') if $resuming;
    return 'Conll2009';
  }
  return;
};

# do not use this annotation mode for other files
sub allow_switch_context_hook {
  return 'stop' if not is_conll2009_file();
}

# set correct stylesheet when entering this annotation mode
sub switch_context_hook {
  SetCurrentStylesheet('conll2009');
  Redraw() if GUI();
}
</pre></div></div><br class="example-break"></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s14.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s16.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">14. Command-line options </td><td width="20%" align="center"><a accesskey="h" href="tred.html">Home</a> | <a accesskey="t" href="ar01-toc.html">ToC</a></td><td width="40%" align="right" valign="top"> 16. I/O backends</td></tr></table></div></body></html>
